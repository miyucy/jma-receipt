#! /bin/sh

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

DBUSER="orca"
USERCHECKSQL="SELECT usename FROM pg_user WHERE usename = '${DBUSER}';"
DBCHECKSQL="SELECT datname FROM pg_database WHERE datname = '${DBNAME}';"

if [ -z `su - postgres -c "psql template1 -t -c \"${USERCHECKSQL}\""` ]
then
  su - postgres -c "createuser --createdb --no-adduser ${DBUSER}" 
fi

if [ -z `su - postgres -c "psql template1 -t -c \"${DBCHECKSQL}\""` ]
then
    su - ${DBUSER} -c createdb -EEUC_JP ${DBNAME} 
    su - ${DBUSER} -c "psql -e ${DBNAME} < ${INITDIR}/orca_dbkanri_orig.dump"
else
    echo "Database exist."
fi
echo "Done."
