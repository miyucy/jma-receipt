#! /bin/bash

JMARECEIPT_ENV="@jma-receipt-env@"
if [ ! -f ${JMARECEIPT_ENV} ]; then
    echo "${JMARECEIPT_ENV} does not found."
    exit 1
fi
. $JMARECEIPT_ENV

INSTALLLOG="$LOGDIR"/orca-db-install-@VERSION@.log

DELETESQL="DELETE FROM tbl_pgkanri;"

if [ ! -e "$INSTALLLOG" ]; then
    su - $ORCAUSER -c "touch $INSTALLLOG"
fi

status=0
if [ -f $PATCHDIR/copying ];	then
    echo "更新プログラム管理テーブルクリア処理スキップ" 2>&1 | tee -a $INSTALLLOG
else
    PGKANRIDEL=`su - $ORCAUSER -c "psql ${DBCONNOPTION} -q ${DBNAME} -c \"${DELETESQL}\"" 2>&1`
    RC=$?
    if [ $RC -ne 0 ] ; then
	echo "${DELETESQL}" | tee -a $INSTALLLOG
	echo "$PGKANRIDEL"  | tee -a $INSTALLLOG
	echo "ERROR: tbl_pgkanriが削除出来ませんでした" | tee -a $INSTALLLOG
	exit 2
    fi
fi
exit 0
