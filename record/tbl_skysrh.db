tbl_skysrh {
	HOSPNUM				number(2,0);
	TERMID				char(64);
	PTID				number(10,0);
	NYUGAIKBN			char(1);
	SRYYM				char(6);
	HKNID				number(10,0);
	HKNNUM				char(3);
	KOHNUM1				char(3);
	KOHNUM2				char(3);
	TOTALTEN			number(10,0);
	TOKKI1				varchar(2);
	TOKKI2				varchar(2);
	TOKKI3				varchar(2);
	TOKKI4				varchar(2);
	TOKKI5				varchar(2);
	TOKKINM1			varchar(12);
	TOKKINM2			varchar(12);
	TOKKINM3			varchar(12);
	TOKKINM4			varchar(12);
	TOKKINM5			varchar(12);
	ETC_YKZFTN1 			number(5,0);
	SKYKBN_RECEDEN	    char(1);
	STSRYYM				varchar(6),virtual;
	EDSRYYM				varchar(6),virtual;
};

path	key	{
	DBSELECT	{
		DECLARE tbl_skysrh_key csr CURSOR FOR
		SELECT *
		FROM tbl_skysrh
	        WHERE	HOSPNUM    =    :HOSPNUM
		AND	TERMID	   =	:TERMID		
		AND	PTID	   =	:PTID	
		AND	NYUGAIKBN  =	:NYUGAIKBN	
		AND	SRYYM	   =	:SRYYM	
 		;
	};
};

path	del1 	{
	DBDELETE	{
		DELETE
		FROM tbl_skysrh
		WHERE	HOSPNUM    =    :HOSPNUM
		AND     TERMID     =    :TERMID
 		;
	};
};

path	ins1 	{
	DBINSERT	{
		INSERT	
		INTO    tbl_skysrh
		(
		HOSPNUM,
		TERMID,
 		PTID,
		NYUGAIKBN,
		SRYYM,
		HKNID,
		HKNNUM,
		KOHNUM1,
		KOHNUM2,
		TOTALTEN,
		TOKKI1,
		TOKKI2,	
		TOKKI3,	
		TOKKI4,	
		TOKKI5,	
		TOKKINM1,
		TOKKINM2,
		TOKKINM3,
		TOKKINM4,
		TOKKINM5,
		ETC_YKZFTN1,
		SKYKBN_RECEDEN
		)
		SELECT 
		L.HOSPNUM,
		:TERMID,
 		L.PTID,
		L.NYUGAIKBN,
		L.SRYYM,
		L.HKNID,
		L.HKNNUM,
		L.KOHNUM1,
		L.KOHNUM2,
		L.SKYIRYO_TOTALTEN,
		L.TOKKI1,
		L.TOKKI2,
		L.TOKKI3,
		L.TOKKI4,
		L.TOKKI5,
		L.TOKKINM1,
		L.TOKKINM2,
		L.TOKKINM3,
		L.TOKKINM4,
		L.TOKKINM5,
		0,
		L.SKYKBN_RECEDEN
		FROM tbl_seikyu_main L
		WHERE 	L.HOSPNUM   =	:HOSPNUM
		AND	L.NYUGAIKBN LIKE :NYUGAIKBN
		AND	L.SRYYM	 >=     :STSRYYM
		AND	L.SRYYM	 <=     :EDSRYYM
		AND	L.SKYIRYO_TOTALTEN >=     :TOTALTEN
		AND  (( :TOKKI1   IN (:TOKKI2,L.TOKKI1,L.TOKKI2,L.TOKKI3,L.TOKKI4,L.TOKKI5 ))
		  OR  ( :TOKKINM1 IN (:TOKKINM2,L.TOKKINM1,L.TOKKINM2,L.TOKKINM3,L.TOKKINM4,L.TOKKINM5)))
		AND	L.SKYKBN_RECEDEN LIKE :SKYKBN_RECEDEN 
		;
	};
};

path	ins2 	{
	DBINSERT	{
		INSERT	
		INTO    tbl_skysrh
		(
		HOSPNUM,
		TERMID,
 		PTID,
		NYUGAIKBN,
		SRYYM,
		HKNID,
		HKNNUM,
		KOHNUM1,
		KOHNUM2,
		TOTALTEN,
		TOKKI1,
		TOKKI2,	
		TOKKI3,	
		TOKKI4,	
		TOKKI5,	
		TOKKINM1,
		TOKKINM2,
		TOKKINM3,
		TOKKINM4,
		TOKKINM5,
		ETC_YKZFTN1,
		SKYKBN_RECEDEN
		)
		SELECT 
		L.HOSPNUM,
		:TERMID,
 		L.PTID,
		L.NYUGAIKBN,
		L.SRYYM,
		L.HKNID,
		L.HKNNUM,
		L.KOHNUM1,
		L.KOHNUM2,
		L.SKYIRYO_TOTALTEN,
		L.TOKKI1,
		L.TOKKI2,
		L.TOKKI3,
		L.TOKKI4,
		L.TOKKI5,
		L.TOKKINM1,
		L.TOKKINM2,
		L.TOKKINM3,
		L.TOKKINM4,
		L.TOKKINM5,
		M.ETC_YKZFTN1,
		L.SKYKBN_RECEDEN
		FROM tbl_seikyu_main L JOIN tbl_seikyu_etc M
		 USING (HOSPNUM, SRYYM, NYUGAIKBN, PTID, RECEKA, TEISYUTUSAKI, RECESYUBETU, HKNJANUM, HOJOKBN_KEY, KOHID_KEY, TEKSTYMD)
		WHERE 	L.HOSPNUM   =	:HOSPNUM
		AND	L.NYUGAIKBN LIKE :NYUGAIKBN
		AND	L.SRYYM	 >=     :STSRYYM
		AND	L.SRYYM	 <=     :EDSRYYM
		AND	L.SKYIRYO_TOTALTEN >=     :TOTALTEN
		AND  (( :TOKKI1   IN (:TOKKI2,L.TOKKI1,L.TOKKI2,L.TOKKI3,L.TOKKI4,L.TOKKI5 ))
		  OR  ( :TOKKINM1 IN (:TOKKINM2,L.TOKKINM1,L.TOKKINM2,L.TOKKINM3,L.TOKKINM4,L.TOKKINM5)))
		AND   ( M.ETC_YKZFTN1 <> 0 )
		AND	L.SKYKBN_RECEDEN LIKE :SKYKBN_RECEDEN 
		;
	};
};
