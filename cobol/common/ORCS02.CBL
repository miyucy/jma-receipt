      *******************************************************************
      * Project code name "ORCA"
      * 日医標準レセプトソフト（JMA standard receipt software）
      * Copyright(C) 2002 JMA (Japan Medical Association)
      *
      * This program is part of "JMA standard receipt software".
      *
      *     This program is distributed in the hope that it will be useful
      * for further advancement in medical care, according to JMA Open
      * Source License, but WITHOUT ANY WARRANTY.
      *     Everyone is granted permission to use, copy, modify and
      * redistribute this program, but only under the conditions described
      * in the JMA Open Source License. You should have received a copy of
      * this licence along with this program. If not, stop using this
      * program and contact JMA, 2-28-16 Honkomagome, Bunkyo-ku, Tokyo,
      * 113-8621, Japan.
      ********************************************************************
       IDENTIFICATION      DIVISION.
       PROGRAM-ID.         ORCS02.
      ****************************************************************
      *    OS           LINUX                                         
      *                                                               
      *    PROGRAM      ORCS02  /  負担金額算定サブ                   
      *                            （入院用）                         
      *  管理者            : 
      *  作成日付    作業者        記述
      *  02/10/22    NACL−門脇    新規作成
      ****************************************************************
      *  プログラム修正履歴
      * Maj/Min/Rev  修正者       日付      内容
      *  01.00.01    NACL-門脇    03/03/07  老人限度額の集計変更
      *  01.00.02    NACL-門脇    03/03/10  食事区分”４”の対応追加
      *  01.00.03    NACL-門脇    03/03/25  更正・育成等の患者公費負担対応
      *  01.00.04    NACL-門脇    03/04/16  船員保険（被保険者）＋通勤災害
      *                                     ＋初診時　対応
      *  01.00.05    NACL-門脇    03/05/07  地方老人の負担額の四捨五入の設定
      *                                     を保険番号マスタの設定で行う。
      *  01.00.06    NACL-門脇    03/05/08  船員保険（職務上）の食事負担無し
      *                                     に修正
      *  01.00.07    NACL-門脇    03/05/21  減免の端数設定対応
      *  01.00.08    NACL-門脇    03/06/06  消費税端数対応
      *  01.00.09    NACL-門脇    03/07/01  レセ記載用一部負担金編集修正
      *  01.00.10    NACL-門脇    03/07/24  労災非指定医療機関対応
      *                                     自賠責患者請求０％対応
      *                                     自賠責文書料消費税対応
      *                                     自賠責の療養担当手当対応
      *                                     労災自賠責食事療養費計算対応
      *  01.00.11    NACL-門脇    03/08/27  特定疾患改正対応
      ****************************************************************
       ENVIRONMENT         DIVISION.
       CONFIGURATION       SECTION.
       INPUT-OUTPUT                SECTION.
       FILE-CONTROL.
      *
      *
       DATA                DIVISION.
       FILE                        SECTION.
      *
       WORKING-STORAGE SECTION.
      *
       01  WK-KSNRATE9                 PIC 9(03).
       01  WK-KSNRATE                  PIC 9V99.
       01  WK-TAXKBN                   PIC X(01).
       01  WK-KEISAN                   PIC 9(09).
      *01  WK-NISSU1                   PIC 9(05).
      *01  WK-NISSU2                   PIC 9(05).
       01  KEISAN-AREA.
           03  WK-KNJFTNKIN            PIC 9(10).
           03  WK-ZENGAKU              PIC 9(10).
           03  WK-ZENGAKU-SYU          PIC 9(10).
           03  WK-ZENGAKU-YAK          PIC 9(10).
           03  WK-FUTANWARI            PIC 9V99.
           03  WK-SEIKYUGK             PIC 9(10).
           03  WK-NYUKFTNRATE          PIC 9(03).
           03  WK-TOKUTEI-COMPFTN      PIC 9(08).
           03  WK-TOKUTEI-COMPFTN2     PIC 9(08).
           03  WK-TOKUTEI-COMPFTN3     PIC 9(08).
           03  WK-NYUJGNGAK            PIC 9(07).
           03  WK-DAY                  PIC 9(02).
           03  WK-ENDYMD.
               05  WK-ENDYYMM          PIC 9(06).
               05  WK-ENDDD            PIC 9(02).
       01  WK-FLG.
           03  FLG-SYUNOU              PIC 9(01).
           03  FLG-TNKRRK              PIC 9(01).
           03  FLG-TSYRRK              PIC 9(01).
           03  FLG-PTKOHFTN            PIC 9(01).
           03  FLG-HKNNUM              PIC 9(01).
           03  FLG-HKNCOMBI            PIC 9(01).
           03  FLG-SYSKANRI            PIC 9(01).
           03  FLG-PTINF               PIC 9(01).
           03  FLG-NYUINACCT           PIC 9(01).
           03  FLG-SRYACCT             PIC 9(01).
           03  FLG-TENSU               PIC 9(01).
           03  FLG-SANSHOU             PIC X(01).
           03  FLG-SANSHOU2            PIC X(01).
           03  FLG-SANSHOU3            PIC X(01).                       
           03  FLG-SANTEI1             PIC X(01).
           03  FLG-SANTEI2             PIC X(01).
           03  FLG-SANTEI3             PIC X(01).
           03  FLG-SANTEI4             PIC X(01).
      *
           03  WK-PAYKBN               PIC X(02).
      *
      *    低所得１の長期入院認定年月日
           03  WRK-SKJGNSTYMD-S        PIC X(08).
           03  WRK-SKJGNSTYMD-E        PIC X(08).
           03  WRK-SKJGNSTYMD2.
               05  WRK-SKJGNSTYYMM2    PIC 9(06).
               05  WRK-SKJGNSTDD2      PIC 9(02).
      *
      *    保険区分（空白：医保　１：労災・自賠）
           03  WK-HKNKBN               PIC X(01).
      *
      *    患者負担計算時の四捨五入用ワーク
           03  WK-FTN                  PIC 9(10).
      *
      *    病院割引額計算時の割引率用ワーク
           03  WK-RATE                 PIC 9(1)V9(2).
      *
      *    減免端数区分
           03  WK-HASU1001-KBN         PIC X(1).
      *
      *    消費税端数区分
           03  WK-TAX1001-KBN          PIC X(1).
      *
      *    県番号
           03  WK-1001-PREFNUM         PIC 9(2).
      *
      *
      *    公費の患者負担上限金額の退避用エリア
       01  HOKEN-MAX-AREA.
           03  MAX-KIN-KOHI1-M         PIC 9(08).
           03  MAX-KIN-KOHI2-M         PIC 9(08).
           03  MAX-KIN-KOHI3-M         PIC 9(08).
           03  MAX-KIN-KOHI4-M         PIC 9(08).
      *
      *    公費の患者負担済み金額の加算用エリア
       01  HOKEN-FUTAN-AREA.
           03  FTN-KOHI1-M             PIC 9(08).
           03  FTN-KOHI2-M             PIC 9(08).
           03  FTN-KOHI3-M             PIC 9(08).
           03  FTN-KOHI4-M             PIC 9(08).
      *
      *    公費のレセプト負担区分四捨五入しない場合,
      *    レセ記載金額の加算用エリア
       01  HOKEN-FUTAN-AREA2.                                           
           03  FTN-KOHI1-M2            PIC 9(08).                       
           03  FTN-KOHI2-M2            PIC 9(08).                       
           03  FTN-KOHI3-M2            PIC 9(08).                       
           03  FTN-KOHI4-M2            PIC 9(08).                       
      *
      *    公費の患者負担可能な残額算定用エリア
       01  HOKEN-ZAN-AREA.
           03  ZAN-KOHI1-M             PIC 9(08).
           03  ZAN-KOHI2-M             PIC 9(08).
           03  ZAN-KOHI3-M             PIC 9(08).
           03  ZAN-KOHI4-M             PIC 9(08).
           03  ZAN-KOHI-AREA.
             05  ZAN-KOHI1             PIC 9(08).
             05  ZAN-KOHI2             PIC 9(08).
             05  ZAN-KOHI3             PIC 9(08).
             05  ZAN-KOHI4             PIC 9(08).
           03  ZAN-KOHI-TBL  REDEFINES  ZAN-KOHI-AREA
                                        OCCURS  4.
             05  ZAN-KOHI-T            PIC 9(08).
      *
      *    公費のレセプト負担区分四捨五入しない場合,
      *    レセ記載可能な残額算定用エリア
       01  HOKEN-ZAN-AREA2.                                             
           03  ZAN-KOHI1-M2            PIC 9(08).                       
           03  ZAN-KOHI2-M2            PIC 9(08).                       
           03  ZAN-KOHI3-M2            PIC 9(08).                       
           03  ZAN-KOHI4-M2            PIC 9(08).                       
           03  ZAN-KOHI-AREA2.                                          
             05  ZAN-KOHI12            PIC 9(08).                       
             05  ZAN-KOHI22            PIC 9(08).                       
             05  ZAN-KOHI32            PIC 9(08).                       
             05  ZAN-KOHI42            PIC 9(08).                       
           03  ZAN-KOHI-TBL2 REDEFINES  ZAN-KOHI-AREA2                  
                                        OCCURS  4.                      
             05  ZAN-KOHI-T2           PIC 9(08).                       
      *
      *    公費のレセプト負担区分四捨五入しない場合,
      *    レセ記載金額退避用エリア
       01  WK-KOH-COMPFTN-AREA.                                         
           03  WK-KOH-COMPFTN          PIC 9(07)                        
                                        OCCURS  4.                      
      *
      *    患者年齢算出用エリア
       01  WRK-NENREI-AREA.
           03  WRK-NENREI              PIC 9(03).
           03  WRK-YMDS1.
               05  WRK-YYS1            PIC 9(04).
               05  WRK-MMS1            PIC 9(02).
               05  WRK-DDS1            PIC 9(02).
           03  WRK-YMDS2.
               05  WRK-YYS2            PIC 9(04).
               05  WRK-MMS2            PIC 9(02).
               05  WRK-DDS2            PIC 9(02).
      *
      *    添え字領域
       01  IDX-AREA.
           03  IDX                     PIC  9(02)  VALUE  ZERO.
           03  IDX-ST                  PIC  9(02)  VALUE  ZERO.
           03  IDX-ED                  PIC  9(02)  VALUE  ZERO.
           03  IDY                     PIC  9(02)  VALUE  ZERO.
           03  IDZ                     PIC  9(02)  VALUE  ZERO.
           03  HKNNYU-IDX              PIC  9(02)  VALUE  ZERO.
           03  KOH-IDX                 PIC  9(02)  VALUE  ZERO.
      *
      *    高齢者の負担上限算定エリア
       01  WK-SYUHKN-TAIHI-AREA.
           03  MAX-KIN-SYU-M           PIC 9(08).
           03  FTN-SYU-M               PIC 9(08).
           03  ZAN-SYU-M               PIC 9(08).
           03  FLG-SANTEI-SYU          PIC X(01).
           03  FLG-KOUREI              PIC 9(01).
           03  FLG-IRYOHI              PIC 9(01).
           03  FLG-KOUGAKUCYO          PIC 9(01).
           03  FLG-SKJ                 PIC 9(01).
           03  WK-SYU-SYUCOMPFTN       PIC 9(08).
           03  WK-KOUREI-IRYOHI        PIC 9(08).
           03  WK-KOUREI-IRYOHI2       PIC 9(08).
           03  FTN-KOH-XXX             PIC 9(08).                       
           03  FTN-KOH-YYY             PIC 9(08).                       
           03  FTN-KOH-ZZZ             PIC 9(08).                       
      *
      *    食事負担算定エリア
       01  WK-SHOKUJI-TAIHI-AREA.
           03  WK-SHOKUJIRYOYO         PIC 9(01).
           03  WK-TOKUKANRIKASAN       PIC 9(01).
           03  WK-SHOKUJI-NISSU        PIC 9(02).
           03  WK-SHOKUJI-RYOYOHI      PIC 9(07).
           03  WK-SHOKUJI-RYOYOHI95    PIC 9(07).
           03  WK-SHOKUJI-RYOYOHI96    PIC 9(07).
           03  WK-SHOKUJI-JIHI         PIC 9(07).
           03  WK-SHOKUJI-FTN          PIC 9(07).
           03  WK-SHOKUJI-FTN95        PIC 9(07).
           03  WK-SHOKUJI-FTN96        PIC 9(07).
           03  WK-NYUSKJRYYKBN         PIC X(01).
           03  WK-NISSU-SKJ            PIC 9(02).
           03  WK-KNJFTNKIN-SKJ        PIC 9(07).
           03  WK-RYOYOHI-SKJ          PIC 9(07).
           03  WK-SRYCD                PIC 9(09).
      *    03  WK-TSUSAN-NISSU         PIC 9(04).
      *    03  WK-SEIKYUKIKAN-NISSU    PIC 9(04).
      *    食堂加算退避テーブル
       01  WK-SHOKUDOKASAN-TABLE.
           03  WK-SHOKUDOKASAN-T       OCCURS   31.
               05  WK-SHOKUDOKASAN     PIC 9(04).
      *    外泊退避テーブル
       01  WK-GAIHAKU-TABLE.
           03  WK-GAIHAKU-T            OCCURS   31.
               05  WK-GAIHAKU          PIC 9(04).
      *    労災入院中の特別食加算退避テーブル
       01  WK-ROSAITOKU-TABLE.
           03  WK-ROSAITOKU-T          OCCURS   31.
               05  WK-ROSAITOKU95      PIC 9(04).
               05  WK-ROSAITOKU96      PIC 9(04).
               05  WK-ROSAITOKU97      PIC 9(04).
      *
      *地方公費用フラグ（公費限度額決定用）
       01  WK-CHIHOU-FLG-TAIHI-AREA.
           03  FLG-CHIHOU              PIC X(01)  OCCURS  4.
      *
      *主保険負担金額の公費限度額対応用エリア
       01  WK-SYUHEN-TAIHI-AREA.
           03  FLG-SYUHEN              PIC X(01).
      *
           03  FLG-SANTEI1-HEN         PIC X(01).
           03  FLG-SANTEI-SYU-HEN      PIC X(01).
      *
           03  FTN-KOHI1-M-HEN         PIC 9(08).
           03  ZAN-KOHI1-HEN           PIC 9(08).
      *
           03  FTN-SYU-M-HEN           PIC 9(08).
           03  ZAN-SYU-M-HEN           PIC 9(08).
      *
           03  WK-HEN-SYUCOMPFTN       PIC 9(07).
           03  WK-HEN-KOH1COMPFTN      PIC 9(07).
      *
      *****************************************************************
      *    ファイルレイアウト
      *****************************************************************
      *
      *    収納マスター
       01  SYU-SYUNOU-REC.
           COPY    "CPSYUNOU.INC".
      *
      *    低所得者履歴
       01  TSYRRK-REC.
           COPY    "CPTSYRRK.INC".
      *
      *    年金履歴
       01  TNKRRK-REC.
           COPY    "CPTNKRRK.INC".
      *
      *    保険組み合わせ
       01  HKNCOMBI-REC.
           COPY    "CPHKNCOMBI.INC".
      *
      *    保険番号
       01  HKNNUM-REC.
           COPY    "CPHKNNUM.INC".
      *
      *    入院会計
       01  NYUINACCT-REC.
           COPY    "CPNYUINACCT.INC".
      *
      *    診療会計
       01  SRYACCT-REC.
           COPY    "CPSRYACCT.INC".
      *
      *    システム管理
           COPY    "CPSK1001.INC".
           COPY    "CPSK1026.INC".
           COPY    "CPSK1027.INC".
           COPY    "CPSK4001.INC".
           COPY    "CPSK5000.INC".
      *
      *    患者情報
       01  PTINF-REC.
           COPY    "CPPTINF.INC".
      *
      *    点数
           COPY    "CPTENSU.INC".
      *
      *    患者公費負担
       01  PTKOHFTN-REC.
           COPY    "CPPTKOHFTN.INC".
      *
      *****************************************************************
      *    サブプロ用　領域
      *****************************************************************
      *
      *    日付変換サブ
           COPY    "CPORCSDAY.INC".
           COPY    "CPORCSLNK.INC".
           COPY    "CPORCSGDAY.INC".
      *    保険算定用年齢・割合計算サブ
           COPY    "CPORCSAGECHK.INC".
      *    ＤＢ検索
           COPY    "MCPDATA.INC".
           COPY    "CPORCMCP.INC".
      *
      /
      ***
       LINKAGE             SECTION.
           COPY  "MCPAREA". 
       01  LNK-ORCS02-REC.
           COPY  "CPORCS02.INC".
       01  LNK-SYUNOU-REC.
           COPY  "CPSYUNOU.INC"    REPLACING  //SYU-// BY //LNK-SYU-//.
       01  LNK-WRK-SYUNOU-REC-T.
         02 LNK-WRK-SYUNOU-REC     OCCURS 10.
           COPY  "CPSYUNOU.INC"  
                               REPLACING  //SYU-// BY //LNK-WRK-SYU-//.
      /
       PROCEDURE           DIVISION  USING
                                     MCPAREA
                                     LNK-ORCS02-REC
                                     LNK-SYUNOU-REC
                                     LNK-WRK-SYUNOU-REC-T.
      ******************************************************************
      *        依頼制御処理
      ******************************************************************
       MAIN-RTN            SECTION.
       MAIN-000.
      **   MOVE    ZERO            TO  LNK-S02-RC.
           MOVE    SPACE           TO  KEISAN-AREA.
           INITIALIZE                  KEISAN-AREA.
           MOVE    ZERO            TO  LNK-SYU-RJN-FTN
                                       LNK-SYU-KOH-FTN
                                       LNK-SYU-YKZ-FTN.
           MOVE    ZERO            TO  LNK-SYU-SYUHKNFTNMONEY
                                       LNK-SYU-SYUCOMPFTN
                                       LNK-SYU-SYUCOMPYKZFTN
                                       LNK-SYU-SYUCOMPTOTAL.
           MOVE    SPACE           TO  LNK-SYU-SYUYKZFTNKBN.
           PERFORM   VARYING   IDX   FROM   1    BY   1
             UNTIL   IDX   >   4
                  MOVE    ZERO     TO  LNK-SYU-KOH-HKNFTNMONEY(IDX)
                                       LNK-SYU-KOH-COMPFTN(IDX)
                                       LNK-SYU-KOH-COMPYKZFTN(IDX)
                                       LNK-SYU-KOH-COMPTOTAL(IDX)
                  MOVE    SPACE    TO  LNK-SYU-KOH-YKZFTNKBN(IDX)
           END-PERFORM.
           MOVE    ZERO            TO  LNK-SYU-RESE-YKZ-FTN.
      *
           PERFORM   VARYING   IDX   FROM   1    BY   1
             UNTIL   IDX   >   7
                  MOVE    ZERO     TO  LNK-SYU-SHOKUJI(IDX)
                                       LNK-SYU-SHOKUJI-NISSU(IDX)
           END-PERFORM.              
           MOVE           ZERO     TO  LNK-SYU-SYUSKJ-NISSU
                                       LNK-SYU-SYUSKJ-RYOYOHI
                                       LNK-SYU-SYUSKJ-FTN
                                       LNK-SYU-SYUSKJ-FTN-RECE.
           MOVE           SPACE    TO  LNK-SYU-SYUSKJ-FTNKBN.
           PERFORM   VARYING   IDX   FROM   1    BY   1
             UNTIL   IDX   >   4
                  MOVE    ZERO     TO  LNK-SYU-SKJ-NISSU(IDX)
                                       LNK-SYU-SKJ-RYOYOHI(IDX)
                                       LNK-SYU-SKJ-FTN(IDX)
                                       LNK-SYU-SKJ-FTN-RECE(IDX)
                  MOVE    SPACE    TO  LNK-SYU-SKJ-FTNKBN(IDX)
           END-PERFORM.
           MOVE           ZERO     TO  LNK-SYU-RYOYOHI-SKJ.
           MOVE           ZERO     TO  LNK-SYU-SKYMONEY-SKJ.
           MOVE           ZERO     TO  LNK-SYU-SKYMONEY-SKJ-TAX.
           MOVE           ZERO     TO  LNK-SYU-SKYMONEY-SKJ-KEI.
           MOVE           ZERO     TO  LNK-SYU-RYOYOHI-SKJ-JIHI.
           MOVE           ZERO     TO  LNK-SYU-SKYMONEY-SKJ-JIHI.
           MOVE           ZERO     TO  LNK-SYU-SKYMONEY-SKJ-JIHI-TAX.
           MOVE           ZERO     TO  LNK-SYU-SKYMONEY-SKJ-JIHI-KEI.
      *
      *    減免端数区分・消費税端数区分の取り込み
           INITIALIZE                         SYS-1001-REC.
           MOVE    "1001"               TO    SYS-1001-KANRICD.
           MOVE    "*"                  TO    SYS-1001-KBNCD.
           MOVE    LNK-SYU-SRYYMD       TO    ORC-DBYMD.
           MOVE    SYS-1001-REC         TO    MCPDATA-REC.
           MOVE    "DBSELECT"           TO    MCP-FUNC.
           MOVE    "SYSKANRI-KEY"       TO    ORC-DBPATH.
           CALL    "ORCMCPSUB"    USING       MCPAREA
                                              ORCMCPAREA
                                              MCPDATA-REC.
           IF      MCP-RC               =     ZERO
               MOVE     "SYSKANRI-KEY"  TO    ORC-DBPATH
               PERFORM   SYSKANRI-READ-SEC
               MOVE      SYS-1001-DISCOUNT-HASU-KBN  
                                        TO    WK-HASU1001-KBN
               MOVE      SYS-1001-TAX-HASU-KBN       
                                        TO    WK-TAX1001-KBN
               MOVE      SYS-1001-PREFNUM
                                        TO    WK-1001-PREFNUM
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "SYSKANRI-KEY"       TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC.
      *
      *    保険組合せマスタの参照部分確定
           PERFORM   100-KAKUTEI-SEC.
      *
      *    保険組合せマスタの検索
           INITIALIZE                           HKNCOMBI-REC.
           MOVE    LNK-SYU-HOSPID       TO      COMB-HOSPID.
           MOVE    LNK-SYU-PTID         TO      COMB-PTID.
           MOVE    LNK-SYU-HKNCOMBINUM  TO      COMB-HKNCOMBINUM.
           MOVE    HKNCOMBI-REC         TO      MCPDATA-REC.
           MOVE    "DBSELECT"           TO      MCP-FUNC.
           MOVE    "HKNCOMBI-KEY"       TO      ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC.
           IF      MCP-RC               =       ZERO
               MOVE    "HKNCOMBI-KEY"   TO      ORC-DBPATH 
               PERFORM   HKNCOMBI-READ-SEC
               IF      FLG-HKNCOMBI     =       1
                   MOVE    "DBCLOSE"        TO      MCP-FUNC
                   MOVE    "HKNCOMBI-KEY"   TO      ORC-DBPATH
                   CALL    "ORCMCPSUB"       USING   MCPAREA
                                                     ORCMCPAREA
                                                     MCPDATA-REC
                   DISPLAY "HKNCOMBI DBFETCH ERR"
                   MOVE     10          TO      LNK-S02-RC
                   GO   TO              MAIN-EXT
               END-IF
           ELSE
               MOVE    "DBCLOSE"        TO      MCP-FUNC
               MOVE    "HKNCOMBI-KEY"   TO      ORC-DBPATH
               CALL    "ORCMCPSUB"       USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC
               MOVE    1                TO      FLG-HKNCOMBI
               DISPLAY "HKNCOMBI DBSELECT ERR"
               MOVE     10              TO      LNK-S02-RC
               GO   TO                  MAIN-EXT
           END-IF.
           MOVE    "DBCLOSE"            TO      MCP-FUNC.
           MOVE    "HKNCOMBI-KEY"       TO      ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC.
      *
      *    保険組合せマスタから主保険の保険種類を判定
      *    （空白：医保、１：労災・自賠）
           MOVE     SPACE               TO       WK-HKNKBN.
           EVALUATE    COMB-SYU-HKNKOHSBTKBN
               WHEN    "4"
                       MOVE    "1"      TO       WK-HKNKBN
           END-EVALUATE.
      *
      *    患者負担額の算定
           PERFORM       200-HKNFTN-SANTEI-SEC.
      *
      *    算出請求額の１０円未満四捨五入（薬剤一部負担金も含む）
      *    ※労災保険の場合は四捨五入を行わない
      *    ※老人２割で限度が７２３００円＋＠円の場合は四捨五入を行わない
           IF     (LNK-SYU-SKYMONEY      NOT =   ZERO)   
               IF   WK-HKNKBN                =   "1"
               OR   FLG-KOUGAKUCYO           =    1 
                   CONTINUE
               ELSE
                   COMPUTE  LNK-SYU-SKYMONEY = LNK-SYU-SKYMONEY  +  5
                   COMPUTE  WK-SEIKYUGK      = LNK-SYU-SKYMONEY  /  10
                   COMPUTE  LNK-SYU-SKYMONEY = WK-SEIKYUGK       *  10
               END-IF 
           END-IF.
      *
      *    主保険・老人・公費の判別
      *      （主保険）
           IF     (LNK-SYU-SYUHKNNUM     NOT =   SPACE)    AND
                  (LNK-SYU-KOH1HKNNUM    =       SPACE)    AND
                  (LNK-SYU-KOH2HKNNUM    =       SPACE)    AND
                  (LNK-SYU-KOH3HKNNUM    =       SPACE)    AND
                  (LNK-SYU-KOH4HKNNUM    =       SPACE)
                   MOVE   LNK-SYU-SKYMONEY   TO   LNK-SYU-HKNTEKMONEY
           END-IF.
      *       （老人） 
      *
           IF     (LNK-SYU-KOH1HKNNUM    =   SPACE)    AND
                  (LNK-SYU-KOH2HKNNUM    =   SPACE)    AND
                  (LNK-SYU-KOH3HKNNUM    =   SPACE)    AND
                  (LNK-SYU-KOH4HKNNUM    =   SPACE)
                   CONTINUE
           ELSE
               IF      COMB-KOH1-HKNKOHSBTKBN    =       "3"
                  IF  (COMB-KOH2-HKNKOHSBTKBN    =     SPACE)  AND
                      (COMB-KOH3-HKNKOHSBTKBN    =     SPACE)  AND
                      (COMB-KOH4-HKNKOHSBTKBN    =     SPACE)
                       MOVE   LNK-SYU-SKYMONEY   TO   LNK-SYU-RJN-FTN
                  ELSE
      *            （公費）
                       MOVE   LNK-SYU-SKYMONEY   TO   LNK-SYU-KOH-FTN
                  END-IF
               ELSE
      *            （公費）
                       MOVE   LNK-SYU-SKYMONEY   TO   LNK-SYU-KOH-FTN
               END-IF
           END-IF.
      *
      *    自費金額の消費税計算
           COMPUTE   LNK-SYU-JIHI-TOTAL =  (LNK-SYU-JIHI-TAXNASI(1)  +
                                            LNK-SYU-JIHI-TAXNASI(2)  +
                                            LNK-SYU-JIHI-TAXNASI(3)  +
                                            LNK-SYU-JIHI-TAXNASI(4)  +
                                            LNK-SYU-JIHI-TAXNASI(5)).
           COMPUTE   LNK-SYU-JIHI-TOTAL-TAX = (LNK-SYU-JIHI-TAXARI(1) +
                                               LNK-SYU-JIHI-TAXARI(2) +
                                               LNK-SYU-JIHI-TAXARI(3) +
                                               LNK-SYU-JIHI-TAXARI(4) +
                                               LNK-SYU-JIHI-TAXARI(5)).
      *
           IF    WK-TAX1001-KBN  =  "1"
             COMPUTE LNK-SYU-JIHI-TAX = (LNK-SYU-JIHI-TOTAL-TAX * 0.05)
                                      +  0.5
           ELSE
             COMPUTE LNK-SYU-JIHI-TAX =  LNK-SYU-JIHI-TOTAL-TAX * 0.05
           END-IF.
      *
      *    保険適用外金額の加算
           MOVE       ZERO              TO  LNK-SYU-TGMONEY(12).
           MOVE       ZERO              TO  LNK-SYU-TGMONEY-TAX(12).
           PERFORM    VARYING   HKNNYU-IDX   FROM   1   BY   1
                      UNTIL     HKNNYU-IDX   >     11
                      ADD       LNK-SYU-TGMONEY(HKNNYU-IDX)
                                            TO  LNK-SYU-TGMONEY(12)
                      ADD       LNK-SYU-TGMONEY-TAX(HKNNYU-IDX)
                                        TO  LNK-SYU-TGMONEY-TAX(12)
           END-PERFORM.
      *
           IF    WK-TAX1001-KBN  =  "1"
             COMPUTE   LNK-SYU-TGMONEY-TAX(12)   = 
                     ( LNK-SYU-TGMONEY-TAX(12) * 1.05 )  +  0.5
           ELSE
             COMPUTE   LNK-SYU-TGMONEY-TAX(12)   = 
                       LNK-SYU-TGMONEY-TAX(12) * 1.05          
           END-IF.
      *
      *    請求金額の計算（調整金含まず）
           COMPUTE    LNK-SYU-SKYMONEY  =   
                                 LNK-SYU-SKYMONEY              +
                                 LNK-SYU-RMSAGAKU              +
                                 LNK-SYU-SKYMONEY-SKJ-KEI      +
                                 LNK-SYU-SKYMONEY-SKJ-JIHI-KEI +
                                 LNK-SYU-TGMONEY(12)           +
                                 LNK-SYU-TGMONEY-TAX(12)       +
                                 LNK-SYU-JIHI-TOTAL            +
                                 LNK-SYU-JIHI-TOTAL-TAX        +
                                 LNK-SYU-JIHI-TAX.
      *
      *    自費保険の補助区分が課税の場合、消費税計算を行う
           IF  ( COMB-SYU-HKNKOHSBTKBN  =  "8" ) AND
               ( COMB-HOJOKBN           =  "1" )
      *
              IF    WK-TAX1001-KBN  =  "1"
                 COMPUTE  LNK-SYU-SKYMONEY   =  
                           ( LNK-SYU-SKYMONEY  *  1.05 ) + 0.5
              ELSE
                 COMPUTE  LNK-SYU-SKYMONEY   =  
                             LNK-SYU-SKYMONEY  *  1.05
              END-IF
      *
           END-IF.     
      *
      *    病院減免の計算（労災・自賠責を除く）
           IF     LNK-SYU-SKYMONEY         NOT  =   ZERO
              IF   LNK-SYU-SYUHKNNUM         =    "971" OR "973"
                   CONTINUE
              ELSE
                   INITIALIZE                           PTINF-REC
                   MOVE    LNK-SYU-HOSPID       TO      PTINF-HOSPID
                   MOVE    LNK-SYU-PTID         TO      PTINF-PTID
                   MOVE    PTINF-REC            TO      MCPDATA-REC
                   MOVE    "DBSELECT"           TO      MCP-FUNC
                   MOVE    "PTINF-KEY"          TO      ORC-DBPATH
                   CALL    "ORCMCPSUB"           USING   MCPAREA
                                                         ORCMCPAREA
                                                         MCPDATA-REC
                   IF      MCP-RC               =       ZERO
                       MOVE    "PTINF-KEY"      TO      ORC-DBPATH
                       PERFORM  PTINF-READ-SEC
                       IF       MCP-RC          =       ZERO
                           PERFORM   GENMEN-KEISAN-SEC
                       ELSE
                           DISPLAY  "PTINF FETCH ERR"
                       END-IF
                   ELSE
                       DISPLAY   "PTINF SELECT ERR"
                   END-IF
      *
                   MOVE    "DBCLOSE"            TO  MCP-FUNC
                   MOVE    "PTINF-KEY"          TO  ORC-DBPATH
                   CALL    "ORCMCPSUB"           USING
                                                 MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC
              END-IF
           END-IF.
      *
      *    請求金額の計算（労災保険適用時の円建て項目加算）
      *    ＜労災指定（０％）＞
           IF   (WK-HKNKBN               =    "1"  ) AND
                (LNK-SYU-SYUHKNNUM       =    "971") AND
                (LNK-SYU-PTFTNRATE       =    ZERO )
                 MOVE    ZERO      TO       LNK-SYU-SKYMONEY
                 COMPUTE    LNK-SYU-SKYMONEY  =   
                            LNK-SYU-SKYMONEY              +
                            LNK-SYU-RMSAGAKU              +
                            LNK-SYU-SKYMONEY-SKJ-JIHI-KEI +
                            LNK-SYU-TGMONEY(12)           +
                            LNK-SYU-TGMONEY-TAX(12)       +
                            LNK-SYU-JIHI-TOTAL            +
                            LNK-SYU-JIHI-TOTAL-TAX        +
                            LNK-SYU-JIHI-TAX
           END-IF.
      *    ＜非労災指定（１００％）＞
           IF   (WK-HKNKBN               =    "1"  ) AND
                (LNK-SYU-SYUHKNNUM       =    "971") AND
                (LNK-SYU-PTFTNRATE       =     100 )
                 COMPUTE    LNK-SYU-SKYMONEY  =
                            LNK-SYU-SKYMONEY              +
                            LNK-SYU-RSISHOSHIN-MONEY      +
                            LNK-SYU-RSISAISHIN-MONEY      +
                            LNK-SYU-RSISDO-MONEY          +
                            LNK-SYU-RSIETC-MONEY
           END-IF.
      *
      *    自賠責保険の場合、労災円建て項目への加算率計算追加
      *    ＜患者請求する（１００％）の場合＞
           IF   (WK-HKNKBN               =    "1")   AND
                (LNK-SYU-SYUHKNNUM       =    "973") AND
                (LNK-SYU-PTFTNRATE       =     100 )
                 COMPUTE  LNK-SYU-RSISHOSHIN-MONEY  =
                         (LNK-SYU-RSISHOSHIN-MONEY  *  WK-KSNRATE)
                                                    +  0.5
                 COMPUTE  LNK-SYU-RSISAISHIN-MONEY  =
                         (LNK-SYU-RSISAISHIN-MONEY  *  WK-KSNRATE)
                                                    +  0.5
      *          COMPUTE  LNK-SYU-RSISDO-MONEY      =
      *                   LNK-SYU-RSISDO-MONEY      *  WK-KSNRATE
      *
                 IF   WK-TAXKBN   =   "2"
                   IF    WK-TAX1001-KBN  =  "1"
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                            ((LNK-S02-SINDAN  *  0.05)  +  0.5)
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                            ((LNK-S02-MEISAI  *  0.05)  +  0.5)
                   ELSE
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                             (LNK-S02-SINDAN  *  0.05)
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                             (LNK-S02-MEISAI  *  0.05)
                   END-IF
                 END-IF
      *
                 COMPUTE    LNK-SYU-SKYMONEY  =   
                            LNK-SYU-SKYMONEY         +
                            LNK-SYU-RSISHOSHIN-MONEY +
                            LNK-SYU-RSISAISHIN-MONEY +
                            LNK-SYU-RSISDO-MONEY     +
                            LNK-SYU-RSIETC-MONEY
           END-IF.
      *    ＜患者請求しない（０％）の場合＞
           IF   (WK-HKNKBN               =    "1")   AND
                (LNK-SYU-SYUHKNNUM       =    "973") AND
                (LNK-SYU-PTFTNRATE       =    ZERO )
                 COMPUTE  LNK-SYU-RSISHOSHIN-MONEY  =
                         (LNK-SYU-RSISHOSHIN-MONEY  *  WK-KSNRATE)
                                                    +  0.5
                 COMPUTE  LNK-SYU-RSISAISHIN-MONEY  =
                         (LNK-SYU-RSISAISHIN-MONEY  *  WK-KSNRATE)
                                                    +  0.5
      *          COMPUTE  LNK-SYU-RSISDO-MONEY      =
      *                   LNK-SYU-RSISDO-MONEY      *  WK-KSNRATE
      *
                 IF   WK-TAXKBN   =   "2"
                   IF    WK-TAX1001-KBN  =  "1"
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                            ((LNK-S02-SINDAN  *  0.05)  +  0.5)
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                            ((LNK-S02-MEISAI  *  0.05)  +  0.5)
                   ELSE
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                             (LNK-S02-SINDAN  *  0.05)
                     COMPUTE  LNK-SYU-RSIETC-MONEY      =
                              LNK-SYU-RSIETC-MONEY      +
                             (LNK-S02-MEISAI  *  0.05)
                   END-IF
                 END-IF
      *
                 MOVE    ZERO      TO       LNK-SYU-SKYMONEY
                 COMPUTE    LNK-SYU-SKYMONEY  =
                            LNK-SYU-SKYMONEY              +
                            LNK-SYU-RMSAGAKU              +
                            LNK-SYU-SKYMONEY-SKJ-JIHI-KEI +
                            LNK-SYU-TGMONEY(12)           +
                            LNK-SYU-TGMONEY-TAX(12)       +
                            LNK-SYU-JIHI-TOTAL            +
                            LNK-SYU-JIHI-TOTAL-TAX        +
                            LNK-SYU-JIHI-TAX
           END-IF.
      *
      *    請求金額の計算（調整金の加減算）
           COMPUTE    LNK-SYU-SKYMONEY  =   LNK-SYU-SKYMONEY    +
                                            LNK-SYU-CHOSEI.
      *
       MAIN-EXT.
           EXIT PROGRAM
           STOP RUN.
      *
      ******************************************************************
      *        病院減免計算処理                                    *
      ******************************************************************
       GENMEN-KEISAN-SEC          SECTION.
      *
           IF   PTINF-DISCOUNT  NOT =   SPACE  AND  "00"
      *
               INITIALIZE                         SYS-1026-REC
               MOVE    "1026"               TO    SYS-1026-KANRICD
               MOVE    PTINF-DISCOUNT-KBN   TO    SYS-1026-KBNCD
               MOVE    LNK-SYU-SKYSTYMD     TO    ORC-DBYMD
               MOVE    SYS-1026-REC         TO    MCPDATA-REC
               MOVE    "DBSELECT"           TO    MCP-FUNC
               MOVE    "SYSKANRI-KEY"       TO    ORC-DBPATH
               CALL    "ORCMCPSUB"    USING        MCPAREA
                                                   ORCMCPAREA
                                                   MCPDATA-REC
               IF      MCP-RC               =     ZERO
                   MOVE     "SYSKANRI-KEY"  TO    ORC-DBPATH
                   PERFORM   SYSKANRI-READ-SEC
                   IF    MCP-RC             =     ZERO
                       MOVE   SYS-1026-KBNCD  TO  LNK-SYU-DISCOUNT-KBN
                       MOVE   SYS-1026-DISCOUNT-BODY
                                              TO  LNK-SYU-DISCOUNT-BODY
                   END-IF
               END-IF
      *
               MOVE    "DBCLOSE"            TO  MCP-FUNC
               MOVE    "SYSKANRI-KEY"       TO  ORC-DBPATH
               CALL    "ORCMCPSUB"           USING
                                             MCPAREA
                                             ORCMCPAREA
                                             MCPDATA-REC
      *
               INITIALIZE                         SYS-1027-REC
               MOVE    "1027"               TO    SYS-1027-KANRICD
               MOVE    PTINF-DISCOUNT       TO    SYS-1027-KBNCD
               MOVE    LNK-SYU-SKYSTYMD     TO    ORC-DBYMD
               MOVE    SYS-1027-REC         TO    MCPDATA-REC
               MOVE    "DBSELECT"           TO    MCP-FUNC
               MOVE    "SYSKANRI-KEY"       TO    ORC-DBPATH
               CALL    "ORCMCPSUB"    USING       MCPAREA
                                                  ORCMCPAREA
                                                  MCPDATA-REC
               IF      MCP-RC               =     ZERO
                   MOVE     "SYSKANRI-KEY"  TO    ORC-DBPATH
                   PERFORM   SYSKANRI-READ-SEC
                   IF    MCP-RC             =     ZERO
                       EVALUATE  SYS-1027-TEIRITU
                           WHEN  "1"
                               MOVE    ZERO    TO   WK-RATE
                               COMPUTE  WK-RATE  =  
                                        (100 - SYS-1027-DISCOUNT-RATE)
                                        /  100
                               EVALUATE   WK-HASU1001-KBN
                                  WHEN  " "
                                  WHEN  "1"
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                         (LNK-SYU-SKYMONEY * WK-RATE)
                                                           + 5
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                               LNK-SYU-SKYMONEY  / 10
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                               LNK-SYU-SKYMONEY  * 10
                                  WHEN  "2"
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                          LNK-SYU-SKYMONEY * WK-RATE
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                               LNK-SYU-SKYMONEY  / 10
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                               LNK-SYU-SKYMONEY  * 10
                                  WHEN  "3"
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                         (LNK-SYU-SKYMONEY * WK-RATE)
                                                           + 9
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                               LNK-SYU-SKYMONEY  / 10
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                               LNK-SYU-SKYMONEY  * 10
                                  WHEN  "4"
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                          LNK-SYU-SKYMONEY * WK-RATE
                               END-EVALUATE
                           WHEN  "2"
                               IF   SYS-1027-DISCOUNT-RATE >= 
                                                     LNK-SYU-SKYMONEY
                                    MOVE    ZERO   TO   LNK-SYU-SKYMONEY
                               ELSE
                                    COMPUTE    LNK-SYU-SKYMONEY  =
                                               LNK-SYU-SKYMONEY  -
                                               SYS-1027-DISCOUNT-RATE
                               END-IF
                       END-EVALUATE
                       MOVE   SYS-1027-KBNCD   TO
                                               LNK-SYU-DISCOUNT-RATEKBN
                       MOVE   SYS-1027-TEIRITU TO
                                               LNK-SYU-DISCOUNT-TEIRITU
                       MOVE   SYS-1027-DISCOUNT-RATE  TO
                                               LNK-SYU-DISCOUNT-RATE
                   END-IF
               END-IF
      *
               MOVE    "DBCLOSE"            TO  MCP-FUNC
               MOVE    "SYSKANRI-KEY"       TO  ORC-DBPATH
               CALL    "ORCMCPSUB"           USING
                                             MCPAREA
                                             ORCMCPAREA
                                             MCPDATA-REC
           END-IF.
      *
       GENMEN-KEISAN-EXT.
           EXIT.
      ******************************************************************
      *        保険参照部分確定処理                                    *
      ******************************************************************
       100-KAKUTEI-SEC          SECTION.
      *
           MOVE    SPACE                TO      FLG-SANSHOU.
           MOVE    SPACE                TO      FLG-SANSHOU2.
           MOVE    SPACE                TO      FLG-SANSHOU3.     
           MOVE    SPACE                TO      WRK-SKJGNSTYMD-S
           MOVE    SPACE                TO      WRK-SKJGNSTYMD-E
      *
           INITIALIZE                           TNKRRK-REC.
           MOVE    LNK-SYU-HOSPID       TO      TNKRRK-HOSPID.
           MOVE    LNK-SYU-PTID         TO      TNKRRK-PTID.
           MOVE    TNKRRK-REC           TO      MCPDATA-REC.
           MOVE    "DBSELECT"           TO      MCP-FUNC.
           MOVE    "TNKRRK-KEY2"        TO      ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC.
           IF      MCP-RC               =       ZERO
               MOVE    "TNKRRK-KEY2"    TO      ORC-DBPATH
               PERFORM  TNKRRK-READ-SEC
               PERFORM  UNTIL
                          (FLG-TNKRRK     =    1)    OR
                         ((TNKRRK-STYMD     <=   LNK-SYU-SKYSTYMD)  AND
                          (LNK-SYU-SKYSTYMD <=   TNKRRK-EDYMD))
                   PERFORM   TNKRRK-READ-SEC
               END-PERFORM
           ELSE
               MOVE    1                TO      FLG-TNKRRK
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "TNKRRK-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
      *
           INITIALIZE                           TSYRRK-REC.
           MOVE    LNK-SYU-HOSPID       TO      TSYRRK-HOSPID.
           MOVE    LNK-SYU-PTID         TO      TSYRRK-PTID.
           MOVE    TSYRRK-REC           TO      MCPDATA-REC.
           MOVE    "DBSELECT"           TO      MCP-FUNC.
           MOVE    "TSYRRK-KEY2"        TO      ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC.
           IF      MCP-RC               =       ZERO
               MOVE    "TSYRRK-KEY2"    TO      ORC-DBPATH
               PERFORM  TSYRRK-READ-SEC
               PERFORM  UNTIL
                       (FLG-TSYRRK      =    1)    OR
                      ((TSYRRK-NINSTYMD   <=   LNK-SYU-SKYSTYMD)  AND
                       (LNK-SYU-SKYSTYMD  <=   TSYRRK-NINEDYMD))
                   PERFORM   TSYRRK-READ-SEC
               END-PERFORM
           ELSE
               MOVE    1                TO      FLG-TSYRRK
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "TSYRRK-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
      *
           EVALUATE   FLG-TSYRRK        ALSO     FLG-TNKRRK
               WHEN    1                ALSO     1
                       MOVE     "1"     TO       FLG-SANSHOU
               WHEN    0                ALSO     1
                       MOVE     "2"     TO       FLG-SANSHOU
               WHEN    0                ALSO     0
               WHEN    1                ALSO     0
                       MOVE     "3"     TO       FLG-SANSHOU
           END-EVALUATE.
      *
           IF   ( LNK-SYU-KOH1HKNNUM     =  SPACE OR "027" )
           AND  ( LNK-SYU-KOH2HKNNUM     =  SPACE          )
           AND  ( LNK-SYU-KOH3HKNNUM     =  SPACE          )
           AND  ( LNK-SYU-KOH4HKNNUM     =  SPACE          )
                       MOVE     "1"     TO       FLG-SANSHOU
           END-IF.
      *
      *    公費負担部分検索用の参照部分セット（本人で固定）
           MOVE       "1"               TO       FLG-SANSHOU2.
      *
      **>  IF    LNK-SYU-SRYYMD(1:6)   <   "200304"
      **>                 MOVE     "1"     TO       FLG-SANSHOU2
      **>  ELSE
      **>     EVALUATE   FLG-TSYRRK        ALSO     FLG-TNKRRK
      **>         WHEN    1                ALSO     1
      **>                 MOVE     "1"     TO       FLG-SANSHOU2
      **>         WHEN    0                ALSO     1
      **>                 MOVE     "2"     TO       FLG-SANSHOU2
      **>         WHEN    0                ALSO     0
      **>         WHEN    1                ALSO     0
      **>                 MOVE     "3"     TO       FLG-SANSHOU2
      **>     END-EVALUATE
      **>  END-IF.
      *
      *
           EVALUATE    FLG-TSYRRK       ALSO     FLG-TNKRRK        
               WHEN    1                ALSO     1                 
                       MOVE    SPACE    TO       FLG-SANSHOU3      
               WHEN    0                ALSO     1                 
                       MOVE     "2"     TO       FLG-SANSHOU3      
      *
                       MOVE     TSYRRK-SKJGNSTYMD
                                        TO       WRK-SKJGNSTYMD-S
                       MOVE     TSYRRK-NINEDYMD
                                        TO       WRK-SKJGNSTYMD-E
      *
               WHEN    0                ALSO     0                 
               WHEN    1                ALSO     0
                       MOVE     "1"     TO       FLG-SANSHOU3      
           END-EVALUATE.                                    
      *
       100-KAKUTEI-EXT.
           EXIT.
      ******************************************************************
      *        保険負担額算定処理                                      *
      ******************************************************************
       200-HKNFTN-SANTEI-SEC          SECTION.
      *
           MOVE    SPACE                 TO    HOKEN-MAX-AREA
                                               HOKEN-FUTAN-AREA
                                               HOKEN-FUTAN-AREA2        
                                               HOKEN-ZAN-AREA
                                               HOKEN-ZAN-AREA2.         
           INITIALIZE                          HOKEN-MAX-AREA
                                               HOKEN-FUTAN-AREA
                                               HOKEN-FUTAN-AREA2        
                                               HOKEN-ZAN-AREA
                                               HOKEN-ZAN-AREA2.         
           MOVE    ALL"9"                TO    WK-KOH-COMPFTN-AREA.     
      *
      *    自賠責・療養担当手当用特例処理
      *    （自賠責の場合、１０点を１２０円に読み替える）
      *    （療養担当手当：１月１回の算定）
           IF    LNK-SYU-SYUHKNNUM       =    "973"
           AND   LNK-S02-RYOYO       NOT =    ZERO
               COMPUTE  LNK-SYU-HKNTEN (10)  =  LNK-SYU-HKNTEN (10)
                                             -  LNK-S02-RYOYO
               COMPUTE  LNK-SYU-HKNTEN (12)  =  LNK-SYU-HKNTEN (12)
                                             -  LNK-S02-RYOYO
      *
               COMPUTE  LNK-SYU-RSIETC-MONEY =  LNK-SYU-RSIETC-MONEY
                                             +  120
           END-IF.
      *
      *    患者負担金算出前の１００％負担額算出
           MOVE      ZERO         TO      WK-ZENGAKU.
           PERFORM   VARYING   IDX     FROM    1   BY  1
                     UNTIL     IDX         >   11
               COMPUTE WK-ZENGAKU  =   WK-ZENGAKU  +
                                      (LNK-SYU-HKNTEN (IDX) * 10)
           END-PERFORM.
      *
      *
           INITIALIZE    WK-SYUHKN-TAIHI-AREA.
           IF  LNK-S02-KOUREI-NYUIN-KBN     =   SPACE   
      *        患者年齢計算
               INITIALIZE                           PTINF-REC
               MOVE    LNK-SYU-HOSPID       TO      PTINF-HOSPID
               MOVE    LNK-SYU-PTID         TO      PTINF-PTID
               MOVE    PTINF-REC            TO      MCPDATA-REC
               MOVE    "DBSELECT"           TO      MCP-FUNC
               MOVE    "PTINF-KEY"          TO      ORC-DBPATH
               CALL    "ORCMCPSUB"          USING   MCPAREA
                                                    ORCMCPAREA
                                                    MCPDATA-REC
               IF      MCP-RC               =       ZERO
                   MOVE    "PTINF-KEY"      TO      ORC-DBPATH
                   PERFORM  PTINF-READ-SEC
               ELSE
                   DISPLAY   "PTINF SELECT ERR"
      *
                   INITIALIZE                   PTINF-REC
               END-IF
      *
               MOVE    "DBCLOSE"            TO  MCP-FUNC
               MOVE    "PTINF-KEY"          TO  ORC-DBPATH
               CALL    "ORCMCPSUB"          USING
                                            MCPAREA
                                            ORCMCPAREA
                                            MCPDATA-REC
      *
               INITIALIZE                    ORCSAGECHKAREA
               MOVE    LNK-SYU-HOSPID    TO  AGECHK-HOSPID
               MOVE    LNK-SYU-PTID      TO  AGECHK-PTID
               MOVE    LNK-SYU-SKYSTYMD  TO  AGECHK-SRYYMD
               MOVE    PTINF-BIRTHDAY    TO  AGECHK-BIRTHDAY
               CALL    "ORCSAGECHK"        USING
                                           ORCSAGECHKAREA
               IF      AGECHK-RC       =   ZERO
                   IF  ( AGECHK-NENREI   >=  70 ) OR
                      (( AGECHK-NENREI   >=  65 AND                  
                         COMB-KOH1HKNNUM  = "027"))                  
                       MOVE  "1"     TO  LNK-S02-KOUREI-NYUIN-KBN
                   END-IF
               ELSE
                   DISPLAY  "PTINF AGE-CHK ERR " LNK-SYU-PTID
      *
                   MOVE  SPACE       TO  LNK-S02-KOUREI-NYUIN-KBN
               END-IF
           END-IF.       
           IF   LNK-S02-KOUREI-NYUIN-KBN   =  "1"
               IF  COMB-SYU-HKNKOHSBTKBN   =   "8"
                   MOVE  SPACE       TO  LNK-S02-KOUREI-NYUIN-KBN
               END-IF
               IF  COMB-HKNNUM  =  "971"  OR  "973"
                   MOVE  SPACE       TO  LNK-S02-KOUREI-NYUIN-KBN
               END-IF
           END-IF.                                               
      *
      *    労災・自賠責の負担割合を求める
      *
      *    IF   WK-HKNKBN              =   "1"
      *
               INITIALIZE                           PTINF-REC.
               MOVE    LNK-SYU-HOSPID       TO      PTINF-HOSPID.
               MOVE    LNK-SYU-PTID         TO      PTINF-PTID.
               MOVE    PTINF-REC            TO      MCPDATA-REC.
               MOVE    "DBSELECT"           TO      MCP-FUNC.
               MOVE    "PTINF-KEY"          TO      ORC-DBPATH.
               CALL    "ORCMCPSUB"          USING   MCPAREA
                                                    ORCMCPAREA
                                                    MCPDATA-REC.
               IF      MCP-RC               =       ZERO
                   MOVE    "PTINF-KEY"      TO      ORC-DBPATH
                   PERFORM  PTINF-READ-SEC
               ELSE
                   DISPLAY   "PTINF SELECT ERR"
      *
                   INITIALIZE                   PTINF-REC
               END-IF.
      *
               MOVE    "DBCLOSE"            TO  MCP-FUNC.
               MOVE    "PTINF-KEY"          TO  ORC-DBPATH.
               CALL    "ORCMCPSUB"          USING
                                            MCPAREA
                                            ORCMCPAREA
                                            MCPDATA-REC.
      *
               INITIALIZE                  ORCSAGECHKAREA.
               MOVE    LNK-SYU-HOSPID  TO  AGECHK-HOSPID.
               MOVE    LNK-SYU-PTID    TO  AGECHK-PTID.
               MOVE    LNK-SYU-SRYYMD  TO  AGECHK-SRYYMD.
               MOVE    PTINF-BIRTHDAY  TO  AGECHK-BIRTHDAY.
               MOVE    LNK-SYU-HKNCOMBINUM 
                                       TO  AGECHK-HKNCOMBINUM.
               CALL    "ORCSAGECHK"        USING
                                           ORCSAGECHKAREA.
               IF      AGECHK-RC       =   ZERO
                   MOVE   AGECHK-FTNRATE  TO  LNK-SYU-PTFTNRATE
               ELSE
                   DISPLAY  "PTINF AGE-CHK ERR " LNK-SYU-PTID
               END-IF.
      *
      *    END-IF.
      *
      *    保険番号テーブルから公費の負担上限金額の取得
           PERFORM         210-HOKEN-KAISU-SEC.
      *
      *    診療月内の収納マスタから公費毎の患者負担金額の
      *    累計を調査
           PERFORM         220-SYUNOU-SEC.
      *
      *    保険・公費の負担金計算
           PERFORM         230-FTNKIN-SEC.
      *
       200-HKNFTN-SANTEI-EXT.
           EXIT.
      *
      ******************************************************************
      *        保険・公費の設定上限金額の取得　　　　　                *
      ******************************************************************
       210-HOKEN-KAISU-SEC           SECTION.
      *
           INITIALIZE         WK-CHIHOU-FLG-TAIHI-AREA.
      *
           INITIALIZE         WK-SYUHEN-TAIHI-AREA.
      *
      *    *公費１の上限金額取込み
           IF (COMB-KOH1HKNNUM           NOT =  SPACE)    AND
              (COMB-KOH1-NYUJGNKBN       =     "1")
               INITIALIZE                      HKNNUM-REC
               MOVE   COMB-HOSPID        TO    HKN-HOSPID
               MOVE   COMB-KOH1HKNNUM    TO    HKN-HKNNUM
               IF     COMB-KOH1HKNNUM    =     "027"
                       MOVE     COMB-KOH1PAYKBN
                                         TO    WK-PAYKBN
               ELSE
                       MOVE     "00"     TO    WK-PAYKBN
               END-IF
               MOVE   HKNNUM-REC         TO    MCPDATA-REC
               MOVE   "DBSELECT"         TO    MCP-FUNC
               MOVE   "HKNNUM-KEY2"      TO    ORC-DBPATH
               CALL   "ORCMCPSUB"         USING MCPAREA
                                                ORCMCPAREA
                                                MCPDATA-REC
               IF      MCP-RC            =     ZERO
                 MOVE    "HKNNUM-KEY2" TO    ORC-DBPATH
                 PERFORM  HKNNUM-READ-SEC
                 PERFORM  UNTIL
                   (FLG-HKNNUM     =    1)                       OR
                  ((HKN-TEKSTYMD(1:6)     <=  LNK-SYU-SKYSTYMD(1:6)) AND
                   (LNK-SYU-SKYSTYMD(1:6) <=  HKN-TEKEDYMD(1:6))     AND
                   (WK-PAYKBN            =  HKN-PAYKBN))
                     PERFORM   HKNNUM-READ-SEC
                 END-PERFORM
                 IF     FLG-HKNNUM         =       0
                        PERFORM   2103-KOH1-KAISU-SEC
                 END-IF
               END-IF
           ELSE
      *
               IF  (LNK-S02-KOUREI-NYUIN-KBN  =   "1" )
               AND (COMB-KOH1HKNNUM           =  "010")
                    MOVE   40200       TO   MAX-KIN-KOHI1-M
                    MOVE    "1"        TO   COMB-KOH1-NYUJGNKBN
               END-IF
      *
               IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
               AND ( COMB-KOH1HKNNUM(1:1)        >=       "1"  )
               AND ( COMB-KOH1HKNNUM(1:1)        <=       "8"  )
                 IF   WK-1001-PREFNUM       NOT   =     20
                    MOVE   40200   TO    MAX-KIN-KOHI1-M
                    MOVE    "1"    TO    COMB-KOH1-NYUJGNKBN
                    MOVE    "1"    TO    FLG-CHIHOU(1)
                 END-IF
               END-IF
      *
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "HKNNUM-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
      *
      *    *公費２の上限金額取込み
           IF (COMB-KOH2HKNNUM           NOT = SPACE)    AND
              (COMB-KOH2-NYUJGNKBN       =     "1")
               INITIALIZE                      HKNNUM-REC
               MOVE   COMB-HOSPID        TO    HKN-HOSPID
               MOVE   COMB-KOH2HKNNUM    TO    HKN-HKNNUM
               MOVE     "00"             TO    WK-PAYKBN
               MOVE   HKNNUM-REC         TO    MCPDATA-REC
               MOVE   "DBSELECT"         TO    MCP-FUNC
               MOVE   "HKNNUM-KEY2"      TO    ORC-DBPATH
               CALL   "ORCMCPSUB"         USING MCPAREA
                                                ORCMCPAREA
                                                MCPDATA-REC
               IF      MCP-RC            =     ZERO
                 MOVE    "HKNNUM-KEY2" TO    ORC-DBPATH
                 PERFORM  HKNNUM-READ-SEC
                 PERFORM  UNTIL
                   (FLG-HKNNUM     =    1)                      OR
                  ((HKN-TEKSTYMD(1:6)     <= LNK-SYU-SKYSTYMD(1:6)) AND
                   (LNK-SYU-SKYSTYMD(1:6) <= HKN-TEKEDYMD(1:6))     AND
                   (WK-PAYKBN            = HKN-PAYKBN))
                     PERFORM   HKNNUM-READ-SEC
                 END-PERFORM
                 IF     FLG-HKNNUM         =       0
                        PERFORM   2104-KOH2-KAISU-SEC
                 END-IF
               END-IF
           ELSE
      *
               IF  (LNK-S02-KOUREI-NYUIN-KBN  =   "1" )
               AND (COMB-KOH2HKNNUM           =  "010")
                    MOVE   40200       TO   MAX-KIN-KOHI2-M
                    MOVE    "1"        TO   COMB-KOH2-NYUJGNKBN
               END-IF
      *
               IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
               AND ( COMB-KOH2HKNNUM(1:1)        >=       "1"  )
               AND ( COMB-KOH2HKNNUM(1:1)        <=       "8"  )
                 IF   WK-1001-PREFNUM       NOT   =     20
                    MOVE   40200   TO    MAX-KIN-KOHI2-M
                    MOVE    "1"    TO    COMB-KOH2-NYUJGNKBN
                    MOVE    "1"    TO    FLG-CHIHOU(2)
                 END-IF
               END-IF
      *
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "HKNNUM-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
      *
      *    *公費３の上限金額取込み
           IF (COMB-KOH3HKNNUM           NOT = SPACE)    AND
              (COMB-KOH3-NYUJGNKBN       =     "1")
               INITIALIZE                      HKNNUM-REC
               MOVE   COMB-HOSPID        TO    HKN-HOSPID
               MOVE   COMB-KOH3HKNNUM    TO    HKN-HKNNUM
               MOVE     "00"             TO    WK-PAYKBN
               MOVE   HKNNUM-REC         TO    MCPDATA-REC
               MOVE   "DBSELECT"         TO    MCP-FUNC
               MOVE   "HKNNUM-KEY2"      TO    ORC-DBPATH
               CALL   "ORCMCPSUB"         USING MCPAREA
                                                ORCMCPAREA
                                                MCPDATA-REC
               IF      MCP-RC            =     ZERO
                 MOVE    "HKNNUM-KEY2" TO    ORC-DBPATH
                 PERFORM  HKNNUM-READ-SEC
                 PERFORM  UNTIL
                   (FLG-HKNNUM     =    1)                      OR
                  ((HKN-TEKSTYMD(1:6)     <= LNK-SYU-SKYSTYMD(1:6)) AND
                   (LNK-SYU-SKYSTYMD(1:6) <= HKN-TEKEDYMD(1:6))     AND
                   (WK-PAYKBN            = HKN-PAYKBN))
                     PERFORM   HKNNUM-READ-SEC
                 END-PERFORM
                 IF     FLG-HKNNUM         =       0
                        PERFORM   2105-KOH3-KAISU-SEC
                 END-IF
               END-IF
           ELSE
      *
               IF  (LNK-S02-KOUREI-NYUIN-KBN  =   "1" )
               AND (COMB-KOH3HKNNUM           =  "010")
                    MOVE   40200       TO   MAX-KIN-KOHI3-M
                    MOVE    "1"        TO   COMB-KOH3-NYUJGNKBN
               END-IF
      *
               IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
               AND ( COMB-KOH3HKNNUM(1:1)        >=       "1"  )
               AND ( COMB-KOH3HKNNUM(1:1)        <=       "8"  )
                 IF   WK-1001-PREFNUM       NOT   =     20
                    MOVE   40200   TO    MAX-KIN-KOHI3-M
                    MOVE    "1"    TO    COMB-KOH3-NYUJGNKBN
                    MOVE    "1"    TO    FLG-CHIHOU(3)
                 END-IF
               END-IF
      *
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "HKNNUM-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
      *
      *    *公費４の上限金額取込み
           IF (COMB-KOH4HKNNUM           NOT = SPACE)    AND
              (COMB-KOH4-NYUJGNKBN       =     "1")
               INITIALIZE                      HKNNUM-REC
               MOVE   COMB-HOSPID        TO    HKN-HOSPID
               MOVE   COMB-KOH4HKNNUM    TO    HKN-HKNNUM
               MOVE     "00"             TO    WK-PAYKBN
               MOVE   HKNNUM-REC         TO    MCPDATA-REC
               MOVE   "DBSELECT"         TO    MCP-FUNC
               MOVE   "HKNNUM-KEY2"      TO    ORC-DBPATH
               CALL   "ORCMCPSUB"         USING MCPAREA
                                                ORCMCPAREA
                                                MCPDATA-REC
               IF      MCP-RC            =     ZERO
                 MOVE    "HKNNUM-KEY2" TO    ORC-DBPATH
                 PERFORM  HKNNUM-READ-SEC
                 PERFORM  UNTIL
                   (FLG-HKNNUM     =    1)                       OR
                  ((HKN-TEKSTYMD(1:6)     <= LNK-SYU-SKYSTYMD(1:6)) AND
                   (LNK-SYU-SKYSTYMD(1:6) <= HKN-TEKEDYMD(1:6))     AND
                   (WK-PAYKBN            = HKN-PAYKBN))
                     PERFORM   HKNNUM-READ-SEC
                 END-PERFORM
                 IF     FLG-HKNNUM         =       0
                        PERFORM   2106-KOH4-KAISU-SEC
                 END-IF
               END-IF
           ELSE
      *
               IF  (LNK-S02-KOUREI-NYUIN-KBN  =   "1" )
               AND (COMB-KOH4HKNNUM           =  "010")
                    MOVE   40200       TO   MAX-KIN-KOHI4-M
                    MOVE    "1"        TO   COMB-KOH4-NYUJGNKBN
               END-IF
      *
               IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
               AND ( COMB-KOH4HKNNUM(1:1)        >=       "1"  )
               AND ( COMB-KOH4HKNNUM(1:1)        <=       "8"  )
                 IF   WK-1001-PREFNUM       NOT   =     20
                    MOVE   40200   TO    MAX-KIN-KOHI4-M
                    MOVE    "1"    TO    COMB-KOH4-NYUJGNKBN
                    MOVE    "1"    TO    FLG-CHIHOU(4)
                 END-IF
               END-IF
      *
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "HKNNUM-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
      *
      *    患者公費負担（金額）取り込み
           IF    LNK-SYU-SRYYMD(1:6)   <   "200304"
               CONTINUE
           ELSE
               PERFORM   2107-KOHFTN-KINGAKU-SEC
           END-IF.
      *
      *
           IF  LNK-S02-KOUREI-NYUIN-KBN   =   "1"
               IF  COMB-KOH1-HKNKOHSBTKBN   =   "3"
                   EVALUATE   COMB-KOH1PAYKBN
                       WHEN   "01"
                           MOVE  "1"          TO   COMB-KOH1-NYUJGNKBN
                           IF  FLG-SANSHOU3     =   SPACE               
                               MOVE   40200   TO   MAX-KIN-KOHI1-M
                           ELSE
                             IF  FLG-SANSHOU3     =   "1"
                               MOVE   15000   TO   MAX-KIN-KOHI1-M
      *                        MOVE   1       TO   FLG-SKJ
                             ELSE
                               MOVE   24600   TO   MAX-KIN-KOHI1-M
      *                        MOVE   2       TO   FLG-SKJ
                             END-IF
                           END-IF
                       WHEN   "02"
                           MOVE  "1"          TO   COMB-KOH1-NYUJGNKBN
                           MOVE   72300       TO   MAX-KIN-KOHI1-M
                           IF  (COMB-KOH2HKNNUM    =  SPACE)              
                           AND (COMB-KOH3HKNNUM    =  SPACE)
                           AND (COMB-KOH4HKNNUM    =  SPACE)
                             MOVE   WK-ZENGAKU  TO   WK-KOUREI-IRYOHI
                             MOVE   1           TO   FLG-IRYOHI
                           END-IF
                   END-EVALUATE
               ELSE
                   EVALUATE   COMB-HOJOKBN
                       WHEN   "1"
                       WHEN   "9"
                           IF  FLG-SANSHOU3      =   SPACE              
                               MOVE   40200   TO   MAX-KIN-SYU-M
                           ELSE
                             IF  FLG-SANSHOU3     =   "1"
                               MOVE   15000   TO   MAX-KIN-SYU-M
      *                        MOVE   1       TO   FLG-SKJ
                             ELSE
                               MOVE   24600   TO   MAX-KIN-SYU-M
      *                        MOVE   2       TO   FLG-SKJ
                             END-IF
                           END-IF
                       WHEN   "2"
                       WHEN   "8"
                           MOVE   72300       TO   MAX-KIN-SYU-M
                           IF  (COMB-KOH1HKNNUM    =  SPACE)              
                           AND (COMB-KOH2HKNNUM    =  SPACE)
                           AND (COMB-KOH3HKNNUM    =  SPACE)
                           AND (COMB-KOH4HKNNUM    =  SPACE)
                             MOVE   WK-ZENGAKU  TO   WK-KOUREI-IRYOHI
                             MOVE   2           TO   FLG-IRYOHI
                           END-IF
                   END-EVALUATE
               END-IF
           END-IF.
      *
           IF  ( LNK-S02-KOUREI-NYUIN-KBN     =      "1"   )
           AND ( COMB-HKNNUM            NOT   =     SPACE  )
      *
                IF   COMB-KOH1HKNNUM      =    "027"
                   IF  ( COMB-KOH2HKNNUM(1:1)  >=     "1" )
                   AND ( COMB-KOH2HKNNUM(1:1)  <=     "8" )
                   AND ( COMB-KOH3HKNNUM        =    SPACE)
                   AND ( COMB-KOH4HKNNUM        =    SPACE)
                          MOVE    "1"    TO   FLG-SYUHEN
                   ELSE
                      IF  (COMB-KOH2HKNNUM  NOT = SPACE)
                      OR  (COMB-KOH3HKNNUM  NOT = SPACE)
                      OR  (COMB-KOH4HKNNUM  NOT = SPACE)
                        MOVE    "1"    TO   FLG-SYUHEN
                        IF   MAX-KIN-KOHI1-M   >  40200
                            MOVE   40200   TO   MAX-KIN-KOHI1-M
                        END-IF
                      END-IF
                   END-IF
                ELSE
                   IF  ( COMB-KOH1HKNNUM(1:1)  >=     "1" )
                   AND ( COMB-KOH1HKNNUM(1:1)  <=     "8" )
                   AND ( COMB-KOH2HKNNUM        =    SPACE)
                   AND ( COMB-KOH3HKNNUM        =    SPACE)
                   AND ( COMB-KOH4HKNNUM        =    SPACE)
                          MOVE    "1"    TO   FLG-SYUHEN
                   ELSE
                      IF  (COMB-KOH1HKNNUM  NOT = SPACE)
                      OR  (COMB-KOH2HKNNUM  NOT = SPACE)
                      OR  (COMB-KOH3HKNNUM  NOT = SPACE)
                      OR  (COMB-KOH4HKNNUM  NOT = SPACE)
                        MOVE    "1"    TO   FLG-SYUHEN
                        IF   MAX-KIN-SYU-M   >  40200
                            MOVE   40200   TO   MAX-KIN-SYU-M
                        END-IF
                      END-IF
                   END-IF
                END-IF
      *
           END-IF.
      *
           IF  ( FLG-SANSHOU3        =   SPACE          )
           OR  ( LNK-SYU-SYUHKNNUM   =   "971" OR "973" )
                 CONTINUE
           ELSE
                 IF  FLG-SANSHOU3     =   "1"
                      MOVE   1       TO   FLG-SKJ
                 ELSE
                      MOVE   2       TO   FLG-SKJ
                 END-IF
           END-IF.
      *
       210-HOKEN-KAISU-EXT.
           EXIT.
      *
      ******************************************************************
      *        公費１（金額）取込み処理                                *
      ******************************************************************
       2103-KOH1-KAISU-SEC           SECTION.
      *
           EVALUATE   FLG-SANSHOU2
               WHEN   "1"
                        MOVE  HKN-HON-NYUMJGNGAK TO  MAX-KIN-KOHI1-M
               WHEN   "2"
                        MOVE  HKN-TSY-NYUMJGNGAK TO  MAX-KIN-KOHI1-M
               WHEN   "3"
                        MOVE  HKN-TNK-NYUMJGNGAK TO  MAX-KIN-KOHI1-M
           END-EVALUATE.
      *
           IF     COMB-KOH1HKNNUM    =     "027"
                        MOVE  HKN-HON-NYUMJGNGAK TO  MAX-KIN-KOHI1-M
           END-IF.
      *
           IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
           AND ( COMB-KOH1HKNNUM(1:1)        >=       "1"  )
           AND ( COMB-KOH1HKNNUM(1:1)        <=       "8"  )
              IF  (WK-1001-PREFNUM       NOT   =     20) 
              AND (MAX-KIN-KOHI1-M             >  40200)
                     MOVE    40200   TO    MAX-KIN-KOHI1-M
              END-IF
           END-IF.
      *
       2103-KOH1-KAISU-EXT.
           EXIT.
      ******************************************************************
      *        公費２（金額）取込み処理                                *
      ******************************************************************
       2104-KOH2-KAISU-SEC           SECTION.
      *
           EVALUATE   FLG-SANSHOU2
               WHEN   "1"
                        MOVE  HKN-HON-NYUMJGNGAK TO  MAX-KIN-KOHI2-M
               WHEN   "2"
                        MOVE  HKN-TSY-NYUMJGNGAK TO  MAX-KIN-KOHI2-M
               WHEN   "3"
                        MOVE  HKN-TNK-NYUMJGNGAK TO  MAX-KIN-KOHI2-M
           END-EVALUATE.
      *
           IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
           AND ( COMB-KOH2HKNNUM(1:1)        >=       "1"  )
           AND ( COMB-KOH2HKNNUM(1:1)        <=       "8"  )
              IF  (WK-1001-PREFNUM       NOT   =     20) 
              AND (MAX-KIN-KOHI2-M             >  40200)
                     MOVE    40200   TO    MAX-KIN-KOHI2-M
              END-IF
           END-IF.
      *
       2104-KOH2-KAISU-EXT.
           EXIT.
      ******************************************************************
      *        公費３（金額）取込み処理                                *
      ******************************************************************
       2105-KOH3-KAISU-SEC           SECTION.
      *
           EVALUATE   FLG-SANSHOU2
               WHEN   "1"
                        MOVE  HKN-HON-NYUMJGNGAK TO  MAX-KIN-KOHI3-M
               WHEN   "2"
                        MOVE  HKN-TSY-NYUMJGNGAK TO  MAX-KIN-KOHI3-M
               WHEN   "3"
                        MOVE  HKN-TNK-NYUMJGNGAK TO  MAX-KIN-KOHI3-M
           END-EVALUATE.
      *
           IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
           AND ( COMB-KOH3HKNNUM(1:1)        >=       "1"  )
           AND ( COMB-KOH3HKNNUM(1:1)        <=       "8"  )
              IF  (WK-1001-PREFNUM       NOT   =     20) 
              AND (MAX-KIN-KOHI3-M             >  40200)
                     MOVE    40200   TO    MAX-KIN-KOHI3-M
              END-IF
           END-IF.
      *
       2105-KOH3-KAISU-EXT.
           EXIT.
      ******************************************************************
      *        公費４（金額）取込み処理                                *
      ******************************************************************
       2106-KOH4-KAISU-SEC           SECTION.
      *
           EVALUATE   FLG-SANSHOU2
               WHEN   "1"
                        MOVE  HKN-HON-NYUMJGNGAK TO  MAX-KIN-KOHI4-M
               WHEN   "2"
                        MOVE  HKN-TSY-NYUMJGNGAK TO  MAX-KIN-KOHI4-M
               WHEN   "3"
                        MOVE  HKN-TNK-NYUMJGNGAK TO  MAX-KIN-KOHI4-M
           END-EVALUATE.
      *
           IF  ( LNK-S02-KOUREI-NYUIN-KBN     =       "1"  )
           AND ( COMB-KOH4HKNNUM(1:1)        >=       "1"  )
           AND ( COMB-KOH4HKNNUM(1:1)        <=       "8"  )
              IF  (WK-1001-PREFNUM       NOT   =     20) 
              AND (MAX-KIN-KOHI4-M             >  40200)
                     MOVE    40200   TO    MAX-KIN-KOHI4-M
              END-IF
           END-IF.
      *
       2106-KOH4-KAISU-EXT.
           EXIT.
      *
      ******************************************************************
      *        患者公費負担（金額）取込み処理                                *
      ******************************************************************
       2107-KOHFTN-KINGAKU-SEC           SECTION.
      *
           MOVE       ZERO        TO    WK-NYUJGNGAK
      *
           PERFORM    VARYING   KOH-IDX    FROM   1   BY   1
                      UNTIL    (KOH-IDX    >      4)
      *
             IF ( COMB-KOHHKNNUM(KOH-IDX)      = "015" OR "016" 
                                                       OR "012"      )
      *
             OR ((COMB-KOHHKNNUM(KOH-IDX)      = "051"   )  AND
                 (LNK-SYU-SRYYMD(1:6)         >= "200310")           )
      *
             OR ( COMB-KOHHKNNUM(KOH-IDX)(1:1) = "1" OR "2" OR "3" OR 
                                                 "4" OR "5" OR "6" OR
                                                 "7" OR "8"          )
      *
                INITIALIZE                           PTKOHFTN-REC
                MOVE    LNK-SYU-HOSPID       TO      PTKOHFTN-HOSPID
                MOVE    LNK-SYU-PTID         TO      PTKOHFTN-PTID
                MOVE    COMB-KOHID(KOH-IDX)  TO      PTKOHFTN-KOHID
                MOVE    PTKOHFTN-REC         TO      MCPDATA-REC
                MOVE    "DBSELECT"           TO      MCP-FUNC
                MOVE    "PTKOHFTN-KEY4"      TO      ORC-DBPATH
                CALL    "ORCMCPSUB"           USING   MCPAREA
                                                      ORCMCPAREA
                                                      MCPDATA-REC
                IF      MCP-RC               =       ZERO
                    MOVE    "PTKOHFTN-KEY4"  TO      ORC-DBPATH
                    PERFORM  PTKOHFTN-READ-SEC
                    PERFORM  UNTIL
                       ( FLG-PTKOHFTN                 =   1   )   OR
                       ((PTKOHFTN-TEKSTYMD(1:6)
                                  <=   LNK-SYU-SRYYMD   (1:6)) AND
                        (LNK-SYU-SRYYMD(1:6)
                                  <=   PTKOHFTN-TEKEDYMD(1:6)))
                      PERFORM   PTKOHFTN-READ-SEC
                    END-PERFORM
                ELSE
                    MOVE    1                TO      FLG-PTKOHFTN
                END-IF
      *
                IF   FLG-PTKOHFTN  =  ZERO
      *
      **>          IF  COMB-KOHHKNNUM(KOH-IDX) =  "015" OR "016"
      **>
      **>            IF  COMB-KOHHKNNUM(KOH-IDX) =  "015"
      **>              IF   LNK-SYU-SRYYMD(1:6)  =  
      **>                                     LNK-S02-KOSEI-YYMM(1)
      **>                MOVE  LNK-S02-KOSEI-NISUU(1)   TO   WK-DAY
      **>              END-IF
      **>              IF   LNK-SYU-SRYYMD(1:6)  =  
      **>                                     LNK-S02-KOSEI-YYMM(2)
      **>                MOVE  LNK-S02-KOSEI-NISUU(2)   TO   WK-DAY
      **>              END-IF
      **>            END-IF
      **>            IF  COMB-KOHHKNNUM(KOH-IDX) =  "016"
      **>              IF   LNK-SYU-SRYYMD(1:6)  =  
      **>                                     LNK-S02-IKUSEI-YYMM(1)
      **>                MOVE  LNK-S02-IKUSEI-NISUU(1)   TO   WK-DAY
      **>              END-IF
      **>              IF   LNK-SYU-SRYYMD(1:6)  =  
      **>                                     LNK-S02-IKUSEI-YYMM(2)
      **>                MOVE  LNK-S02-IKUSEI-NISUU(2)   TO   WK-DAY
      **>              END-IF
      **>            END-IF
      **>
      **>            INITIALIZE                       STS-AREA-DAY
      **>            INITIALIZE                       LNK-DAY7-AREA
      **>            MOVE   "71"                  TO  LNK-DAY7-IRAI
      **>            MOVE   LNK-SYU-SRYYMD(1:6)   TO  LNK-DAY7-YM
      **>            CALL   "ORCSDAY"         USING   STS-AREA-DAY
      **>                                             LNK-DAY7-AREA
      **>            MOVE   LNK-DAY7-KOYOMI       TO  WK-ENDYMD
      **>
      **>            IF    PTKOHFTN-NYUJGNGAK  =  ZERO
      **>            OR    PTKOHFTN-NYUJGNGAK  =  9999999
      **>                MOVE   PTKOHFTN-NYUJGNGAK TO  WK-NYUJGNGAK
      **>            ELSE
      **>              IF     WK-DAY   =   WK-ENDDD
      **>                MOVE   PTKOHFTN-NYUJGNGAK TO  WK-NYUJGNGAK
      **>              ELSE
      **>                COMPUTE  WK-NYUJGNGAK  =  PTKOHFTN-NYUJGNGAK
      **>                                       *  WK-DAY
      **>                COMPUTE  WK-NYUJGNGAK  =  WK-NYUJGNGAK
      **>                                       /  WK-ENDDD
      **>                COMPUTE  WK-NYUJGNGAK  =  WK-NYUJGNGAK
      **>                                       +   5
      **>                COMPUTE  WK-NYUJGNGAK  =  WK-NYUJGNGAK
      **>                                       /  10
      **>                COMPUTE  WK-NYUJGNGAK  =  WK-NYUJGNGAK
      **>                                       *  10
      **>              END-IF
      **>            END-IF
      **>
      **>            EVALUATE   KOH-IDX
      **>             WHEN  1
      **>               MOVE   WK-NYUJGNGAK  TO   MAX-KIN-KOHI1-M
      **>               MOVE     "1"   TO     COMB-KOH1-NYUJGNKBN
      **>             WHEN  2
      **>               MOVE   WK-NYUJGNGAK  TO   MAX-KIN-KOHI2-M
      **>               MOVE     "1"   TO     COMB-KOH2-NYUJGNKBN
      **>             WHEN  3
      **>               MOVE   WK-NYUJGNGAK  TO   MAX-KIN-KOHI3-M
      **>               MOVE     "1"   TO     COMB-KOH3-NYUJGNKBN
      **>             WHEN  4
      **>               MOVE   WK-NYUJGNGAK  TO   MAX-KIN-KOHI4-M
      **>               MOVE     "1"   TO     COMB-KOH4-NYUJGNKBN
      **>            END-EVALUATE
      **>
      **>          ELSE
      *
                     EVALUATE   KOH-IDX
                      WHEN  1
                        MOVE   PTKOHFTN-NYUJGNGAK  TO   MAX-KIN-KOHI1-M
                                                        WK-NYUJGNGAK
                        MOVE     "1"   TO     COMB-KOH1-NYUJGNKBN
                        IF   LNK-S02-KOUREI-NYUIN-KBN  =    "1" 
                          IF  ( WK-1001-PREFNUM        =     20)
                          AND ( COMB-KOH1HKNNUM(1:1)   >=   "1")
                          AND ( COMB-KOH1HKNNUM(1:1)   <=   "8")
                            CONTINUE
                          ELSE
                            IF    MAX-KIN-KOHI1-M    >  40200
                              MOVE    40200    TO   MAX-KIN-KOHI1-M
                            END-IF
                          END-IF
                        END-IF
                      WHEN  2
                        MOVE   PTKOHFTN-NYUJGNGAK  TO   MAX-KIN-KOHI2-M
                                                        WK-NYUJGNGAK
                        MOVE     "1"   TO     COMB-KOH2-NYUJGNKBN
                        IF   LNK-S02-KOUREI-NYUIN-KBN  =    "1" 
                          IF  ( WK-1001-PREFNUM        =     20)
                          AND ( COMB-KOH2HKNNUM(1:1)   >=   "1")
                          AND ( COMB-KOH2HKNNUM(1:1)   <=   "8")
                            CONTINUE
                          ELSE
                            IF    MAX-KIN-KOHI2-M    >  40200
                              MOVE    40200    TO   MAX-KIN-KOHI2-M
                            END-IF
                          END-IF
                        END-IF
                      WHEN  3
                        MOVE   PTKOHFTN-NYUJGNGAK  TO   MAX-KIN-KOHI3-M
                                                        WK-NYUJGNGAK
                        MOVE     "1"   TO     COMB-KOH3-NYUJGNKBN
                        IF   LNK-S02-KOUREI-NYUIN-KBN  =    "1" 
                          IF  ( WK-1001-PREFNUM        =     20)
                          AND ( COMB-KOH3HKNNUM(1:1)   >=   "1")
                          AND ( COMB-KOH3HKNNUM(1:1)   <=   "8")
                            CONTINUE
                          ELSE
                            IF    MAX-KIN-KOHI3-M    >  40200
                              MOVE    40200    TO   MAX-KIN-KOHI3-M
                            END-IF
                          END-IF
                        END-IF
                      WHEN  4
                        MOVE   PTKOHFTN-NYUJGNGAK  TO   MAX-KIN-KOHI4-M
                                                        WK-NYUJGNGAK
                        MOVE     "1"   TO     COMB-KOH4-NYUJGNKBN
                        IF   LNK-S02-KOUREI-NYUIN-KBN  =    "1" 
                          IF  ( WK-1001-PREFNUM        =     20)
                          AND ( COMB-KOH4HKNNUM(1:1)   >=   "1")
                          AND ( COMB-KOH4HKNNUM(1:1)   <=   "8")
                            CONTINUE
                          ELSE
                            IF    MAX-KIN-KOHI4-M    >  40200
                              MOVE    40200    TO   MAX-KIN-KOHI4-M
                            END-IF
                          END-IF
                        END-IF
                     END-EVALUATE
      *
      **>          END-IF
      *
                END-IF
      *
                MOVE    "DBCLOSE"            TO  MCP-FUNC
                MOVE    "PTKOHFTN-KEY4"      TO  ORC-DBPATH
                CALL    "ORCMCPSUB"           USING
                                              MCPAREA
                                              ORCMCPAREA
                                              MCPDATA-REC
      *
             END-IF
      *
           END-PERFORM.
      *
       2107-KOHFTN-KINGAKU-EXT.
           EXIT.
      *
      ******************************************************************
      *    診療月内の収納マスタから公費毎の患者負担金額の
      *    累計を調査
      ******************************************************************
       220-SYUNOU-SEC           SECTION.
      *
           IF  (COMB-KOH1-NYUJGNKBN       =       "1")      OR
               (COMB-KOH2-NYUJGNKBN       =       "1")      OR
               (COMB-KOH3-NYUJGNKBN       =       "1")      OR
               (COMB-KOH4-NYUJGNKBN       =       "1")      OR
               (LNK-S02-KOUREI-NYUIN-KBN  =       "1")
      *
               IF   LNK-S02-TEIKI-KBN     =   "X"
                 CONTINUE
               ELSE
                 INITIALIZE                         SYU-SYUNOU-REC
                 MOVE    LNK-SYU-HOSPID     TO      SYU-HOSPID
                 MOVE    LNK-SYU-NYUGAIKBN  TO      SYU-NYUGAIKBN
                 MOVE    LNK-SYU-PTID       TO      SYU-PTID
                 MOVE    LNK-SYU-SRYYMD(1:6)  TO    SYU-SRYYMD(1:6)
                 MOVE    "__"                 TO    SYU-SRYYMD(7:2)
                 MOVE    SYU-SYUNOU-REC     TO      MCPDATA-REC
                 MOVE    "DBSELECT"         TO      MCP-FUNC
                 MOVE    "SYUNOU-KEY14"     TO      ORC-DBPATH
                 CALL    "ORCMCPSUB"         USING   MCPAREA
                                                     ORCMCPAREA
                                                     MCPDATA-REC
                 IF      MCP-RC             =       ZERO
                   MOVE    "SYUNOU-KEY14"   TO      ORC-DBPATH
                   PERFORM  SYUNOU-READ-SEC
                   PERFORM  UNTIL  (FLG-SYUNOU   =    "1")
                     IF  SYU-DENPJTIKBN    NOT =  "3"
                      IF   LNK-SYU-SKYSTYMD    > SYU-SKYSTYMD
                             PERFORM        2201-SYUNOU-COUNT-SEC
                      END-IF
                     END-IF
                     MOVE           "SYUNOU-KEY14"   TO   ORC-DBPATH
                     PERFORM        SYUNOU-READ-SEC
                   END-PERFORM
                 ELSE
                   MOVE    12              TO        LNK-S02-RC
                 END-IF
      *
                 MOVE    "DBCLOSE"               TO  MCP-FUNC
                 MOVE    "SYUNOU-KEY14"          TO  ORC-DBPATH
                 CALL    "ORCMCPSUB"              USING
                                                  MCPAREA
                                                  ORCMCPAREA
                                                  MCPDATA-REC
               END-IF
      *
               PERFORM    VARYING   IDZ    FROM   1   BY   1
                           UNTIL  (IDZ    >    10)
                             OR   (LNK-WRK-SYU-SKYSTYMD(IDZ) =  SPACE)
      *
                  IF  LNK-SYU-SKYSTYMD(1:6) = 
                                   LNK-WRK-SYU-SKYSTYMD(IDZ)(1:6) 
                      MOVE    LNK-WRK-SYUNOU-REC(IDZ)  
                                             TO  SYU-SYUNOU-REC
                      PERFORM        2201-SYUNOU-COUNT-SEC
                  END-IF
      *
               END-PERFORM
      *
           END-IF.
      *
           IF     FLG-IRYOHI     =      1
             IF  WK-KOUREI-IRYOHI  >  361500
                COMPUTE WK-KOUREI-IRYOHI2 = 
                      (( WK-KOUREI-IRYOHI  -  361500 ) * 0.01 ) + 0.5
                COMPUTE  MAX-KIN-KOHI1-M  =   MAX-KIN-KOHI1-M 
                                          +   WK-KOUREI-IRYOHI2
                MOVE    1    TO    FLG-KOUGAKUCYO
             END-IF
           END-IF.
           IF     FLG-IRYOHI     =      2
             IF  WK-KOUREI-IRYOHI  >  361500
                COMPUTE WK-KOUREI-IRYOHI2 = 
                      (( WK-KOUREI-IRYOHI  -  361500 ) * 0.01 ) + 0.5
                COMPUTE  MAX-KIN-SYU-M    =   MAX-KIN-SYU-M 
                                          +   WK-KOUREI-IRYOHI2
                MOVE    1    TO    FLG-KOUGAKUCYO
             END-IF
           END-IF.
      *
       220-SYUNOU-EXT.
           EXIT.
      *
      ******************************************************************
      *        診療月の収納マスタから公費の金額カウント
      ******************************************************************
       2201-SYUNOU-COUNT-SEC          SECTION.
      *
           MOVE     ZERO     TO     FLG-KOUREI.                         
      *
           IF  LNK-S02-KOUREI-NYUIN-KBN   =   "1"
               IF ( SYU-SYUHKNNUM       =  "971" OR "973" )
               OR ( SYU-SYUHKNNUM(1:2)  =  "98"           )
      *
                 CONTINUE
      *
               ELSE
      *
                 IF COMB-KOH1HKNNUM      =    "027"                     
      *               COMPUTE  WK-SYU-SYUCOMPFTN  =                     
      *                                 SYU-KOH1COMPFTN    +   5        
      *               COMPUTE  WK-SYU-SYUCOMPFTN  =                     
      *                                 WK-SYU-SYUCOMPFTN  /  10        
      *               COMPUTE  WK-SYU-SYUCOMPFTN  =                     
      *                                 WK-SYU-SYUCOMPFTN  *  10        
      ***
                      IF   FLG-SYUHEN   =   "1"
                        IF  (SYU-KOH2HKNNUM     NOT = SPACE)              
                        OR  (SYU-KOH3HKNNUM     NOT = SPACE)
                        OR  (SYU-KOH4HKNNUM     NOT = SPACE)
                          ADD   SYU-KOH1COMPFTN   TO   FTN-KOHI1-M-HEN  
                        END-IF
                      END-IF
      ***
                      IF  (SYU-KOH2HKNNUM     NOT = SPACE)              
                      OR  (SYU-KOH3HKNNUM     NOT = SPACE)
                      OR  (SYU-KOH4HKNNUM     NOT = SPACE)
                        MOVE     SYU-KOH-FTN  TO  WK-SYU-SYUCOMPFTN   
      *
                        IF  FTN-KOH-XXX  <  40200                       
                            ADD  WK-SYU-SYUCOMPFTN  TO  FTN-KOH-XXX       
                            IF   FTN-KOH-XXX     >   40200                
                               MOVE   40200   TO   FTN-KOH-XXX            
                            END-IF                                        
                        END-IF
                      ELSE
                        IF  (SYU-KOH2HKNNUM     =  SPACE)              
                        AND (SYU-KOH3HKNNUM     =  SPACE)
                        AND (SYU-KOH4HKNNUM     =  SPACE)
                          MOVE   SYU-KOH1COMPFTN
                                            TO   WK-SYU-SYUCOMPFTN
      *
                          IF  ( COMB-KOH2HKNNUM        =    SPACE)
                          AND ( COMB-KOH3HKNNUM        =    SPACE)
                          AND ( COMB-KOH4HKNNUM        =    SPACE)
                             COMPUTE   WK-KOUREI-IRYOHI  =   
                                       WK-KOUREI-IRYOHI  +  
                                      (SYU-HKNTEN (12) * 10)
                          END-IF
                        END-IF
                      END-IF
                      ADD   WK-SYU-SYUCOMPFTN     TO   FTN-KOHI1-M      
                      MOVE  1                     TO   FLG-KOUREI       
                 ELSE                                                   
      *               COMPUTE  WK-SYU-SYUCOMPFTN  =                     
      *                                 SYU-SYUCOMPFTN     +   5        
      *               COMPUTE  WK-SYU-SYUCOMPFTN  =                     
      *                                 WK-SYU-SYUCOMPFTN  /  10        
      *               COMPUTE  WK-SYU-SYUCOMPFTN  =                     
      *                                 WK-SYU-SYUCOMPFTN  *  10        
      ***
                      IF   FLG-SYUHEN   =   "1"
                        IF  (SYU-KOH1HKNNUM     NOT = SPACE)              
                        OR  (SYU-KOH2HKNNUM     NOT = SPACE)
                        OR  (SYU-KOH3HKNNUM     NOT = SPACE)
                        OR  (SYU-KOH4HKNNUM     NOT = SPACE)
                          ADD   SYU-SYUCOMPFTN    TO   FTN-SYU-M-HEN  
                        END-IF
                      END-IF
      ***
                      IF  (SYU-KOH1HKNNUM     NOT = SPACE)              
                      OR  (SYU-KOH2HKNNUM     NOT = SPACE)
                      OR  (SYU-KOH3HKNNUM     NOT = SPACE)
                      OR  (SYU-KOH4HKNNUM     NOT = SPACE)
                        MOVE     SYU-KOH-FTN  TO  WK-SYU-SYUCOMPFTN 
      *
                        IF  FTN-KOH-XXX    <  40200                      
                            ADD  WK-SYU-SYUCOMPFTN  TO  FTN-KOH-XXX       
                            IF   FTN-KOH-XXX     >   40200                
                               MOVE   40200   TO   FTN-KOH-XXX            
                            END-IF                                        
                        END-IF
                      ELSE
                        IF  (SYU-KOH1HKNNUM     =  SPACE)              
                        AND (SYU-KOH2HKNNUM     =  SPACE)
                        AND (SYU-KOH3HKNNUM     =  SPACE)
                        AND (SYU-KOH4HKNNUM     =  SPACE)
                          MOVE   SYU-SYUCOMPFTN
                                            TO   WK-SYU-SYUCOMPFTN
      *
                          IF  ( COMB-KOH1HKNNUM        =    SPACE)
                          AND ( COMB-KOH2HKNNUM        =    SPACE)
                          AND ( COMB-KOH3HKNNUM        =    SPACE)
                          AND ( COMB-KOH4HKNNUM        =    SPACE)
                             COMPUTE   WK-KOUREI-IRYOHI  =   
                                       WK-KOUREI-IRYOHI  +  
                                      (SYU-HKNTEN (12) * 10)
                          END-IF
                        END-IF
                      END-IF
                      ADD   WK-SYU-SYUCOMPFTN     TO   FTN-SYU-M        
                 END-IF                                                 
      *
               END-IF
           END-IF.
      *
      *    公費１カウント
           IF  (COMB-KOH1HKNNUM               NOT =   SPACE)  AND
               (COMB-KOH1-NYUJGNKBN           =       "1"  )  AND
               (FLG-KOUREI                    =       ZERO )            
               IF        (LNK-SYU-KOH1HKNNUM  =  SYU-KOH1HKNNUM)   OR
                         (LNK-SYU-KOH1HKNNUM  =  SYU-KOH2HKNNUM)   OR
                         (LNK-SYU-KOH1HKNNUM  =  SYU-KOH3HKNNUM)   OR
                         (LNK-SYU-KOH1HKNNUM  =  SYU-KOH4HKNNUM)
                   EVALUATE  TRUE
                       WHEN  (LNK-SYU-KOH1HKNNUM = SYU-KOH1HKNNUM)
                             ADD   SYU-KOH1HKNFTNMONEY
                                                TO  FTN-KOHI1-M
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH1SKJ-FTN
                                                TO  FTN-KOHI1-M
                             END-IF
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI1-M2 =                  
                                        FTN-KOHI1-M2     +              
                                        SYU-KOH1COMPFTN  +              
                                        SYU-KOH1SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH1COMPFTN                    
                                                TO  FTN-KOHI1-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH1HKNNUM = SYU-KOH2HKNNUM)
                             ADD   SYU-KOH2HKNFTNMONEY
                                                TO  FTN-KOHI1-M
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH2SKJ-FTN
                                                TO  FTN-KOHI1-M
                             END-IF
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI1-M2 =                  
                                        FTN-KOHI1-M2     +              
                                        SYU-KOH2COMPFTN  +              
                                        SYU-KOH2SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH2COMPFTN                    
                                                TO  FTN-KOHI1-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH1HKNNUM = SYU-KOH3HKNNUM)
                             ADD   SYU-KOH3HKNFTNMONEY
                                                TO  FTN-KOHI1-M
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH3SKJ-FTN
                                                TO  FTN-KOHI1-M
                             END-IF
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI1-M2 =                  
                                        FTN-KOHI1-M2     +              
                                        SYU-KOH3COMPFTN  +              
                                        SYU-KOH3SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH3COMPFTN                    
                                                TO  FTN-KOHI1-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH1HKNNUM = SYU-KOH4HKNNUM)
                             ADD   SYU-KOH4HKNFTNMONEY
                                                TO  FTN-KOHI1-M
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH4SKJ-FTN
                                                TO  FTN-KOHI1-M
                             END-IF
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI1-M2 =                  
                                        FTN-KOHI1-M2     +              
                                        SYU-KOH4COMPFTN  +              
                                        SYU-KOH4SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH4COMPFTN                    
                                                TO  FTN-KOHI1-M2        
                             END-IF                                     
                   END-EVALUATE
               END-IF
           END-IF.
      *    公費２カウント
           IF  (COMB-KOH2HKNNUM               NOT = SPACE)   AND
               (COMB-KOH2-NYUJGNKBN           =     "1")     
               IF        (LNK-SYU-KOH2HKNNUM  =  SYU-KOH1HKNNUM)   OR
                         (LNK-SYU-KOH2HKNNUM  =  SYU-KOH2HKNNUM)   OR
                         (LNK-SYU-KOH2HKNNUM  =  SYU-KOH3HKNNUM)   OR
                         (LNK-SYU-KOH2HKNNUM  =  SYU-KOH4HKNNUM)
                   EVALUATE  TRUE
                       WHEN  (LNK-SYU-KOH2HKNNUM = SYU-KOH1HKNNUM)
                             ADD   SYU-KOH1HKNFTNMONEY
                                                TO  FTN-KOHI2-M
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH1SKJ-FTN
                                                TO  FTN-KOHI2-M
                             END-IF
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI2-M2 =                  
                                        FTN-KOHI2-M2     +              
                                        SYU-KOH1COMPFTN  +              
                                        SYU-KOH1SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH1COMPFTN                    
                                                TO  FTN-KOHI2-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH2HKNNUM = SYU-KOH2HKNNUM)
                             ADD   SYU-KOH2HKNFTNMONEY
                                                TO  FTN-KOHI2-M
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH2SKJ-FTN
                                                TO  FTN-KOHI2-M
                             END-IF
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI2-M2 =                  
                                        FTN-KOHI2-M2     +              
                                        SYU-KOH2COMPFTN  +              
                                        SYU-KOH2SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH2COMPFTN                    
                                                TO  FTN-KOHI2-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH2HKNNUM = SYU-KOH3HKNNUM)
                             ADD   SYU-KOH3HKNFTNMONEY
                                                TO  FTN-KOHI2-M
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH3SKJ-FTN
                                                TO  FTN-KOHI2-M
                             END-IF
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI2-M2 =                  
                                        FTN-KOHI2-M2     +              
                                        SYU-KOH3COMPFTN  +              
                                        SYU-KOH3SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH3COMPFTN                    
                                                TO  FTN-KOHI2-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH2HKNNUM = SYU-KOH4HKNNUM)
                             ADD   SYU-KOH4HKNFTNMONEY
                                                TO  FTN-KOHI2-M
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH4SKJ-FTN
                                                TO  FTN-KOHI2-M
                             END-IF
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI2-M2 =                  
                                        FTN-KOHI2-M2     +              
                                        SYU-KOH4COMPFTN  +              
                                        SYU-KOH4SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH4COMPFTN                    
                                                TO  FTN-KOHI2-M2        
                             END-IF                                     
                   END-EVALUATE
               END-IF
           END-IF.
      *    公費３カウント
           IF  (COMB-KOH3HKNNUM               NOT = SPACE)   AND
               (COMB-KOH3-NYUJGNKBN           =     "1")     
               IF        (LNK-SYU-KOH3HKNNUM  =  SYU-KOH1HKNNUM)   OR
                         (LNK-SYU-KOH3HKNNUM  =  SYU-KOH2HKNNUM)   OR
                         (LNK-SYU-KOH3HKNNUM  =  SYU-KOH3HKNNUM)   OR
                         (LNK-SYU-KOH3HKNNUM  =  SYU-KOH4HKNNUM)
                   EVALUATE  TRUE
                       WHEN  (LNK-SYU-KOH3HKNNUM = SYU-KOH1HKNNUM)
                             ADD   SYU-KOH1HKNFTNMONEY
                                                TO  FTN-KOHI3-M
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH1SKJ-FTN
                                                TO  FTN-KOHI3-M
                             END-IF
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI3-M2 =                  
                                        FTN-KOHI3-M2     +              
                                        SYU-KOH1COMPFTN  +              
                                        SYU-KOH1SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH1COMPFTN                    
                                                TO  FTN-KOHI3-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH3HKNNUM = SYU-KOH2HKNNUM)
                             ADD   SYU-KOH2HKNFTNMONEY
                                                TO  FTN-KOHI3-M
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH2SKJ-FTN
                                                TO  FTN-KOHI3-M
                             END-IF
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI3-M2 =                  
                                        FTN-KOHI3-M2     +              
                                        SYU-KOH2COMPFTN  +              
                                        SYU-KOH2SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH2COMPFTN                    
                                                TO  FTN-KOHI3-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH3HKNNUM = SYU-KOH3HKNNUM)
                             ADD   SYU-KOH3HKNFTNMONEY
                                                TO  FTN-KOHI3-M
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH3SKJ-FTN
                                                TO  FTN-KOHI3-M
                             END-IF
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI3-M2 =                  
                                        FTN-KOHI3-M2     +              
                                        SYU-KOH3COMPFTN  +              
                                        SYU-KOH3SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH3COMPFTN                    
                                                TO  FTN-KOHI3-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH3HKNNUM = SYU-KOH4HKNNUM)
                             ADD   SYU-KOH4HKNFTNMONEY
                                                TO  FTN-KOHI3-M
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH4SKJ-FTN
                                                TO  FTN-KOHI3-M
                             END-IF
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI3-M2 =                  
                                        FTN-KOHI3-M2     +              
                                        SYU-KOH4COMPFTN  +              
                                        SYU-KOH4SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH4COMPFTN                    
                                                TO  FTN-KOHI3-M2        
                             END-IF                                     
                   END-EVALUATE
               END-IF
           END-IF.
      *    公費４カウント
           IF  (COMB-KOH4HKNNUM               NOT = SPACE)   AND
               (COMB-KOH4-NYUJGNKBN           =     "1")     
               IF        (LNK-SYU-KOH4HKNNUM  =  SYU-KOH1HKNNUM)   OR
                         (LNK-SYU-KOH4HKNNUM  =  SYU-KOH2HKNNUM)   OR
                         (LNK-SYU-KOH4HKNNUM  =  SYU-KOH3HKNNUM)   OR
                         (LNK-SYU-KOH4HKNNUM  =  SYU-KOH4HKNNUM)
                   EVALUATE  TRUE
                       WHEN  (LNK-SYU-KOH4HKNNUM = SYU-KOH1HKNNUM)
                             ADD   SYU-KOH1HKNFTNMONEY
                                                TO  FTN-KOHI4-M
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH1SKJ-FTN
                                                TO  FTN-KOHI4-M
                             END-IF
                             IF    SYU-KOH1SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI4-M2 =                  
                                        FTN-KOHI4-M2     +              
                                        SYU-KOH1COMPFTN  +              
                                        SYU-KOH1SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH1COMPFTN                    
                                                TO  FTN-KOHI4-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH4HKNNUM = SYU-KOH2HKNNUM)
                             ADD   SYU-KOH2HKNFTNMONEY
                                                TO  FTN-KOHI4-M
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH2SKJ-FTN
                                                TO  FTN-KOHI4-M
                             END-IF
                             IF    SYU-KOH2SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI4-M2 =                  
                                        FTN-KOHI4-M2     +              
                                        SYU-KOH2COMPFTN  +              
                                        SYU-KOH2SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH2COMPFTN                    
                                                TO  FTN-KOHI4-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH4HKNNUM = SYU-KOH3HKNNUM)
                             ADD   SYU-KOH3HKNFTNMONEY
                                                TO  FTN-KOHI4-M
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH3SKJ-FTN
                                                TO  FTN-KOHI4-M
                             END-IF
                             IF    SYU-KOH3SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI4-M2 =                  
                                        FTN-KOHI4-M2     +              
                                        SYU-KOH3COMPFTN  +              
                                        SYU-KOH3SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH3COMPFTN                    
                                                TO  FTN-KOHI4-M2        
                             END-IF                                     
                       WHEN  (LNK-SYU-KOH4HKNNUM = SYU-KOH4HKNNUM)
                             ADD   SYU-KOH4HKNFTNMONEY
                                                TO  FTN-KOHI4-M
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"
                                ADD   SYU-KOH4SKJ-FTN
                                                TO  FTN-KOHI4-M
                             END-IF
                             IF    SYU-KOH4SKJ-FTNKBN  =  "2"           
                               COMPUTE  FTN-KOHI4-M2 =                  
                                        FTN-KOHI4-M2     +              
                                        SYU-KOH4COMPFTN  +              
                                        SYU-KOH4SKJ-FTN                 
                             ELSE                                       
                               ADD   SYU-KOH4COMPFTN                    
                                                TO  FTN-KOHI4-M2        
                             END-IF                                     
                   END-EVALUATE
               END-IF
           END-IF.
      *
       2201-SYUNOU-COUNT-EXT.
           EXIT.
      *
      ******************************************************************
      *    保険・公費の負担金計算
      ******************************************************************
       230-FTNKIN-SEC           SECTION.
      *
      *
      *    算定可能フラグの初期化
           MOVE     SPACE                  TO     FLG-SANTEI1
                                                  FLG-SANTEI2
                                                  FLG-SANTEI3
                                                  FLG-SANTEI4.
      *
      *    過去の患者保険負担累計額と上限金額の比較
      *
           IF   LNK-S02-KOUREI-NYUIN-KBN   =   "1"
               IF  MAX-KIN-SYU-M           NOT =  ZERO
                   IF  FTN-SYU-M           >=     MAX-KIN-SYU-M
                       MOVE  "1"           TO     FLG-SANTEI-SYU
                   END-IF
               END-IF
           END-IF.
           IF       MAX-KIN-KOHI1-M        NOT =  ZERO
               IF   FTN-KOHI1-M            >=     MAX-KIN-KOHI1-M
                    MOVE     "1"           TO     FLG-SANTEI1
               END-IF
           END-IF.
           IF       MAX-KIN-KOHI2-M        NOT =  ZERO
               IF   FTN-KOHI2-M            >=     MAX-KIN-KOHI2-M
                    MOVE     "1"           TO     FLG-SANTEI2
               END-IF
           END-IF.
           IF       MAX-KIN-KOHI3-M        NOT =  ZERO
               IF   FTN-KOHI3-M            >=     MAX-KIN-KOHI3-M
                    MOVE     "1"           TO     FLG-SANTEI3
               END-IF
           END-IF.
           IF       MAX-KIN-KOHI4-M        NOT =  ZERO
               IF   FTN-KOHI4-M            >=     MAX-KIN-KOHI4-M
                    MOVE     "1"           TO     FLG-SANTEI4
               END-IF
           END-IF.
      *
      *    保険（公費）テーブルの患者負担上限額と当月の患者負担累計額
      *    から算定可能残額を算出する
      *
           IF   LNK-S02-KOUREI-NYUIN-KBN   =   "1"
               IF  FLG-SANTEI-SYU            =   "1"                  
                       MOVE  ZERO        TO      ZAN-SYU-M            
               ELSE                                                   
                   IF  FTN-SYU-M         >=    MAX-KIN-SYU-M          
                       MOVE  ZERO        TO      ZAN-SYU-M
                   ELSE
                       COMPUTE  ZAN-SYU-M  =   MAX-KIN-SYU-M  -
                                               FTN-SYU-M
                   END-IF
               END-IF
           END-IF.
           IF  FLG-SANTEI1               =     "1"
               MOVE     ZERO             TO    ZAN-KOHI1-M
                                               ZAN-KOHI1-M2             
           ELSE
               IF (COMB-KOH1HKNNUM           NOT = SPACE)    AND
                  (COMB-KOH1-NYUJGNKBN       =     "1")
                   IF       MAX-KIN-KOHI1-M       NOT = ZERO
                       IF   FTN-KOHI1-M           >=  MAX-KIN-KOHI1-M
                            MOVE     ZERO         TO  ZAN-KOHI1-M
                       ELSE
                            COMPUTE  ZAN-KOHI1-M  =   MAX-KIN-KOHI1-M -
                                                      FTN-KOHI1-M
                       END-IF
                       IF  COMB-KOH1HKNNUM    =   "027"                 
                            MOVE     ZERO         TO  ZAN-KOHI1-M2      
                       ELSE                                             
                         IF   FTN-KOHI1-M2        >=  MAX-KIN-KOHI1-M   
                            MOVE     ZERO         TO  ZAN-KOHI1-M2      
                         ELSE                                           
                            COMPUTE  ZAN-KOHI1-M2 =   MAX-KIN-KOHI1-M - 
                                                      FTN-KOHI1-M2      
                         END-IF                                         
                       END-IF                                           
                   END-IF
               END-IF
           END-IF.
           IF  FLG-SANTEI2               =     "1"
               MOVE     ZERO             TO    ZAN-KOHI2-M
                                               ZAN-KOHI2-M2             
           ELSE
               IF (COMB-KOH2HKNNUM           NOT = SPACE)    AND
                  (COMB-KOH2-NYUJGNKBN       =     "1")
                   IF       MAX-KIN-KOHI2-M       NOT = ZERO
                       IF   FTN-KOHI2-M           >=  MAX-KIN-KOHI2-M
                            MOVE     ZERO         TO  ZAN-KOHI2-M
                       ELSE
                            COMPUTE  ZAN-KOHI2-M  =   MAX-KIN-KOHI2-M -
                                                      FTN-KOHI2-M
                       END-IF
                       IF   FTN-KOHI2-M2          >=  MAX-KIN-KOHI2-M   
                            MOVE     ZERO         TO  ZAN-KOHI2-M2      
                       ELSE                                             
                            COMPUTE  ZAN-KOHI2-M2 =   MAX-KIN-KOHI2-M - 
                                                      FTN-KOHI2-M2      
                       END-IF                                           
                   END-IF
               END-IF
           END-IF.
           IF  FLG-SANTEI3               =     "1"
               MOVE     ZERO             TO    ZAN-KOHI3-M
                                               ZAN-KOHI3-M2             
           ELSE
               IF (COMB-KOH3HKNNUM           NOT = SPACE)    AND
                  (COMB-KOH3-NYUJGNKBN       =     "1")
                   IF       MAX-KIN-KOHI3-M       NOT = ZERO
                       IF   FTN-KOHI3-M           >=  MAX-KIN-KOHI3-M
                            MOVE     ZERO         TO  ZAN-KOHI3-M
                       ELSE
                            COMPUTE  ZAN-KOHI3-M  =   MAX-KIN-KOHI3-M -
                                                      FTN-KOHI3-M
                       END-IF
                       IF   FTN-KOHI3-M2          >=  MAX-KIN-KOHI3-M   
                            MOVE     ZERO         TO  ZAN-KOHI3-M2      
                       ELSE                                             
                            COMPUTE  ZAN-KOHI3-M2 =   MAX-KIN-KOHI3-M - 
                                                      FTN-KOHI3-M2      
                       END-IF                                           
                   END-IF
               END-IF
           END-IF.
           IF  FLG-SANTEI4               =     "1"
               MOVE     ZERO             TO    ZAN-KOHI4-M
                                               ZAN-KOHI4-M2             
           ELSE
               IF (COMB-KOH4HKNNUM           NOT = SPACE)    AND
                  (COMB-KOH4-NYUJGNKBN       =     "1")
                   IF       MAX-KIN-KOHI4-M       NOT = ZERO
                       IF   FTN-KOHI4-M           >=  MAX-KIN-KOHI4-M
                            MOVE     ZERO         TO  ZAN-KOHI4-M
                       ELSE
                            COMPUTE  ZAN-KOHI4-M  =   MAX-KIN-KOHI4-M -
                                                      FTN-KOHI4-M
                       END-IF
                       IF   FTN-KOHI4-M2          >=  MAX-KIN-KOHI4-M   
                            MOVE     ZERO         TO  ZAN-KOHI4-M2      
                       ELSE                                             
                            COMPUTE  ZAN-KOHI4-M2 =   MAX-KIN-KOHI4-M - 
                                                      FTN-KOHI4-M2      
                       END-IF                                           
                   END-IF
               END-IF
           END-IF.
      *
      *    月の患者負担可能残額をセットする
           IF (COMB-KOH1HKNNUM              NOT = SPACE)    AND
              (COMB-KOH1-NYUJGNKBN          =     "1")
                   MOVE   ZAN-KOHI1-M     TO   ZAN-KOHI1
                   MOVE   ZAN-KOHI1-M2    TO   ZAN-KOHI12               
           END-IF.
      *
           IF (COMB-KOH2HKNNUM              NOT = SPACE)    AND
              (COMB-KOH2-NYUJGNKBN          =     "1")
                   MOVE   ZAN-KOHI2-M     TO   ZAN-KOHI2
                   MOVE   ZAN-KOHI2-M2    TO   ZAN-KOHI22               
           END-IF.
      *
           IF (COMB-KOH3HKNNUM              NOT = SPACE)    AND
              (COMB-KOH3-NYUJGNKBN          =     "1")
                   MOVE   ZAN-KOHI3-M     TO   ZAN-KOHI3
                   MOVE   ZAN-KOHI3-M2    TO   ZAN-KOHI32               
           END-IF.
      *
           IF (COMB-KOH4HKNNUM              NOT = SPACE)    AND
              (COMB-KOH4-NYUJGNKBN          =     "1")
                   MOVE   ZAN-KOHI4-M     TO   ZAN-KOHI4
                   MOVE   ZAN-KOHI4-M2    TO   ZAN-KOHI42               
           END-IF.
      *
      *    主保険負担金額の公費限度額対応用　残金額計算
           IF      FLG-SYUHEN   =   "1"
                PERFORM    2301-SYUHEN-ZANKIN-KEISAN-SEC
           END-IF.
      *
      *    食事療養費等の計算
           PERFORM       2300-SHOKUJI-KEISAN-SEC.
      *
      *    保険・公費毎の患者負担金額の計算
           IF    ((COMB-KOH1-HKNKOHSBTKBN    =   "3")    AND
                  (COMB-KOH1HKNNUM           =   "027")) OR 
                 ((COMB-KOH2-HKNKOHSBTKBN    =   "3")    AND
                  (COMB-KOH2HKNNUM           =   "027")) OR 
                 ((COMB-KOH3-HKNKOHSBTKBN    =   "3")    AND
                  (COMB-KOH3HKNNUM           =   "027")) OR 
                 ((COMB-KOH4-HKNKOHSBTKBN    =   "3")    AND
                  (COMB-KOH4HKNNUM           =   "027")) 
                  CONTINUE
           ELSE
               IF    COMB-HKNNUM             NOT =       SPACE
                  PERFORM    2301-SYUHOKEN-KEISAN-SEC
               END-IF
           END-IF.
      *
           MOVE     ZERO     TO     WK-TOKUTEI-COMPFTN3.
      *
           PERFORM    VARYING   KOH-IDX    FROM   1   BY   1
                      UNTIL    (KOH-IDX    >      4)
               IF   COMB-KOHHKNNUM(KOH-IDX)  NOT =  SPACE
                    PERFORM    2302-KOH-HKNREAD-SEC
                    IF   COMB-KOH-NYUJGNKBN(KOH-IDX)  =  "1"
                         PERFORM   2303-KOH-KEISAN-SEC
                    ELSE
                         PERFORM   2304-KOH-KEISAN-SEC
                    END-IF
               END-IF 
           END-PERFORM.
      *
      *     公費単位で計算した患者負担金額から最小の値を選択セット
            PERFORM   2314-FTNKIN-HIKAKU-SEC.
      *
       230-FTNKIN-EXT.
           EXIT.
      *
      ******************************************************************
      *        主保険負担金額の公費限度額対応用　残金額計算
      ******************************************************************
       2301-SYUHEN-ZANKIN-KEISAN-SEC           SECTION.
      *
      *    算定可能フラグの初期化
           MOVE     SPACE                  TO     FLG-SANTEI1-HEN
                                                  FLG-SANTEI-SYU-HEN.
      *
      *    過去の患者保険負担累計額と上限金額の比較
      *
           IF   COMB-KOH1HKNNUM      =    "027"
             IF       MAX-KIN-KOHI1-M        NOT =  ZERO
               IF   FTN-KOHI1-M-HEN        >=     MAX-KIN-KOHI1-M
                       MOVE     "1"       TO     FLG-SANTEI1-HEN
               END-IF
             END-IF
           END-IF.
      *
           IF         MAX-KIN-SYU-M          NOT =  ZERO
               IF  FTN-SYU-M-HEN           >=     MAX-KIN-SYU-M
                      MOVE  "1"           TO     FLG-SANTEI-SYU-HEN
               END-IF
           END-IF.
      *
      *    保険（公費）テーブルの患者負担上限額と当月の患者負担累計額
      *    から算定可能残額を算出する
      *
           IF  FLG-SANTEI1-HEN           =     "1"
               MOVE     ZERO             TO    ZAN-KOHI1-HEN
           ELSE
               IF  COMB-KOH1HKNNUM           =   "027"
                   IF       MAX-KIN-KOHI1-M       NOT = ZERO
                       COMPUTE  ZAN-KOHI1-HEN    =   MAX-KIN-KOHI1-M
                                                 -   FTN-KOHI1-M-HEN
                   END-IF
               END-IF
           END-IF.
      *
           IF  FLG-SANTEI-SYU-HEN        =     "1"
               MOVE     ZERO             TO    ZAN-SYU-M-HEN
           ELSE
               IF       MAX-KIN-SYU-M    NOT = ZERO
                     COMPUTE  ZAN-SYU-M-HEN  =   MAX-KIN-SYU-M
                                             -   FTN-SYU-M-HEN
               END-IF
           END-IF.
      *
       2301-SYUHEN-ZANKIN-KEISAN-EXT.
           EXIT.
      *
      ******************************************************************
      *        シス管・入院会計から食事療養費等の計算を行う            *
      ******************************************************************
       2300-SHOKUJI-KEISAN-SEC         SECTION.
      *
           INITIALIZE    WK-SHOKUJI-TAIHI-AREA 
                         WK-SHOKUDOKASAN-TABLE 
                         WK-GAIHAKU-TABLE
                         WK-ROSAITOKU-TABLE.   
      *
      *    システム管理マスタ（５０００）から食事情報取得
           INITIALIZE                         SYS-5000-REC.
           MOVE    "5000"               TO    SYS-5000-KANRICD.
           MOVE    "*"                  TO    SYS-5000-KBNCD.
           MOVE    LNK-SYU-SKYSTYMD     TO    ORC-DBYMD.
           MOVE    SYS-5000-REC         TO    MCPDATA-REC.
           MOVE    "DBSELECT"           TO    MCP-FUNC.
           MOVE    "SYSKANRI-KEY"       TO    ORC-DBPATH.
           CALL    "ORCMCPSUB"    USING       MCPAREA
                                              ORCMCPAREA
                                              MCPDATA-REC.
           IF      MCP-RC               =     ZERO
                   MOVE     "SYSKANRI-KEY"  TO    ORC-DBPATH
                   PERFORM   SYSKANRI-READ-SEC
                   IF    MCP-RC             =     ZERO
                     IF  SYS-5000-SHOKUJIRYOYOCD   =  "197000110"
                            MOVE     1       TO   WK-SHOKUJIRYOYO
                            IF  SYS-5000-SHOKUKBN(1) =  "1"
                               MOVE  ZERO    TO   WK-TOKUKANRIKASAN
                            ELSE
                               MOVE  1       TO   WK-TOKUKANRIKASAN
                            END-IF
                     ELSE
                            MOVE     2       TO   WK-SHOKUJIRYOYO
                     END-IF
                   END-IF 
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "SYSKANRI-KEY"       TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC.
      *
      *
      *    MOVE     ZERO                TO  WK-NISSU1
      *                                     WK-NISSU2.
      *
      *    INITIALIZE                   STS-AREA-DAY.
      *    INITIALIZE                   LNK-DAY5-AREA.
      *    MOVE    "51"                 TO  LNK-DAY5-IRAI.
      *    MOVE    LNK-S02-SKYSTYMD     TO  LNK-DAY5-START.
      *    MOVE    LNK-SYU-SKYSTYMD     TO  LNK-DAY5-END.
      *    CALL    "ORCSDAY"            USING   STS-AREA-DAY
      *                                         LNK-DAY5-AREA.
      *    IF      ( STS-DAY-RC1    =   ZERO )
      *        MOVE    LNK-DAY5-NISSU1  TO  WK-NISSU1
      *        MOVE    LNK-DAY5-NISSU2  TO  WK-NISSU2
      *    END-IF.
      *
      *
           INITIALIZE                            NYUINACCT-REC.
           MOVE    LNK-SYU-HOSPID        TO      NACCT-HOSPID.
           MOVE    LNK-SYU-NYUGAIKBN     TO      NACCT-NYUGAIKBN.
           MOVE    LNK-SYU-PTID          TO      NACCT-PTID.
      ***  MOVE    "00"                  TO      NACCT-SRYKA.
           MOVE    LNK-SYU-SKYSTYMD(1:6) TO      NACCT-SRYYM.
           MOVE    NYUINACCT-REC         TO      MCPDATA-REC.
           MOVE    "DBSELECT"            TO      MCP-FUNC.
           MOVE    "NYUINACCT-KEY7"      TO      ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC.
           IF      MCP-RC             =       ZERO
      *
               MOVE    "NYUINACCT-KEY7"  TO      ORC-DBPATH
               PERFORM  NYUINACCT-READ-SEC
               PERFORM  UNTIL  (FLG-NYUINACCT  =    "1")
      *
                 IF     NACCT-SRYCDTOTAL    =    197000570   
                             PERFORM        23001-SHOKUDOKASAN-TAIHI-SEC
                 END-IF
      *
                 IF     NACCT-ZAISKBKBN     =    "2"  
                             PERFORM        23001-GAIHAKU-TAIHI-SEC
                 END-IF
      *
                 MOVE          "NYUINACCT-KEY7"  TO   ORC-DBPATH
                 PERFORM        NYUINACCT-READ-SEC
               END-PERFORM
      *
           END-IF.
      *
           MOVE    "DBCLOSE"               TO  MCP-FUNC.
           MOVE    "NYUINACCT-KEY7"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"             USING
                                           MCPAREA
                                           ORCMCPAREA
                                           MCPDATA-REC.
      *
      *
           INITIALIZE                            SRYACCT-REC.
           MOVE    LNK-SYU-HOSPID        TO      ACCT-HOSPID.
           MOVE    LNK-SYU-NYUGAIKBN     TO      ACCT-NYUGAIKBN.
           MOVE    LNK-SYU-PTID          TO      ACCT-PTID.
           MOVE    LNK-SYU-SKYSTYMD(1:6) TO      ACCT-SRYYM.
           MOVE    SRYACCT-REC           TO      MCPDATA-REC.
           MOVE    "DBSELECT"            TO      MCP-FUNC.
           MOVE    "SRYACCT-KEY7"        TO      ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC.
           IF      MCP-RC             =       ZERO
      *
               MOVE    "SRYACCT-KEY7"    TO      ORC-DBPATH
               PERFORM  SRYACCT-READ-SEC
               PERFORM  UNTIL  (FLG-SRYACCT    =    "1")
      *
                 IF     ACCT-SRYCDTOTAL    =    197001210  OR
                                                197000470
                             PERFORM        23001-ROSAITOKU-TAIHI-SEC
                 END-IF
      *
                 MOVE     "SRYACCT-KEY7"   TO   ORC-DBPATH
                 PERFORM   SRYACCT-READ-SEC
               END-PERFORM
      *
           END-IF.
      *
           MOVE    "DBCLOSE"               TO  MCP-FUNC.
           MOVE    "SRYACCT-KEY7"          TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"             USING
                                           MCPAREA
                                           ORCMCPAREA
                                           MCPDATA-REC.
      *
      *
           INITIALIZE                            NYUINACCT-REC.
           MOVE    LNK-SYU-HOSPID        TO      NACCT-HOSPID.
           MOVE    LNK-SYU-NYUGAIKBN     TO      NACCT-NYUGAIKBN.
           MOVE    LNK-SYU-PTID          TO      NACCT-PTID.
      ***  MOVE    "00"                  TO      NACCT-SRYKA.
           MOVE    LNK-SYU-SKYSTYMD(1:6) TO      NACCT-SRYYM.
           MOVE    NYUINACCT-REC         TO      MCPDATA-REC.
           MOVE    "DBSELECT"            TO      MCP-FUNC.
           MOVE    "NYUINACCT-KEY7"      TO      ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING   MCPAREA
                                                 ORCMCPAREA
                                                 MCPDATA-REC.
           IF      MCP-RC             =       ZERO
      *
               MOVE    "NYUINACCT-KEY7"  TO      ORC-DBPATH
               PERFORM  NYUINACCT-READ-SEC
               PERFORM  UNTIL  (FLG-NYUINACCT  =    "1")
      *
                 IF     NACCT-SRYCDTOTAL    =    099999913   
                             PERFORM        23001-SHOKUJI-COUNT-SEC
                 END-IF
      * 
                 MOVE          "NYUINACCT-KEY7"  TO   ORC-DBPATH
                 PERFORM        NYUINACCT-READ-SEC
               END-PERFORM
      *
           END-IF.
      *
           MOVE    "DBCLOSE"               TO  MCP-FUNC.
           MOVE    "NYUINACCT-KEY7"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"             USING
                                           MCPAREA
                                           ORCMCPAREA
                                           MCPDATA-REC.
      *
           IF   LNK-SYU-SHOKUJI1-NISSU      =  ZERO
           AND  LNK-SYU-SHOKUJI2-NISSU  NOT =  ZERO
      *
             MOVE  LNK-SYU-SHOKUJI2-NISSU  TO  LNK-SYU-SHOKUJI1-NISSU
             MOVE  LNK-SYU-SHOKUJI2        TO  LNK-SYU-SHOKUJI1
      *
             MOVE  ZERO                    TO  LNK-SYU-SHOKUJI2-NISSU
             MOVE  ZERO                    TO  LNK-SYU-SHOKUJI2
      *
           END-IF.
      *
       2300-SHOKUJI-KEISAN-EXT.
           EXIT.
      *
      ******************************************************************
      *        食堂加算退避                                            *
      ******************************************************************
       23001-SHOKUDOKASAN-TAIHI-SEC         SECTION.
      *
           PERFORM    VARYING   IDY   FROM   1   BY   1
                                    UNTIL    IDY    >    31
      *
             IF       NACCT-DAY(IDY)   NOT =  ZERO 
                    MOVE   NACCT-DAY(IDY)  TO   WK-SHOKUDOKASAN(IDY) 
             END-IF
      *
           END-PERFORM.
      *
       23001-SHOKUDOKASAN-TAIHI-EXT.
           EXIT.
      *
      ******************************************************************
      *        外泊退避                                            *
      ******************************************************************
       23001-GAIHAKU-TAIHI-SEC         SECTION.
      *
           PERFORM    VARYING   IDY   FROM   1   BY   1
                                    UNTIL    IDY    >    31
      *
             IF       NACCT-DAY(IDY)   NOT =  ZERO 
                    MOVE   NACCT-DAY(IDY)  TO   WK-GAIHAKU(IDY) 
             END-IF
      *
           END-PERFORM.
      *
       23001-GAIHAKU-TAIHI-EXT.
           EXIT.
      *
      ******************************************************************
      *        労災入院中の特別食加算退避                              *
      ******************************************************************
       23001-ROSAITOKU-TAIHI-SEC         SECTION.
      *
           PERFORM    VARYING   IDY   FROM   1   BY   1
                                    UNTIL    IDY    >    31
      *
             IF   ACCT-SRYKBN   =   "95"  
                IF       ACCT-DAY(1 IDY)   NOT =  ZERO 
                    MOVE   ACCT-DAY(1 IDY)  TO   WK-ROSAITOKU95(IDY) 
                END-IF
             END-IF
      *
             IF   ACCT-SRYKBN   =   "96"  
                IF       ACCT-DAY(1 IDY)   NOT =  ZERO 
                    MOVE   ACCT-DAY(1 IDY)  TO   WK-ROSAITOKU96(IDY) 
                END-IF
             END-IF
      *
             IF   ACCT-SRYKBN   =   "97"
                IF       ACCT-DAY(1 IDY)   NOT =  ZERO 
                    MOVE   ACCT-DAY(1 IDY)  TO   WK-ROSAITOKU97(IDY) 
                END-IF
             END-IF
      *
           END-PERFORM.
      *
       23001-ROSAITOKU-TAIHI-EXT.
           EXIT.
      *
      ******************************************************************
      *        食事療養費等の計算                                       *
      ******************************************************************
       23001-SHOKUJI-COUNT-SEC         SECTION.
      *
      *    ADD        WK-NISSU1   TO    WK-SEIKYUKIKAN-NISSU. 
      *
           MOVE       LNK-SYU-SKYSTYMD(7:2)  TO   IDX-ST.
           MOVE       LNK-SYU-SKYEDYMD(7:2)  TO   IDX-ED.
      *
           PERFORM    VARYING   IDY   FROM   IDX-ST   BY   1
                                    UNTIL    IDY     >    IDX-ED
      *
      *      COMPUTE  WK-SEIKYUKIKAN-NISSU  =  WK-SEIKYUKIKAN-NISSU 
      *                                     +  1
      *
             MOVE     ZERO     TO      WK-SHOKUJI-JIHI
      *
             IF       ( NACCT-DAY(IDY)   NOT =  ZERO )
             AND      ( LNK-SYU-DAY(IDY)     =  "1"  )
             AND      ( WK-GAIHAKU(IDY)      =  ZERO  OR  4 )
      *
              IF  WK-SHOKUDOKASAN(IDY)  =  ZERO
      *
                EVALUATE   NACCT-DAY(IDY)
                  WHEN  1
                      EVALUATE   WK-SHOKUJIRYOYO
                        WHEN  1
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI1-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI1
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI1
                            END-IF
                          END-IF
                        WHEN  2
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI1-NISSU
      *                   入院時食事療養（２）
                          MOVE  "197000710"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI1
                          END-IF
                      END-EVALUATE
                  WHEN  2
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI1-NISSU
                                              LNK-SYU-SHOKUJI3-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI1
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI1
                            END-IF
                          END-IF
      *                   特別食加算
                          MOVE  "197000470"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI3
                          END-IF
                  WHEN  3
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI1-NISSU
                                              LNK-SYU-SHOKUJI4-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI1
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI1
                            END-IF
                          END-IF
      *                   複数献立加算
                          MOVE  "197000670"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI4
                          END-IF
                  WHEN  4
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI1-NISSU
                                              LNK-SYU-SHOKUJI3-NISSU
                                              LNK-SYU-SHOKUJI4-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI1
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI1
                            END-IF
                          END-IF
      *                   特別食加算
                          MOVE  "197000470"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI3
                          END-IF
      *                   複数献立加算
                          MOVE  "197000670"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI4
                          END-IF
                END-EVALUATE
      *
              ELSE
      *
                EVALUATE   NACCT-DAY(IDY)
                  WHEN  1
                      EVALUATE   WK-SHOKUJIRYOYO
                        WHEN  1
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI2-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                            END-IF
                          END-IF
      *                   食堂加算
                          MOVE  "197000570"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
                        WHEN  2
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI1-NISSU
      *                   入院時食事療養（２）
                          MOVE  "197000710"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI1
                          END-IF
                      END-EVALUATE
                  WHEN  2
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI2-NISSU
                                              LNK-SYU-SHOKUJI3-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                            END-IF
                          END-IF
      *                   食堂加算
                          MOVE  "197000570"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
      *                   特別食加算
                          MOVE  "197000470"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI3
                          END-IF
                  WHEN  3
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI2-NISSU
                                              LNK-SYU-SHOKUJI4-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                            END-IF
                          END-IF
      *                   食堂加算
                          MOVE  "197000570"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
      *                   複数献立加算
                          MOVE  "197000670"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI4
                          END-IF
                  WHEN  4
      *
                          ADD       1    TO   WK-SHOKUJI-NISSU
                                              LNK-SYU-SHOKUJI2-NISSU
                                              LNK-SYU-SHOKUJI3-NISSU
                                              LNK-SYU-SHOKUJI4-NISSU
      *                   入院時食事療養（１）
                          MOVE  "197000110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
      *                   特別管理加算
                          IF    WK-TOKUKANRIKASAN  =  1
                            MOVE  "197000270"    TO   WK-SRYCD
                            PERFORM    TENSU-TBL-SEC
                            IF       FLG-TENSU      =    ZERO
                               ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                      WK-SHOKUJI-JIHI
                               ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                            END-IF
                          END-IF
      *                   食堂加算
                          MOVE  "197000570"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             ADD     WK-KEISAN TO   LNK-SYU-SHOKUJI2
                          END-IF
      *                   特別食加算
                          MOVE  "197000470"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI3
                          END-IF
      *                   複数献立加算
                          MOVE  "197000670"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     WK-KEISAN TO   WK-SHOKUJI-RYOYOHI
                                                    WK-SHOKUJI-JIHI
                             MOVE    WK-KEISAN TO   LNK-SYU-SHOKUJI4
                          END-IF
                END-EVALUATE
      *
              END-IF
      *
              IF   ( COMB-SYU-HKNKOHSBTKBN   =   "8"            )
              OR   ( COMB-HKNNUM             =  "971"  OR  "973")
                ADD   WK-SHOKUJI-JIHI    TO   WK-SHOKUJI-FTN
              ELSE
                EVALUATE   FLG-SKJ
                  WHEN  0
      *                   標準負担額（一般）
                          MOVE  "197000810"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     TNS-TEN   TO   WK-SHOKUJI-FTN
                          END-IF
                  WHEN  1
      *                   標準負担額（低１）
                          MOVE  "197001110"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     TNS-TEN   TO   WK-SHOKUJI-FTN
                          END-IF
                  WHEN  2
      *             COMPUTE   WK-TSUSAN-NISSU  =  
      *                                 LNK-S02-NYUIN-TSUSAN-NISSU  +
      *                                 WK-SEIKYUKIKAN-NISSU
      *             IF        WK-TSUSAN-NISSU  <=  90
      *                   ADD     650    TO   WK-SHOKUJI-FTN
      *             ELSE
      *                   ADD     500    TO   WK-SHOKUJI-FTN
      *             END-IF
                    IF    WRK-SKJGNSTYMD-S   NOT  =   SPACE
                       MOVE   LNK-SYU-SKYSTYMD(1:6) 
                                         TO  WRK-SKJGNSTYYMM2
                       MOVE   IDY        TO  WRK-SKJGNSTDD2
                       IF   WRK-SKJGNSTYMD-S  <=  WRK-SKJGNSTYMD2
                       AND  WRK-SKJGNSTYMD-E  >=  WRK-SKJGNSTYMD2 
      *                   標準負担額（低２・９０日超）
                          MOVE  "197001010"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     TNS-TEN   TO   WK-SHOKUJI-FTN
                          END-IF
                       ELSE
      *                   標準負担額（低２・９０日以下）
                          MOVE  "197000910"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     TNS-TEN   TO   WK-SHOKUJI-FTN
                          END-IF
                       END-IF
                    ELSE
      *                   標準負担額（低２・９０日以下）
                          MOVE  "197000910"    TO   WK-SRYCD
                          PERFORM    TENSU-TBL-SEC
                          IF       FLG-TENSU      =    ZERO
                             ADD     TNS-TEN   TO   WK-SHOKUJI-FTN
                          END-IF
                    END-IF    
                END-EVALUATE
              END-IF
      *
             END-IF
      *
             IF       ( WK-ROSAITOKU95(IDY)  NOT =  ZERO       )
             AND      ( LNK-SYU-DAY(IDY)         =  "1" OR "2" )
      *
      *         標準負担額（労災入院中）
                MOVE  "197001210"    TO   WK-SRYCD
                PERFORM    TENSU-TBL-SEC
                IF       FLG-TENSU      =    ZERO
                   ADD     TNS-TEN   TO   WK-SHOKUJI-RYOYOHI95
                                          WK-SHOKUJI-FTN95
                END-IF
      *
             END-IF
      *
             IF       ( WK-ROSAITOKU96(IDY)  NOT =  ZERO       )
             AND      ( LNK-SYU-DAY(IDY)         =  "1" OR "2" )
      *
      *         標準負担額（労災入院中）
                MOVE  "197001210"    TO   WK-SRYCD
                PERFORM    TENSU-TBL-SEC
                IF       FLG-TENSU      =    ZERO
                   ADD     TNS-TEN   TO   WK-SHOKUJI-RYOYOHI96
                                          WK-SHOKUJI-FTN96
                END-IF
      *
             END-IF
      *
             MOVE     ZERO     TO      WK-SHOKUJI-JIHI
      *
             IF       ( WK-ROSAITOKU97(IDY)  NOT =  ZERO       )
             AND      ( LNK-SYU-DAY(IDY)         =  "1" OR "2" )
      *
                ADD       1    TO   WK-SHOKUJI-NISSU
                                    LNK-SYU-SHOKUJI3-NISSU
      *         標準負担額（労災入院中）
                MOVE  "197001210"    TO   WK-SRYCD
                PERFORM    TENSU-TBL-SEC
                IF       FLG-TENSU      =    ZERO
                   ADD     TNS-TEN   TO   WK-SHOKUJI-RYOYOHI
                                          WK-SHOKUJI-JIHI
                   MOVE    TNS-TEN   TO   LNK-SYU-SHOKUJI3
                END-IF
      *
                IF  COMB-SYU-HKNKOHSBTKBN   =   "8"
                  ADD   WK-SHOKUJI-JIHI    TO   WK-SHOKUJI-FTN
                END-IF
      *
             END-IF
      *
           END-PERFORM.
      *
       23001-SHOKUJI-COUNT-EXT.
           EXIT.
      *
      ******************************************************************
      *        主保険の患者負担金額計算                                *
      ******************************************************************
       2301-SYUHOKEN-KEISAN-SEC           SECTION.
      *
      *    該当保険番号テーブルの検索
           INITIALIZE                      HKNNUM-REC.
           MOVE   COMB-HOSPID        TO    HKN-HOSPID.
           MOVE   COMB-HKNNUM        TO    HKN-HKNNUM.
           MOVE   "00"               TO    WK-PAYKBN.
           MOVE   HKNNUM-REC         TO    MCPDATA-REC.
           MOVE   "DBSELECT"         TO    MCP-FUNC.
           MOVE   "HKNNUM-KEY2"      TO    ORC-DBPATH.
           CALL   "ORCMCPSUB"         USING MCPAREA
                                            ORCMCPAREA
                                            MCPDATA-REC.
           IF      MCP-RC            =     ZERO
               MOVE    "HKNNUM-KEY2" TO    ORC-DBPATH
               PERFORM  HKNNUM-READ-SEC
               PERFORM  UNTIL
                 (FLG-HKNNUM     =    1)                       OR
                ((HKN-TEKSTYMD(1:6)     <=  LNK-SYU-SKYSTYMD(1:6)) AND
                 (LNK-SYU-SKYSTYMD(1:6) <=  HKN-TEKEDYMD(1:6))     AND
                 (WK-PAYKBN            =  HKN-PAYKBN))
                   PERFORM   HKNNUM-READ-SEC
               END-PERFORM
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "HKNNUM-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
      *
      *    保険組合せテーブルの補助区分から患者の負担割合を保険番号
      *    テーブルに再セット（国保のみ）
           IF    COMB-HKNNUM           =    "060"
               EVALUATE   COMB-HOJOKBN
                   WHEN   "0"
                          MOVE   ZERO      TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
                   WHEN   "1"
                          MOVE   10        TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
                   WHEN   "2"
                          MOVE   20        TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
                   WHEN   "3"
                          MOVE   30        TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
               END-EVALUATE
      *    健保の高齢者についても補助区分より負担割合セット
           ELSE
               EVALUATE   COMB-HOJOKBN
                   WHEN   "9"
                          MOVE   10        TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
                   WHEN   "8"
                          MOVE   20        TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
               END-EVALUATE
           END-IF.
      *
      *    年齢３歳未満
           INITIALIZE                           PTINF-REC
           MOVE    LNK-SYU-HOSPID       TO      PTINF-HOSPID
           MOVE    LNK-SYU-PTID         TO      PTINF-PTID
           MOVE    PTINF-REC            TO      MCPDATA-REC
           MOVE    "DBSELECT"           TO      MCP-FUNC
           MOVE    "PTINF-KEY"          TO      ORC-DBPATH
           CALL    "ORCMCPSUB"          USING   MCPAREA
                                                ORCMCPAREA
                                                MCPDATA-REC
           IF      MCP-RC               =       ZERO
               MOVE    "PTINF-KEY"      TO      ORC-DBPATH
               PERFORM  PTINF-READ-SEC
               IF       MCP-RC          =       ZERO
                    MOVE   PTINF-BIRTHDAY   TO  WRK-YMDS1
                    MOVE   LNK-SYU-SKYSTYMD TO  WRK-YMDS2
                    MOVE   ZERO             TO  WRK-NENREI
                    COMPUTE  WRK-NENREI     =   WRK-YYS2
                                            -   WRK-YYS1
                    IF   WRK-YMDS1(5:4)     >   WRK-YMDS2(5:4)
                         ADD   -1           TO  WRK-NENREI
                    END-IF
                    IF   WRK-NENREI         =   3
                    AND  WRK-YMDS1(5:4)    <=   WRK-YMDS2(5:4)
                        IF    WRK-YMDS1(5:2)  = WRK-YMDS2(5:2)
                             IF   WRK-YMDS1(7:2)  NOT = "01"
                                   ADD   -1     TO  WRK-NENREI
                              END-IF
                        END-IF
                    END-IF
               ELSE
                    DISPLAY  "PTINF FETCH ERR"
                    MOVE     ZERO   TO      WRK-NENREI
               END-IF
           ELSE
               DISPLAY   "PTINF SELECT ERR"
               MOVE     ZERO   TO      WRK-NENREI
           END-IF
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC
           MOVE    "PTINF-KEY"          TO  ORC-DBPATH
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
      *
           IF      WRK-NENREI         <     3
               IF   COMB-HKNNUM       =     "060"
                   IF   COMB-HOJOKBN  =     "0"  OR  "1"
                       CONTINUE
                   ELSE
                       MOVE   20      TO   HKN-HON-NYUKFTNRATE
                                           HKN-KZK-NYUKFTNRATE
                                           HKN-TSY-NYUKFTNRATE
                                           HKN-TNK-NYUKFTNRATE
                   END-IF
               ELSE
                   IF    HKN-HKNKOHSBTKBN  =  "1" 
                       MOVE   20      TO   HKN-HON-NYUKFTNRATE
                                           HKN-KZK-NYUKFTNRATE
                                           HKN-TSY-NYUKFTNRATE
                                           HKN-TNK-NYUKFTNRATE
                   END-IF 
               END-IF
           END-IF.
      *
      *    保険組合せテーブルの補助区分から患者の負担割合を保険番号
      *    テーブルに再セット（船員保険時）
           IF    COMB-HKNNUM           =    "002"
               EVALUATE   COMB-HOJOKBN
                   WHEN   "1"
                   WHEN   "2"
                   WHEN   "3"
                   WHEN   "A"
                   WHEN   "B"
                   WHEN   "C"
                   WHEN   "D"
                   WHEN   "E"
                   WHEN   "F"
                       IF   LNK-S02-SENINFLG  NOT =    "1"
                          MOVE   ZERO      TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
                       END-IF
      *
                       MOVE      "0"       TO   HKN-HON-NYUSKJRYYKBN
                                                HKN-KZK-NYUSKJRYYKBN
                                                HKN-TSY-NYUSKJRYYKBN
                                                HKN-TNK-NYUSKJRYYKBN
               END-EVALUATE
           END-IF.
      *    保険組合せテーブルの補助区分から患者の負担割合を保険番号
      *    テーブルに再セット（共済組合保険時）
           IF    COMB-HKNNUM    =    "031" OR "032" OR "033" OR "034"
               EVALUATE   COMB-HOJOKBN
                   WHEN   "2"
                   WHEN   "B"
                   WHEN   "E"
                          MOVE   ZERO      TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
      *
                          MOVE   "0"       TO   HKN-HON-NYUSKJRYYKBN
                                                HKN-KZK-NYUSKJRYYKBN
                                                HKN-TSY-NYUSKJRYYKBN
                                                HKN-TNK-NYUSKJRYYKBN
               END-EVALUATE
           END-IF.
      *
      *    （ＷＫ−ＨＫＮＫＢＮ　空白：医保　１：労災・自賠）
           EVALUATE   WK-HKNKBN
             WHEN   SPACE
      *    負担金額の計算
      ***      EVALUATE   FLG-SANSHOU
      ***        WHEN   "1"
                   IF   COMB-HONKZKKBN        =   "1"
                        IF    HKN-HON-NYUKFTNRATE     NOT =    ZERO
                              COMPUTE   WK-FUTANWARI  =
                                        HKN-HON-NYUKFTNRATE  /  100
                              COMPUTE   LNK-SYU-SYUCOMPFTN  =
                                        WK-ZENGAKU   *  WK-FUTANWARI
                              IF   LNK-S02-SENINFLG    =  "1"           
                                IF LNK-SYU-SYUCOMPFTN  >  200           
                                   MOVE   200  TO  LNK-SYU-SYUCOMPFTN   
                                END-IF                                  
                              END-IF                                    
                              MOVE      LNK-SYU-SYUCOMPFTN
                                                 TO WK-TOKUTEI-COMPFTN2
                              COMPUTE   LNK-SYU-SYUCOMPFTN =
                                        LNK-SYU-SYUCOMPFTN  +  5
                              COMPUTE   WK-FTN      =
                                        LNK-SYU-SYUCOMPFTN  /  10
                              COMPUTE   LNK-SYU-SYUCOMPFTN =
                                        WK-FTN   *  10
                        END-IF
      *
                        IF   LNK-S02-KOUREI-NYUIN-KBN   =   "1"
                            IF  FLG-SYUHEN   =   "1"
                              IF  ZAN-SYU-M-HEN  <  LNK-SYU-SYUCOMPFTN 
                                MOVE ZAN-SYU-M-HEN
                                                 TO  WK-HEN-SYUCOMPFTN 
                              ELSE                                     
                                MOVE LNK-SYU-SYUCOMPFTN                
                                                 TO  WK-HEN-SYUCOMPFTN 
                              END-IF
                            END-IF
                            IF  ZAN-SYU-M     <     WK-TOKUTEI-COMPFTN2 
                                MOVE ZAN-SYU-M   TO  LNK-SYU-SYUCOMPFTN
                                                     WK-TOKUTEI-COMPFTN 
                            ELSE                                        
                                MOVE WK-TOKUTEI-COMPFTN2                
                                                 TO  WK-TOKUTEI-COMPFTN 
                            END-IF
                        ELSE
                                MOVE WK-TOKUTEI-COMPFTN2                
                                                 TO  WK-TOKUTEI-COMPFTN 
                        END-IF
                        COMPUTE   LNK-SYU-SYUCOMPTOTAL   =
                                  LNK-SYU-SYUCOMPFTN     
                        MOVE  HKN-HON-NYUSKJRYYKBN
                                             TO   LNK-SYU-SYUSKJ-FTNKBN
                        MOVE  WK-SHOKUJI-NISSU
                                             TO   LNK-SYU-SYUSKJ-NISSU
                        MOVE  WK-SHOKUJI-RYOYOHI
                                             TO   LNK-SYU-SYUSKJ-RYOYOHI
                        IF    HKN-HON-NYUSKJRYYKBN  NOT =  "0"
                            IF    HKN-HON-NYUSKJRYYKBN  NOT =  "3"
                              MOVE  WK-SHOKUJI-FTN
                                             TO   LNK-SYU-SYUSKJ-FTN
                            END-IF
                            MOVE  WK-SHOKUJI-FTN
                                            TO   LNK-SYU-SYUSKJ-FTN-RECE
                        END-IF
                   ELSE
                        IF    HKN-KZK-NYUKFTNRATE     NOT =    ZERO
                              COMPUTE   WK-FUTANWARI  =
                                        HKN-KZK-NYUKFTNRATE  /  100
                              COMPUTE   LNK-SYU-SYUCOMPFTN  =
                                        WK-ZENGAKU   *  WK-FUTANWARI
                              MOVE      LNK-SYU-SYUCOMPFTN
                                                 TO WK-TOKUTEI-COMPFTN2
                              COMPUTE   LNK-SYU-SYUCOMPFTN =
                                        LNK-SYU-SYUCOMPFTN  +  5
                              COMPUTE   WK-FTN      =
                                        LNK-SYU-SYUCOMPFTN  /  10
                              COMPUTE   LNK-SYU-SYUCOMPFTN =
                                        WK-FTN   *  10
                        END-IF
      *
                        IF   LNK-S02-KOUREI-NYUIN-KBN   =   "1"
                            IF  FLG-SYUHEN   =   "1"
                              IF  ZAN-SYU-M-HEN  <  LNK-SYU-SYUCOMPFTN 
                                MOVE ZAN-SYU-M-HEN
                                                 TO  WK-HEN-SYUCOMPFTN 
                              ELSE                                     
                                MOVE LNK-SYU-SYUCOMPFTN                
                                                 TO  WK-HEN-SYUCOMPFTN 
                              END-IF
                            END-IF
                            IF  ZAN-SYU-M     <     WK-TOKUTEI-COMPFTN2 
                                MOVE ZAN-SYU-M   TO  LNK-SYU-SYUCOMPFTN
                                                     WK-TOKUTEI-COMPFTN 
                            ELSE                                        
                                MOVE WK-TOKUTEI-COMPFTN2                
                                                 TO  WK-TOKUTEI-COMPFTN 
                            END-IF
                        ELSE
                                MOVE WK-TOKUTEI-COMPFTN2                
                                                 TO  WK-TOKUTEI-COMPFTN 
                        END-IF
                        COMPUTE   LNK-SYU-SYUCOMPTOTAL   =
                                  LNK-SYU-SYUCOMPFTN     
                        MOVE  HKN-KZK-NYUSKJRYYKBN
                                             TO   LNK-SYU-SYUSKJ-FTNKBN
                        MOVE  WK-SHOKUJI-NISSU
                                             TO   LNK-SYU-SYUSKJ-NISSU
                        MOVE  WK-SHOKUJI-RYOYOHI
                                             TO   LNK-SYU-SYUSKJ-RYOYOHI
                        IF    HKN-KZK-NYUSKJRYYKBN  NOT =  "0"
                            IF    HKN-KZK-NYUSKJRYYKBN  NOT =  "3"
                              MOVE  WK-SHOKUJI-FTN
                                             TO   LNK-SYU-SYUSKJ-FTN
                            END-IF
                            MOVE  WK-SHOKUJI-FTN
                                            TO   LNK-SYU-SYUSKJ-FTN-RECE
                        END-IF
                   END-IF
      ***        WHEN   "2"
      ***          IF    HKN-TSY-NYUKFTNRATE     NOT =    ZERO
      ***                COMPUTE   WK-FUTANWARI  =
      ***                          HKN-TSY-NYUKFTNRATE  /  100
      ***                COMPUTE   LNK-SYU-SYUCOMPFTN  =
      ***                          WK-ZENGAKU   *  WK-FUTANWARI
      ***                MOVE      LNK-SYU-SYUCOMPFTN
      ***                                    TO WK-TOKUTEI-COMPFTN2
      ***                COMPUTE   LNK-SYU-SYUCOMPFTN =
      ***                          LNK-SYU-SYUCOMPFTN  +  5
      ***                COMPUTE   WK-FTN      =
      ***                          LNK-SYU-SYUCOMPFTN  /  10
      ***                COMPUTE   LNK-SYU-SYUCOMPFTN =
      ***                          WK-FTN   *  10
      ***          END-IF
      *
      ***          IF   LNK-S02-KOUREI-NYUIN-KBN   =   "1"
      ***              IF  ZAN-SYU-M     <     WK-TOKUTEI-COMPFTN2      
      ***                  MOVE ZAN-SYU-M   TO  LNK-SYU-SYUCOMPFTN
      ***                                       WK-TOKUTEI-COMPFTN      
      ***              ELSE                                             
      ***                  MOVE WK-TOKUTEI-COMPFTN2                     
      ***                                        TO  WK-TOKUTEI-COMPFTN 
      ***              END-IF
      ***          ELSE
      ***                  MOVE WK-TOKUTEI-COMPFTN2              
      ***                                        TO  WK-TOKUTEI-COMPFTN 
      ***          END-IF
      ***          COMPUTE   LNK-SYU-SYUCOMPTOTAL   =
      ***                    LNK-SYU-SYUCOMPFTN     
      ***          MOVE  HKN-TSY-NYUSKJRYYKBN
      ***                                    TO   LNK-SYU-SYUSKJ-FTNKBN
      ***          MOVE  WK-SHOKUJI-NISSU
      ***                                    TO   LNK-SYU-SYUSKJ-NISSU
      ***          MOVE  WK-SHOKUJI-RYOYOHI
      ***                                    TO   LNK-SYU-SYUSKJ-RYOYOHI
      ***          IF    HKN-TSY-NYUSKJRYYKBN  NOT =  "0"
      ***                   IF    HKN-TSY-NYUSKJRYYKBN  NOT =  "3"
      ***                     MOVE  WK-SHOKUJI-FTN
      ***                                    TO   LNK-SYU-SYUSKJ-FTN
      ***                   END-IF
      ***                   MOVE  WK-SHOKUJI-FTN
      ***                                   TO   LNK-SYU-SYUSKJ-FTN-RECE
      ***          END-IF
      ***        WHEN   "3"
      ***          IF    HKN-TNK-NYUKFTNRATE     NOT =    ZERO
      ***                COMPUTE   WK-FUTANWARI  =
      ***                          HKN-TNK-NYUKFTNRATE  /  100
      ***                COMPUTE   LNK-SYU-SYUCOMPFTN  =
      ***                          WK-ZENGAKU   *  WK-FUTANWARI
      ***                MOVE      LNK-SYU-SYUCOMPFTN
      ***                                   TO WK-TOKUTEI-COMPFTN2
      ***                COMPUTE   LNK-SYU-SYUCOMPFTN =
      ***                          LNK-SYU-SYUCOMPFTN  +  5
      ***                COMPUTE   WK-FTN      =
      ***                          LNK-SYU-SYUCOMPFTN  /  10
      ***                COMPUTE   LNK-SYU-SYUCOMPFTN =
      ***                          WK-FTN   *  10
      ***          END-IF
      *
      ***          IF   LNK-S02-KOUREI-NYUIN-KBN   =   "1"
      ***              IF  ZAN-SYU-M     <     WK-TOKUTEI-COMPFTN2      
      ***                  MOVE ZAN-SYU-M   TO  LNK-SYU-SYUCOMPFTN
      ***                                       WK-TOKUTEI-COMPFTN      
      ***              ELSE                                             
      ***                  MOVE WK-TOKUTEI-COMPFTN2                     
      ***                                        TO  WK-TOKUTEI-COMPFTN 
      ***              END-IF
      ***          ELSE
      ***                  MOVE WK-TOKUTEI-COMPFTN2                
      ***                                        TO  WK-TOKUTEI-COMPFTN 
      ***          END-IF
      ***          COMPUTE   LNK-SYU-SYUCOMPTOTAL   =
      ***                    LNK-SYU-SYUCOMPFTN     
      ***          MOVE  HKN-TNK-NYUSKJRYYKBN
      ***                                    TO   LNK-SYU-SYUSKJ-FTNKBN
      ***          MOVE  WK-SHOKUJI-NISSU
      ***                                    TO   LNK-SYU-SYUSKJ-NISSU
      ***          MOVE  WK-SHOKUJI-RYOYOHI
      ***                                    TO   LNK-SYU-SYUSKJ-RYOYOHI
      ***          IF    HKN-TNK-NYUSKJRYYKBN  NOT =  "0"
      ***                   IF    HKN-TNK-NYUSKJRYYKBN  NOT =  "3"
      ***                     MOVE  WK-SHOKUJI-FTN
      ***                                    TO   LNK-SYU-SYUSKJ-FTN
      ***                   END-IF
      ***                   MOVE  WK-SHOKUJI-FTN
      ***                                   TO   LNK-SYU-SYUSKJ-FTN-RECE
      ***          END-IF
      ***      END-EVALUATE
             WHEN   "1"
      *        システム管理マスタ（４００１）から点数単価の取得
               INITIALIZE                         SYS-4001-REC
               MOVE    "4001"               TO    SYS-4001-KANRICD
               MOVE    "*"                  TO    SYS-4001-KBNCD
               MOVE    LNK-SYU-SKYSTYMD     TO    ORC-DBYMD
               MOVE    SYS-4001-REC         TO    MCPDATA-REC
               MOVE    "DBSELECT"           TO    MCP-FUNC
               MOVE    "SYSKANRI-KEY"       TO    ORC-DBPATH
               CALL    "ORCMCPSUB"    USING       MCPAREA
                                                  ORCMCPAREA
                                                  MCPDATA-REC
               IF      MCP-RC               =     ZERO
                   MOVE     "SYSKANRI-KEY"  TO    ORC-DBPATH
                   PERFORM   SYSKANRI-READ-SEC
                   IF    MCP-RC             =     ZERO
                     IF    SYS-4001-KSNRATE(1:2)   =    SPACE
                            MOVE     100        TO   WK-KSNRATE9
                            COMPUTE  WK-KSNRATE   =  WK-KSNRATE9  /  100
                     ELSE
                            COMPUTE  WK-KSNRATE9  =  SYS-4001-KSNRATE
                                                  +  100 
                            COMPUTE  WK-KSNRATE   =  WK-KSNRATE9  /  100
                     END-IF  
                     MOVE   SYS-4001-TAXKBN     TO   WK-TAXKBN
                     IF     LNK-SYU-SYUHKNNUM       =  "971" OR "973"
                       IF   LNK-SYU-PTFTNRATE       =   100
                         MOVE     100      TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
                         MOVE     "1"      TO   HKN-HON-NYUSKJRYYKBN
                                                HKN-KZK-NYUSKJRYYKBN
                                                HKN-TSY-NYUSKJRYYKBN
                                                HKN-TNK-NYUSKJRYYKBN
                       ELSE
                         MOVE     ZERO     TO   HKN-HON-NYUKFTNRATE
                                                HKN-KZK-NYUKFTNRATE
                                                HKN-TSY-NYUKFTNRATE
                                                HKN-TNK-NYUKFTNRATE
                         MOVE     "0"      TO   HKN-HON-NYUSKJRYYKBN
                                                HKN-KZK-NYUSKJRYYKBN
                                                HKN-TSY-NYUSKJRYYKBN
                                                HKN-TNK-NYUSKJRYYKBN
                       END-IF
                     END-IF
                     IF     LNK-SYU-SYUHKNNUM       =  "971"
                       EVALUATE  SYS-4001-TENKBN
                           WHEN  "1"
                               COMPUTE  WK-ZENGAKU  =  
                                       (WK-ZENGAKU  / 10 * 11.5)
                           WHEN  "2"
                               COMPUTE  WK-ZENGAKU  =  
                                       (WK-ZENGAKU  / 10 * 12.0)
                       END-EVALUATE
                     ELSE
                       EVALUATE  SYS-4001-TENKBN
                           WHEN  "1"
                              COMPUTE  WK-ZENGAKU  =  WK-ZENGAKU  /  10  
                              MOVE  LNK-S02-SYUTEN  TO  WK-ZENGAKU-SYU
                              COMPUTE  WK-ZENGAKU-YAK = WK-ZENGAKU 
                                                      - LNK-S02-SYUTEN
                              COMPUTE  WK-ZENGAKU-SYU =
                                (WK-ZENGAKU-SYU * 11.5 * WK-KSNRATE)
                                                       + 0.5
                              COMPUTE  WK-ZENGAKU-YAK =
                                (WK-ZENGAKU-YAK * 11.5)
                                                       + 0.5
                              COMPUTE  WK-ZENGAKU     = WK-ZENGAKU-SYU
                                                      + WK-ZENGAKU-YAK
                           WHEN  "2"
                              COMPUTE  WK-ZENGAKU  =  WK-ZENGAKU  /  10  
                              MOVE  LNK-S02-SYUTEN  TO  WK-ZENGAKU-SYU
                              COMPUTE  WK-ZENGAKU-YAK = WK-ZENGAKU 
                                                      - LNK-S02-SYUTEN
                              COMPUTE  WK-ZENGAKU-SYU =
                                (WK-ZENGAKU-SYU * 12.0 * WK-KSNRATE)
                                                       + 0.5
                              COMPUTE  WK-ZENGAKU-YAK =
                                (WK-ZENGAKU-YAK * 12.0)
                                                       + 0.5
                              COMPUTE  WK-ZENGAKU     = WK-ZENGAKU-SYU
                                                      + WK-ZENGAKU-YAK
                       END-EVALUATE
                     END-IF 
                   END-IF
               END-IF
      *
               MOVE    "DBCLOSE"            TO  MCP-FUNC
               MOVE    "SYSKANRI-KEY"       TO  ORC-DBPATH
               CALL    "ORCMCPSUB"           USING
                                             MCPAREA
                                             ORCMCPAREA
                                             MCPDATA-REC
      *
               COMPUTE   WK-FUTANWARI  =
                         HKN-HON-NYUKFTNRATE  /  100
               COMPUTE   LNK-SYU-SYUCOMPFTN  =
                         WK-ZENGAKU   *  WK-FUTANWARI
      *         COMPUTE   LNK-SYU-SYUCOMPFTN =
      *                   LNK-SYU-SYUCOMPFTN  +  5
      *         COMPUTE   WK-FTN      =
      *                   LNK-SYU-SYUCOMPFTN  /  10
      *         COMPUTE   LNK-SYU-SYUCOMPFTN =
      *                   WK-FTN   *  10
               COMPUTE   LNK-SYU-SYUCOMPTOTAL   =
                         LNK-SYU-SYUCOMPFTN     
               MOVE  HKN-HON-NYUSKJRYYKBN
                                        TO   LNK-SYU-SYUSKJ-FTNKBN
               MOVE  WK-SHOKUJI-NISSU
                                        TO   LNK-SYU-SYUSKJ-NISSU
               MOVE  WK-SHOKUJI-RYOYOHI
                                        TO   LNK-SYU-SYUSKJ-RYOYOHI
               IF    HKN-HON-NYUSKJRYYKBN  NOT =  "0"
                       IF    HKN-HON-NYUSKJRYYKBN  NOT =  "3"
                         MOVE  WK-SHOKUJI-FTN
                                        TO   LNK-SYU-SYUSKJ-FTN
                       END-IF
                       MOVE  WK-SHOKUJI-FTN
                                        TO   LNK-SYU-SYUSKJ-FTN-RECE
               END-IF
           END-EVALUATE.
      *
       2301-SYUHOKEN-KEISAN-EXT.
           EXIT.
      *
      ******************************************************************
      *        公費の保険番号テーブル検索                              *
      ******************************************************************
       2302-KOH-HKNREAD-SEC           SECTION.
      *
      *    該当保険番号テーブルの検索
           INITIALIZE                      HKNNUM-REC.
           MOVE   COMB-HOSPID        TO    HKN-HOSPID.
           MOVE   COMB-KOHHKNNUM(KOH-IDX)
                                     TO    HKN-HKNNUM.
           IF     COMB-KOHHKNNUM(KOH-IDX)  =     "027"
                  MOVE     COMB-KOH1PAYKBN
                                     TO    WK-PAYKBN
           ELSE
                  MOVE     "00"      TO    WK-PAYKBN
           END-IF.
           MOVE   HKNNUM-REC         TO    MCPDATA-REC.
           MOVE   "DBSELECT"         TO    MCP-FUNC.
           MOVE   "HKNNUM-KEY2"      TO    ORC-DBPATH.
           CALL   "ORCMCPSUB"         USING MCPAREA
                                            ORCMCPAREA
                                            MCPDATA-REC.
           IF      MCP-RC            =     ZERO
               MOVE    "HKNNUM-KEY2" TO    ORC-DBPATH
               PERFORM  HKNNUM-READ-SEC
               PERFORM  UNTIL
                 (FLG-HKNNUM     =    1)                       OR
                ((HKN-TEKSTYMD(1:6)     <=  LNK-SYU-SKYSTYMD(1:6)) AND
                 (LNK-SYU-SKYSTYMD(1:6) <=  HKN-TEKEDYMD(1:6))     AND
                 (WK-PAYKBN            =  HKN-PAYKBN))
                   PERFORM   HKNNUM-READ-SEC
               END-PERFORM
           END-IF.
      *
           MOVE    "DBCLOSE"            TO  MCP-FUNC.
           MOVE    "HKNNUM-KEY2"        TO  ORC-DBPATH.
           CALL    "ORCMCPSUB"           USING
                                         MCPAREA
                                         ORCMCPAREA
                                         MCPDATA-REC.
           MOVE       ZERO                TO   WK-NYUKFTNRATE.
           MOVE       SPACE               TO   WK-NYUSKJRYYKBN.
           EVALUATE   FLG-SANSHOU2
               WHEN   "1"
                   MOVE    HKN-HON-NYUKFTNRATE  TO   WK-NYUKFTNRATE
                   MOVE    HKN-HON-NYUSKJRYYKBN TO   WK-NYUSKJRYYKBN
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200304"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "015" OR "016")
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200304"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "012"         )
                   AND (WK-NYUJGNGAK         NOT  =  ZERO          )
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200310"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "051"         )
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
               WHEN   "2"
                   MOVE    HKN-TSY-NYUKFTNRATE  TO   WK-NYUKFTNRATE
                   MOVE    HKN-TSY-NYUSKJRYYKBN TO   WK-NYUSKJRYYKBN
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200304"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "015" OR "016")
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200304"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "012"         )
                   AND (WK-NYUJGNGAK         NOT  =  ZERO          )
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200310"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "051"         )
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
               WHEN   "3"
                   MOVE    HKN-TNK-NYUKFTNRATE  TO   WK-NYUKFTNRATE
                   MOVE    HKN-TNK-NYUSKJRYYKBN TO   WK-NYUSKJRYYKBN
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200304"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "015" OR "016")
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200304"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "012"         )
                   AND (WK-NYUJGNGAK         NOT  =  ZERO          )
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
                   IF  (LNK-SYU-SRYYMD(1:6)      >=  "200310"      )
                   AND (COMB-KOHHKNNUM(KOH-IDX)   =  "051"         )
                       MOVE    "2"              TO   WK-NYUSKJRYYKBN
                   END-IF
           END-EVALUATE.
      *
           IF   COMB-KOHHKNNUM(KOH-IDX)  =  "027"
                   MOVE    HKN-HON-NYUKFTNRATE  TO   WK-NYUKFTNRATE
                   MOVE    HKN-HON-NYUSKJRYYKBN TO   WK-NYUSKJRYYKBN
           END-IF.
      *
           IF   FLG-CHIHOU(KOH-IDX)  =  "1"
               IF    WK-NYUKFTNRATE  =  ZERO
                    MOVE    SPACE   TO  COMB-KOH-NYUJGNKBN(KOH-IDX)
               END-IF
           END-IF.
      *
       2302-KOH-HKNREAD-EXT.
           EXIT.
      *
      ******************************************************************
      *        公費の患者負担金額計算（上限額あり）                    *
      ******************************************************************
       2303-KOH-KEISAN-SEC           SECTION.
      *
      *    負担金額の計算
           IF  WK-NYUKFTNRATE     NOT =    ZERO
               COMPUTE   WK-FUTANWARI  =
                              WK-NYUKFTNRATE  /  100
               COMPUTE   LNK-SYU-KOH-COMPFTN(KOH-IDX)  =
                         WK-ZENGAKU   *  WK-FUTANWARI
               IF   LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "027"           
                    MOVE   LNK-SYU-KOH-COMPFTN(KOH-IDX)                 
                                            TO WK-TOKUTEI-COMPFTN3      
               END-IF                                      
               IF ( LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "051" ) OR
                  ( HKN-RECEFTNDSPKBN            =      "2"   )
                   CONTINUE
               ELSE
                   COMPUTE   LNK-SYU-KOH-COMPFTN(KOH-IDX)  =
                             LNK-SYU-KOH-COMPFTN(KOH-IDX)  +  5
                   COMPUTE   WK-FTN      =
                             LNK-SYU-KOH-COMPFTN(KOH-IDX)  / 10
                   COMPUTE   LNK-SYU-KOH-COMPFTN(KOH-IDX)  =
                             WK-FTN   *  10
               END-IF
               IF   LNK-S02-KOUREI-NYUIN-KBN     =   "1"                
                IF  (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027"       )
                AND ( (WK-1001-PREFNUM  NOT =  20 ) OR
                     ((WK-1001-PREFNUM      =  20 ) AND
                      (LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) = "0" OR "9" )))
                    COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX        
                    IF  LNK-SYU-KOH-COMPFTN(KOH-IDX)  >  FTN-KOH-YYY      
                      MOVE  FTN-KOH-YYY TO  LNK-SYU-KOH-COMPFTN(KOH-IDX)  
                    END-IF
                END-IF
               END-IF                                              
               IF  ( FLG-SYUHEN                   =   "1" )
               AND ( LNK-SYU-KOH-HKNNUM(KOH-IDX)  =  "027")
                  IF    LNK-SYU-KOH-COMPFTN(KOH-IDX)   >
                                            ZAN-KOHI1-HEN
                     MOVE   ZAN-KOHI1-HEN   TO   WK-HEN-KOH1COMPFTN 
                  ELSE
                     MOVE   LNK-SYU-KOH-COMPFTN(KOH-IDX)
                                            TO   WK-HEN-KOH1COMPFTN 
                  END-IF
               END-IF
               IF ( LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "051" ) OR      
                  ( HKN-RECEFTNDSPKBN            =      "2"   )         
                 IF    LNK-SYU-KOH-COMPFTN(KOH-IDX)   >                 
                                            ZAN-KOHI-T2(KOH-IDX)        
                     MOVE   ZAN-KOHI-T2(KOH-IDX)   TO                   
                                          WK-KOH-COMPFTN(KOH-IDX)       
                     PERFORM    KOHHI-HIKAKU2-SEC                       
                 END-IF                                                 
               END-IF                                                   
               IF    LNK-SYU-KOH-COMPFTN(KOH-IDX)   >
                                            ZAN-KOHI-T(KOH-IDX)
                     MOVE   ZAN-KOHI-T(KOH-IDX)   TO
                                          LNK-SYU-KOH-COMPFTN(KOH-IDX)
                     MOVE   ZERO        TO  ZAN-KOHI-T(KOH-IDX)
                     IF   LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "027"     
                          MOVE   LNK-SYU-KOH-COMPFTN(KOH-IDX)           
                                            TO WK-TOKUTEI-COMPFTN3      
                     END-IF         
               ELSE
                     COMPUTE  ZAN-KOHI-T(KOH-IDX)    =
                              ZAN-KOHI-T(KOH-IDX)    -
                              LNK-SYU-KOH-COMPFTN(KOH-IDX)
               END-IF
               PERFORM    KOHHI-HIKAKU-SEC                              
               COMPUTE   LNK-SYU-KOH-COMPTOTAL(KOH-IDX)   =
                         LNK-SYU-KOH-COMPFTN(KOH-IDX)     
               IF    ZAN-KOHI-T(KOH-IDX)   NOT =   ZERO
                   COMPUTE   ZAN-KOHI-T(KOH-IDX) =
                             ZAN-KOHI-T(KOH-IDX)  +  5
                   COMPUTE   WK-FTN      =
                             ZAN-KOHI-T(KOH-IDX)  /  10
                   COMPUTE   ZAN-KOHI-T(KOH-IDX) =
                             WK-FTN   *  10
               END-IF
               MOVE  WK-NYUSKJRYYKBN    TO LNK-SYU-SKJ-FTNKBN(KOH-IDX)
               MOVE  WK-SHOKUJI-NISSU   TO LNK-SYU-SKJ-NISSU(KOH-IDX)
               MOVE  WK-SHOKUJI-RYOYOHI TO LNK-SYU-SKJ-RYOYOHI(KOH-IDX)
               EVALUATE   WK-NYUSKJRYYKBN
                   WHEN   "1"
                   WHEN   "2"
                   WHEN   "4"
                       MOVE  WK-SHOKUJI-FTN
                                      TO   LNK-SYU-SKJ-FTN(KOH-IDX)
                                           LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
                       IF   LNK-SYU-SKJ-FTNKBN(KOH-IDX)  =  "2"
                         IF    LNK-SYU-SKJ-FTN(KOH-IDX)   >
                                              ZAN-KOHI-T(KOH-IDX)
                            MOVE   ZAN-KOHI-T(KOH-IDX)   TO
                                        LNK-SYU-SKJ-FTN(KOH-IDX)
      *                                 LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
                            MOVE   ZERO      TO  ZAN-KOHI-T(KOH-IDX)
                         ELSE
                            COMPUTE  ZAN-KOHI-T(KOH-IDX)    =
                                     ZAN-KOHI-T(KOH-IDX)    -
                                     LNK-SYU-SKJ-FTN(KOH-IDX)
                         END-IF
                       END-IF
                   WHEN   "3"
                       MOVE  WK-SHOKUJI-FTN
                                      TO   LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
               END-EVALUATE
           ELSE
               IF      ( LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "051" ) OR
                       ( HKN-RECEFTNDSPKBN            =      "2"   )
                   IF    WK-TOKUTEI-COMPFTN   NOT =    ZERO
                       MOVE  WK-TOKUTEI-COMPFTN  TO  LNK-SYU-SYUCOMPFTN
                   END-IF
               END-IF
               IF     (( LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "051" ) OR
                       ( HKN-RECEFTNDSPKBN            =      "2"   ))  
               AND    (  LNK-SYU-KOH-HKNNUM(1)        =   "027"     )   
                   IF    WK-TOKUTEI-COMPFTN3   NOT =    ZERO            
                       MOVE   WK-TOKUTEI-COMPFTN3                       
                                            TO  LNK-SYU-KOH-COMPFTN(1)  
                   END-IF                                               
               END-IF                    
      **
               IF ( LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "051" ) OR      
                  ( HKN-RECEFTNDSPKBN            =      "2"   )         
                IF    LNK-SYU-SYUCOMPFTN   NOT =    ZERO
                   IF  (  LNK-S02-KOUREI-NYUIN-KBN         =   "1"  )
                   AND (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027" )
                   AND ( ( WK-1001-PREFNUM  NOT =  20 ) OR
                        (( WK-1001-PREFNUM      =  20 ) AND
                         ( LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) 
                                                     = "0" OR "9" )))
                       COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX   
                       IF  LNK-SYU-SYUCOMPFTN  >  FTN-KOH-YYY           
                         MOVE  FTN-KOH-YYY         TO  FTN-KOH-ZZZ      
                       ELSE                                             
                         MOVE  LNK-SYU-SYUCOMPFTN  TO  FTN-KOH-ZZZ      
                       END-IF                                           
                       IF    FTN-KOH-ZZZ      >    ZAN-KOHI-T2(KOH-IDX)  
                           MOVE  ZAN-KOHI-T2(KOH-IDX)                    
                                            TO  WK-KOH-COMPFTN(KOH-IDX)
                           PERFORM    KOHHI-HIKAKU2-SEC                  
                       ELSE                                             
                           MOVE  FTN-KOH-ZZZ                            
                                            TO  WK-KOH-COMPFTN(KOH-IDX) 
                           PERFORM    KOHHI-HIKAKU2-SEC                  
                       END-IF                                           
                   ELSE                                   
                       IF   LNK-SYU-SYUCOMPFTN   >  ZAN-KOHI-T2(KOH-IDX)
                           MOVE   ZAN-KOHI-T2(KOH-IDX)
                                            TO  WK-KOH-COMPFTN(KOH-IDX)
                           PERFORM    KOHHI-HIKAKU2-SEC
                       ELSE
                           MOVE  LNK-SYU-SYUCOMPFTN
                                            TO  WK-KOH-COMPFTN(KOH-IDX)
                           PERFORM    KOHHI-HIKAKU2-SEC
                       END-IF
                   END-IF
                ELSE
                 IF    LNK-SYU-KOH-COMPFTN(1)   NOT =    ZERO
                   IF  (  LNK-S02-KOUREI-NYUIN-KBN         =   "1"  )
                   AND (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027" )
                   AND ( ( WK-1001-PREFNUM  NOT =  20 ) OR
                        (( WK-1001-PREFNUM      =  20 ) AND
                         ( LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) 
                                                     = "0" OR "9" )))
                       COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX   
                       IF  LNK-SYU-KOH-COMPFTN(1) >  FTN-KOH-YYY        
                         MOVE  FTN-KOH-YYY            TO  FTN-KOH-ZZZ   
                       ELSE                                             
                         MOVE  LNK-SYU-KOH-COMPFTN(1) TO  FTN-KOH-ZZZ   
                       END-IF                                           
                       IF FTN-KOH-ZZZ   >    ZAN-KOHI-T2(KOH-IDX)        
                          MOVE   ZAN-KOHI-T2(KOH-IDX)                    
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC                   
                       ELSE                                             
                          MOVE   FTN-KOH-ZZZ  
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC                   
                       END-IF                                           
                   ELSE                                                 
                       IF    LNK-SYU-KOH-COMPFTN(1)
                                     >    ZAN-KOHI-T2(KOH-IDX)
                          MOVE   ZAN-KOHI-T2(KOH-IDX)
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC
                       ELSE
                          MOVE   LNK-SYU-KOH-COMPFTN(1)
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC
                       END-IF
                   END-IF
                 ELSE
                   IF  (  LNK-S02-KOUREI-NYUIN-KBN         =   "1"  )
                   AND (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027" )
                   AND ( ( WK-1001-PREFNUM  NOT =  20 ) OR
                        (( WK-1001-PREFNUM      =  20 ) AND
                         ( LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) 
                                                     = "0" OR "9" )))
                       COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX   
                       IF  WK-ZENGAKU  >  FTN-KOH-YYY        
                         MOVE  FTN-KOH-YYY   TO  FTN-KOH-ZZZ   
                       ELSE                                             
                         MOVE  WK-ZENGAKU    TO  FTN-KOH-ZZZ   
                       END-IF                                           
                       IF FTN-KOH-ZZZ   >    ZAN-KOHI-T2(KOH-IDX)        
                          MOVE   ZAN-KOHI-T2(KOH-IDX)                    
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC                   
                       ELSE                                             
                          MOVE   FTN-KOH-ZZZ  
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC                   
                       END-IF                                           
                   ELSE                                                 
                       IF    WK-ZENGAKU   >    ZAN-KOHI-T2(KOH-IDX)
                          MOVE   ZAN-KOHI-T2(KOH-IDX)
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC
                       ELSE
                          MOVE   WK-ZENGAKU   
                                       TO  WK-KOH-COMPFTN(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU2-SEC
                       END-IF
                   END-IF
                 END-IF
                END-IF
               END-IF                                                   
      **
               IF    LNK-SYU-SYUCOMPFTN   NOT =    ZERO
                   IF  (  LNK-S02-KOUREI-NYUIN-KBN         =   "1"  )
                   AND (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027" )
                   AND ( ( WK-1001-PREFNUM  NOT =  20 ) OR
                        (( WK-1001-PREFNUM      =  20 ) AND
                         ( LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) 
                                                     = "0" OR "9" )))
                       COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX   
                       IF  LNK-SYU-SYUCOMPFTN  >  FTN-KOH-YYY           
                         MOVE  FTN-KOH-YYY         TO  FTN-KOH-ZZZ      
                       ELSE                                             
                         MOVE  LNK-SYU-SYUCOMPFTN  TO  FTN-KOH-ZZZ      
                       END-IF                                           
                       IF    FTN-KOH-ZZZ      >    ZAN-KOHI-T(KOH-IDX)  
                           MOVE  ZAN-KOHI-T(KOH-IDX)                    
                                            TO  LNK-SYU-KOH-COMPFTN     
                                                         (KOH-IDX)      
                           MOVE   ZERO      TO  ZAN-KOHI-T(KOH-IDX)     
                           PERFORM    KOHHI-HIKAKU-SEC                  
                       ELSE                                             
                           MOVE  FTN-KOH-ZZZ                            
                                            TO  LNK-SYU-KOH-COMPFTN     
                                                         (KOH-IDX)      
                           COMPUTE    ZAN-KOHI-T(KOH-IDX)  =            
                                      ZAN-KOHI-T(KOH-IDX)  -            
                                      LNK-SYU-KOH-COMPFTN(KOH-IDX)      
                           PERFORM    KOHHI-HIKAKU-SEC                  
                       END-IF                                           
                   ELSE                                   
                       IF   LNK-SYU-SYUCOMPFTN   >  ZAN-KOHI-T(KOH-IDX)
                           MOVE   ZAN-KOHI-T(KOH-IDX)
                                            TO  LNK-SYU-KOH-COMPFTN
                                                         (KOH-IDX)
                           MOVE   ZERO      TO  ZAN-KOHI-T(KOH-IDX)
                           PERFORM    KOHHI-HIKAKU-SEC
                       ELSE
                           MOVE  LNK-SYU-SYUCOMPFTN
                                            TO  LNK-SYU-KOH-COMPFTN
                                                         (KOH-IDX)
                           COMPUTE    ZAN-KOHI-T(KOH-IDX)  =
                                      ZAN-KOHI-T(KOH-IDX)  -
                                      LNK-SYU-KOH-COMPFTN(KOH-IDX)
                           PERFORM    KOHHI-HIKAKU-SEC
                       END-IF
                   END-IF
               ELSE
                 IF    LNK-SYU-KOH-COMPFTN(1)   NOT =    ZERO
                   IF  (  LNK-S02-KOUREI-NYUIN-KBN         =   "1"  )
                   AND (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027" )
                   AND ( ( WK-1001-PREFNUM  NOT =  20 ) OR
                        (( WK-1001-PREFNUM      =  20 ) AND
                         ( LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) 
                                                     = "0" OR "9" )))
                       COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX   
                       IF  LNK-SYU-KOH-COMPFTN(1) >  FTN-KOH-YYY        
                         MOVE  FTN-KOH-YYY            TO  FTN-KOH-ZZZ   
                       ELSE                                             
                         MOVE  LNK-SYU-KOH-COMPFTN(1) TO  FTN-KOH-ZZZ   
                       END-IF                                           
                       IF FTN-KOH-ZZZ   >    ZAN-KOHI-T(KOH-IDX)        
                          MOVE   ZAN-KOHI-T(KOH-IDX)                    
                                       TO  LNK-SYU-KOH-COMPFTN(KOH-IDX) 
                          MOVE   ZERO  TO  ZAN-KOHI-T(KOH-IDX)          
                          PERFORM    KOHHI-HIKAKU-SEC                   
                       ELSE                                             
                          MOVE   FTN-KOH-ZZZ  TO  LNK-SYU-KOH-COMPFTN   
                                                            (KOH-IDX)   
                          PERFORM    KOHHI-HIKAKU-SEC                   
                          COMPUTE   ZAN-KOHI-T(KOH-IDX)  =              
                                    ZAN-KOHI-T(KOH-IDX)  -              
                                    LNK-SYU-KOH-COMPFTN(KOH-IDX)        
                       END-IF                                           
                   ELSE                                                 
                       IF    LNK-SYU-KOH-COMPFTN(1)
                                     >    ZAN-KOHI-T(KOH-IDX)
                          MOVE   ZAN-KOHI-T(KOH-IDX)
                                       TO  LNK-SYU-KOH-COMPFTN(KOH-IDX)
                          MOVE   ZERO  TO  ZAN-KOHI-T(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU-SEC
                       ELSE
                          MOVE   LNK-SYU-KOH-COMPFTN(1)
                                              TO  LNK-SYU-KOH-COMPFTN
                                                            (KOH-IDX)
                          PERFORM    KOHHI-HIKAKU-SEC
                          COMPUTE   ZAN-KOHI-T(KOH-IDX)  =
                                    ZAN-KOHI-T(KOH-IDX)  -
                                    LNK-SYU-KOH-COMPFTN(KOH-IDX)
                       END-IF
                   END-IF
                 ELSE
      *            MOVE   ZERO  TO  ZAN-KOHI-T(KOH-IDX)
                   IF  (  LNK-S02-KOUREI-NYUIN-KBN         =   "1"  )
                   AND (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027" )
                   AND ( ( WK-1001-PREFNUM  NOT =  20 ) OR
                        (( WK-1001-PREFNUM      =  20 ) AND
                         ( LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) 
                                                     = "0" OR "9" )))
                       COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX   
                       IF  WK-ZENGAKU  >  FTN-KOH-YYY        
                         MOVE  FTN-KOH-YYY   TO  FTN-KOH-ZZZ   
                       ELSE                                             
                         MOVE  WK-ZENGAKU    TO  FTN-KOH-ZZZ   
                       END-IF                                           
                       IF FTN-KOH-ZZZ   >    ZAN-KOHI-T(KOH-IDX)        
                          MOVE   ZAN-KOHI-T(KOH-IDX)                    
                                       TO  LNK-SYU-KOH-COMPFTN(KOH-IDX) 
                          MOVE   ZERO  TO  ZAN-KOHI-T(KOH-IDX)          
                          PERFORM    KOHHI-HIKAKU-SEC                   
                       ELSE                                             
                          MOVE   FTN-KOH-ZZZ  TO  LNK-SYU-KOH-COMPFTN   
                                                            (KOH-IDX)   
                          PERFORM    KOHHI-HIKAKU-SEC                   
                          COMPUTE   ZAN-KOHI-T(KOH-IDX)  =              
                                    ZAN-KOHI-T(KOH-IDX)  -              
                                    LNK-SYU-KOH-COMPFTN(KOH-IDX)        
                       END-IF                                           
                   ELSE                                                 
                       IF    WK-ZENGAKU   >    ZAN-KOHI-T(KOH-IDX)
                          MOVE   ZAN-KOHI-T(KOH-IDX)
                                       TO  LNK-SYU-KOH-COMPFTN(KOH-IDX)
                          MOVE   ZERO  TO  ZAN-KOHI-T(KOH-IDX)
                          PERFORM    KOHHI-HIKAKU-SEC
                       ELSE
                          MOVE   WK-ZENGAKU   TO  LNK-SYU-KOH-COMPFTN
                                                            (KOH-IDX)
                          PERFORM    KOHHI-HIKAKU-SEC
                          COMPUTE   ZAN-KOHI-T(KOH-IDX)  =
                                    ZAN-KOHI-T(KOH-IDX)  -
                                    LNK-SYU-KOH-COMPFTN(KOH-IDX)
                       END-IF
                   END-IF
                 END-IF
               END-IF
               COMPUTE   LNK-SYU-KOH-COMPTOTAL(KOH-IDX)   =
                         LNK-SYU-KOH-COMPFTN(KOH-IDX)     
               IF    ZAN-KOHI-T(KOH-IDX)   NOT =   ZERO
                   COMPUTE   ZAN-KOHI-T(KOH-IDX) =
                             ZAN-KOHI-T(KOH-IDX)  +  5
                   COMPUTE   WK-FTN      =
                             ZAN-KOHI-T(KOH-IDX)  /  10
                   COMPUTE   ZAN-KOHI-T(KOH-IDX) =
                             WK-FTN   *  10
               END-IF
               MOVE  WK-NYUSKJRYYKBN    TO LNK-SYU-SKJ-FTNKBN(KOH-IDX)
               MOVE  WK-SHOKUJI-NISSU   TO LNK-SYU-SKJ-NISSU(KOH-IDX)
               MOVE  WK-SHOKUJI-RYOYOHI TO LNK-SYU-SKJ-RYOYOHI(KOH-IDX)
               EVALUATE   WK-NYUSKJRYYKBN
                   WHEN   "1"
                   WHEN   "2"
                   WHEN   "4"
                       MOVE  WK-SHOKUJI-FTN
                                      TO   LNK-SYU-SKJ-FTN(KOH-IDX)
                                           LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
                       IF   LNK-SYU-SKJ-FTNKBN(KOH-IDX)  =  "2"
                         IF    LNK-SYU-SKJ-FTN(KOH-IDX)   >
                                              ZAN-KOHI-T(KOH-IDX)
                            MOVE   ZAN-KOHI-T(KOH-IDX)   TO
                                        LNK-SYU-SKJ-FTN(KOH-IDX)
      *                                 LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
                            MOVE   ZERO      TO  ZAN-KOHI-T(KOH-IDX)
                         ELSE
                            COMPUTE  ZAN-KOHI-T(KOH-IDX)    =
                                     ZAN-KOHI-T(KOH-IDX)    -
                                     LNK-SYU-SKJ-FTN(KOH-IDX)
                         END-IF
                       END-IF
                   WHEN   "3"
                       MOVE  WK-SHOKUJI-FTN
                                      TO   LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
               END-EVALUATE
           END-IF.
      *
       2303-KOH-KEISAN-EXT.
           EXIT.
      *
      ******************************************************************
      *        公費の患者負担金額計算（上限額なし）                  *
      ******************************************************************
       2304-KOH-KEISAN-SEC           SECTION.
      *
      *    負担金額の計算
           IF  WK-NYUKFTNRATE     NOT =    ZERO
               COMPUTE   WK-FUTANWARI  =
                              WK-NYUKFTNRATE  /  100
               COMPUTE   LNK-SYU-KOH-COMPFTN(KOH-IDX)  =
                         WK-ZENGAKU   *  WK-FUTANWARI
               IF   LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "027"           
                    MOVE   LNK-SYU-KOH-COMPFTN(KOH-IDX)                 
                                            TO WK-TOKUTEI-COMPFTN3      
               END-IF                
               IF ( LNK-SYU-KOH-HKNNUM(KOH-IDX)  =      "051" ) OR
                  ( HKN-RECEFTNDSPKBN            =      "2"   )
                   CONTINUE
               ELSE
                   COMPUTE   LNK-SYU-KOH-COMPFTN(KOH-IDX) =
                             LNK-SYU-KOH-COMPFTN(KOH-IDX)  +  5
                   COMPUTE   WK-FTN      =
                             LNK-SYU-KOH-COMPFTN(KOH-IDX)  /  10
                   COMPUTE   LNK-SYU-KOH-COMPFTN(KOH-IDX) =  WK-FTN
                                                              *  10
               END-IF
               IF   LNK-S02-KOUREI-NYUIN-KBN     =   "1"                
                IF  (  LNK-SYU-KOH-HKNNUM(KOH-IDX)  NOT =  "027"       )
                AND ( (WK-1001-PREFNUM  NOT =  20 ) OR
                     ((WK-1001-PREFNUM      =  20 ) AND
                      (LNK-SYU-KOH-HKNNUM(KOH-IDX)(1:1) = "0" OR "9" )))
                  COMPUTE  FTN-KOH-YYY  =  40200  -  FTN-KOH-XXX        
                  IF  LNK-SYU-KOH-COMPFTN(KOH-IDX)  >  FTN-KOH-YYY      
                    MOVE  FTN-KOH-YYY TO  LNK-SYU-KOH-COMPFTN(KOH-IDX)  
                  END-IF                                                
                END-IF                                                  
               END-IF                                              
           END-IF.
           PERFORM    KOHHI-HIKAKU-SEC.
           COMPUTE   LNK-SYU-KOH-COMPTOTAL(KOH-IDX)   =
                     LNK-SYU-KOH-COMPFTN(KOH-IDX).     
           MOVE  WK-NYUSKJRYYKBN    TO  LNK-SYU-SKJ-FTNKBN(KOH-IDX)
           MOVE  WK-SHOKUJI-NISSU   TO  LNK-SYU-SKJ-NISSU(KOH-IDX)
           MOVE  WK-SHOKUJI-RYOYOHI TO  LNK-SYU-SKJ-RYOYOHI(KOH-IDX)
           EVALUATE   WK-NYUSKJRYYKBN
                   WHEN   "1"
                   WHEN   "2"
                   WHEN   "4"
                       MOVE  WK-SHOKUJI-FTN
                                      TO   LNK-SYU-SKJ-FTN(KOH-IDX)
                                           LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
                       IF   LNK-SYU-SKJ-FTNKBN(KOH-IDX)  =  "2"
                         IF    LNK-SYU-SKJ-FTN(KOH-IDX)   >
                                              ZAN-KOHI-T(KOH-IDX)
                            MOVE   ZAN-KOHI-T(KOH-IDX)   TO
                                        LNK-SYU-SKJ-FTN(KOH-IDX)
                            MOVE   ZERO      TO  ZAN-KOHI-T(KOH-IDX)
                         ELSE
                            COMPUTE  ZAN-KOHI-T(KOH-IDX)    =
                                     ZAN-KOHI-T(KOH-IDX)    -
                                     LNK-SYU-SKJ-FTN(KOH-IDX)
                         END-IF
                       END-IF
                   WHEN   "3"
                       MOVE  WK-SHOKUJI-FTN
                                      TO   LNK-SYU-SKJ-FTN-RECE(KOH-IDX)
           END-EVALUATE.
      *     
       2304-KOH-KEISAN-EXT.
           EXIT.
      *
      ******************************************************************
      *        公費単位で計算した患者負担金を比較
      ******************************************************************
       KOHHI-HIKAKU-SEC           SECTION.
      *
           EVALUATE    KOH-IDX
               WHEN    2
                   IF  LNK-SYU-KOH-COMPFTN(1) < LNK-SYU-KOH-COMPFTN(2)
                   AND LNK-SYU-KOH1HKNNUM   NOT =  SPACE
                       MOVE  LNK-SYU-KOH-COMPFTN(1)
                                            TO  LNK-SYU-KOH-COMPFTN(2)
                   END-IF
               WHEN    3
                   IF  LNK-SYU-KOH-COMPFTN(2) < LNK-SYU-KOH-COMPFTN(3)
                       MOVE  LNK-SYU-KOH-COMPFTN(2)
                                            TO  LNK-SYU-KOH-COMPFTN(3)
                   END-IF
               WHEN    4
                   IF  LNK-SYU-KOH-COMPFTN(3) < LNK-SYU-KOH-COMPFTN(4)
                       MOVE  LNK-SYU-KOH-COMPFTN(3)
                                            TO  LNK-SYU-KOH-COMPFTN(4)
                   END-IF
           END-EVALUATE.
      *
       KOHHI-HIKAKU-EXT.
           EXIT.
      *
      ******************************************************************
      *        公費単位で計算した患者負担金を比較
      *        （レセ記載金額退避用エリア用）
      ******************************************************************
       KOHHI-HIKAKU2-SEC           SECTION.                             
      *
           EVALUATE    KOH-IDX
               WHEN    2
                 IF  WK-KOH-COMPFTN(1)  =  ALL"9"
                   IF  LNK-SYU-KOH-COMPFTN(1) < WK-KOH-COMPFTN(2)
                   AND LNK-SYU-KOH1HKNNUM   NOT =  SPACE
                       MOVE  LNK-SYU-KOH-COMPFTN(1)
                                            TO  WK-KOH-COMPFTN(2)
                   END-IF
                 ELSE
                   IF  WK-KOH-COMPFTN(1)      < WK-KOH-COMPFTN(2)
                   AND LNK-SYU-KOH1HKNNUM   NOT =  SPACE
                       MOVE  WK-KOH-COMPFTN(1)
                                            TO  WK-KOH-COMPFTN(2)
                   END-IF
                 END-IF
               WHEN    3
                 IF  WK-KOH-COMPFTN(2)  =  ALL"9"
                   IF  LNK-SYU-KOH-COMPFTN(2) < WK-KOH-COMPFTN(3)
                       MOVE  LNK-SYU-KOH-COMPFTN(2)
                                            TO  WK-KOH-COMPFTN(3)
                   END-IF
                 ELSE
                   IF  WK-KOH-COMPFTN(2)      < WK-KOH-COMPFTN(3)
                       MOVE  WK-KOH-COMPFTN(2)
                                            TO  WK-KOH-COMPFTN(3)
                   END-IF
                 END-IF
               WHEN    4
                 IF  WK-KOH-COMPFTN(3)  =  ALL"9"
                   IF  LNK-SYU-KOH-COMPFTN(3) < WK-KOH-COMPFTN(4)
                       MOVE  LNK-SYU-KOH-COMPFTN(3)
                                            TO  WK-KOH-COMPFTN(4)
                   END-IF
                 ELSE
                   IF  WK-KOH-COMPFTN(3)      < WK-KOH-COMPFTN(4)
                       MOVE  WK-KOH-COMPFTN(3)
                                            TO  WK-KOH-COMPFTN(4)
                   END-IF
                 END-IF
           END-EVALUATE.
      *
       KOHHI-HIKAKU2-EXT.
           EXIT.                                                        
      *
      ******************************************************************
      *        公費単位で計算した患者負担金から最小の値を選択セット
      ******************************************************************
       2314-FTNKIN-HIKAKU-SEC         SECTION.
      *
      *    請求額比較
           MOVE    ZERO               TO    WK-KNJFTNKIN.
      *    主保険のみ
           IF (COMB-KOH1HKNNUM              =    SPACE)    AND
              (COMB-KOH2HKNNUM              =    SPACE)    AND
              (COMB-KOH3HKNNUM              =    SPACE)    AND
              (COMB-KOH4HKNNUM              =    SPACE)
               MOVE   LNK-SYU-SYUCOMPFTN    TO   WK-KNJFTNKIN
           END-IF.
      *    公費１のみ
           IF (COMB-KOH1HKNNUM              NOT = SPACE)   AND
              (COMB-KOH2HKNNUM              =     SPACE)   AND
              (COMB-KOH3HKNNUM              =     SPACE)   AND
              (COMB-KOH4HKNNUM              =     SPACE)
               MOVE   LNK-SYU-KOH1COMPFTN   TO    WK-KNJFTNKIN
           END-IF.
      *    公費１と公費２
           IF (COMB-KOH1HKNNUM              NOT = SPACE)   AND
              (COMB-KOH2HKNNUM              NOT = SPACE)   AND
              (COMB-KOH3HKNNUM              =     SPACE)   AND
              (COMB-KOH4HKNNUM              =     SPACE)
               MOVE    LNK-SYU-KOH1COMPFTN  TO    WK-KNJFTNKIN
               IF  LNK-SYU-KOH2COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH2COMPFTN TO  WK-KNJFTNKIN
               END-IF
           END-IF.
      *    公費１と公費２と公費３
           IF (COMB-KOH1HKNNUM              NOT = SPACE)   AND
              (COMB-KOH2HKNNUM              NOT = SPACE)   AND
              (COMB-KOH3HKNNUM              NOT = SPACE)   AND
              (COMB-KOH4HKNNUM              =     SPACE)
               MOVE    LNK-SYU-KOH1COMPFTN  TO    WK-KNJFTNKIN
               IF  LNK-SYU-KOH2COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH2COMPFTN     TO  WK-KNJFTNKIN
               END-IF
               IF  LNK-SYU-KOH3COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH3COMPFTN TO  WK-KNJFTNKIN
               END-IF
           END-IF.
      *    公費１と公費２と公費３と公費４
           IF (COMB-KOH1HKNNUM              NOT = SPACE)   AND
              (COMB-KOH2HKNNUM              NOT = SPACE)   AND
              (COMB-KOH3HKNNUM              NOT = SPACE)   AND
              (COMB-KOH4HKNNUM              NOT = SPACE)
               MOVE    LNK-SYU-KOH1COMPFTN  TO    WK-KNJFTNKIN
               IF  LNK-SYU-KOH2COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH2COMPFTN TO  WK-KNJFTNKIN
               END-IF
               IF  LNK-SYU-KOH3COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH3COMPFTN TO  WK-KNJFTNKIN
               END-IF
               IF  LNK-SYU-KOH4COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH4COMPFTN TO  WK-KNJFTNKIN
               END-IF
           END-IF.
      *
      ***  IF   LNK-S02-KOUREI-NYUIN-KBN     =   "1"   
      ***  AND  COMB-KOH1HKNNUM        NOT   =   "027" 
      ***  AND  COMB-HKNNUM            NOT   =   SPACE 
           IF   COMB-KOH1HKNNUM        NOT   =   "027" 
           AND  COMB-HKNNUM            NOT   =   SPACE 
               MOVE    LNK-SYU-SYUCOMPFTN     TO  WK-KNJFTNKIN
               IF   LNK-SYU-KOH1HKNNUM   NOT =  SPACE
               AND  LNK-SYU-KOH1COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH1COMPFTN TO  WK-KNJFTNKIN
               END-IF
               IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
               AND  LNK-SYU-KOH2COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH2COMPFTN TO  WK-KNJFTNKIN
               END-IF
               IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
               AND  LNK-SYU-KOH3COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH3COMPFTN TO  WK-KNJFTNKIN
               END-IF
               IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
               AND  LNK-SYU-KOH4COMPFTN      <     WK-KNJFTNKIN
                   MOVE   LNK-SYU-KOH4COMPFTN TO  WK-KNJFTNKIN
               END-IF
               IF     LNK-SYU-SYUCOMPFTN   =  WK-KNJFTNKIN               
                  IF  LNK-SYU-KOH1HKNNUM   NOT =  SPACE
                    MOVE  LNK-SYU-SYUCOMPFTN   TO   LNK-SYU-KOH1COMPFTN  
                    IF    WK-KOH-COMPFTN(1)  =  ALL"9"                  
                       CONTINUE                                         
                    ELSE                                                
                      MOVE  LNK-SYU-SYUCOMPFTN TO   WK-KOH-COMPFTN(1)   
                    END-IF                                              
                  END-IF
                  IF  LNK-SYU-KOH2HKNNUM   NOT =  SPACE
                    MOVE  LNK-SYU-SYUCOMPFTN   TO   LNK-SYU-KOH2COMPFTN  
                    IF    WK-KOH-COMPFTN(2)  =  ALL"9"                  
                       CONTINUE                                         
                    ELSE                                                
                      MOVE  LNK-SYU-SYUCOMPFTN TO   WK-KOH-COMPFTN(2)   
                    END-IF                                              
                  END-IF
                  IF  LNK-SYU-KOH3HKNNUM   NOT =  SPACE
                    MOVE  LNK-SYU-SYUCOMPFTN   TO   LNK-SYU-KOH3COMPFTN  
                    IF    WK-KOH-COMPFTN(3)  =  ALL"9"                  
                       CONTINUE                                         
                    ELSE                                                
                      MOVE  LNK-SYU-SYUCOMPFTN TO   WK-KOH-COMPFTN(3)   
                    END-IF                                              
                  END-IF
                  IF  LNK-SYU-KOH4HKNNUM   NOT =  SPACE
                    MOVE  LNK-SYU-SYUCOMPFTN   TO   LNK-SYU-KOH4COMPFTN  
                    IF    WK-KOH-COMPFTN(4)  =  ALL"9"                  
                       CONTINUE                                         
                    ELSE                                                
                      MOVE  LNK-SYU-SYUCOMPFTN TO   WK-KOH-COMPFTN(4)   
                    END-IF                                              
                  END-IF
               END-IF                                                    
           END-IF.
      *
      *食事療養費比較
           IF  ( COMB-KOH1HKNNUM          =   "027" )  OR
               ( COMB-HKNNUM              =   SPACE ) 
             MOVE        LNK-SYU-KOH1SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ 
             IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH2SKJ-RYOYOHI <  WK-RYOYOHI-SKJ
                   MOVE  LNK-SYU-KOH2SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ
               END-IF
             END-IF
             IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH3SKJ-RYOYOHI <  WK-RYOYOHI-SKJ
                   MOVE  LNK-SYU-KOH3SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ          
               END-IF
             END-IF
             IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH4SKJ-RYOYOHI <  WK-RYOYOHI-SKJ
                   MOVE  LNK-SYU-KOH4SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ          
               END-IF
             END-IF
      ***    MOVE        WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH1SKJ-RYOYOHI
      ***    IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      ***      MOVE      WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH2SKJ-RYOYOHI
      ***    END-IF
      ***    IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      ***      MOVE      WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH3SKJ-RYOYOHI
      ***    END-IF
      ***    IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      ***      MOVE      WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH4SKJ-RYOYOHI
      ***    END-IF
           ELSE
             MOVE        LNK-SYU-SYUSKJ-RYOYOHI  TO  WK-RYOYOHI-SKJ 
             IF   LNK-SYU-KOH1HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH1SKJ-RYOYOHI <  WK-RYOYOHI-SKJ
                   MOVE  LNK-SYU-KOH1SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ
               END-IF 
             END-IF
             IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH2SKJ-RYOYOHI <  WK-RYOYOHI-SKJ
                   MOVE  LNK-SYU-KOH2SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ
               END-IF
             END-IF
             IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH3SKJ-RYOYOHI <  WK-RYOYOHI-SKJ
                   MOVE  LNK-SYU-KOH3SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ
               END-IF
             END-IF 
             IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH4SKJ-RYOYOHI <  WK-RYOYOHI-SKJ
                   MOVE  LNK-SYU-KOH4SKJ-RYOYOHI TO  WK-RYOYOHI-SKJ
               END-IF
             END-IF
      ***    MOVE        WK-RYOYOHI-SKJ    TO  LNK-SYU-SYUSKJ-RYOYOHI
      ***    IF   LNK-SYU-KOH1HKNNUM   NOT =  SPACE
      ***      MOVE      WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH1SKJ-RYOYOHI
      ***    END-IF
      ***    IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      ***      MOVE      WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH2SKJ-RYOYOHI
      ***    END-IF
      ***    IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      ***      MOVE      WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH3SKJ-RYOYOHI
      ***    END-IF
      ***    IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      ***      MOVE      WK-RYOYOHI-SKJ    TO  LNK-SYU-KOH4SKJ-RYOYOHI
      ***    END-IF
           END-IF.
      *
      *食事負担額比較
           IF  ( COMB-KOH1HKNNUM          =   "027" )  OR
               ( COMB-HKNNUM              =   SPACE ) 
             MOVE        LNK-SYU-KOH1SKJ-FTN TO  WK-KNJFTNKIN-SKJ 
             IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH2SKJ-FTN <  WK-KNJFTNKIN-SKJ
                   MOVE  LNK-SYU-KOH2SKJ-FTN TO  WK-KNJFTNKIN-SKJ
               END-IF
             END-IF
             IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH3SKJ-FTN <  WK-KNJFTNKIN-SKJ
                   MOVE  LNK-SYU-KOH3SKJ-FTN TO  WK-KNJFTNKIN-SKJ          
               END-IF
             END-IF
             IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH4SKJ-FTN <  WK-KNJFTNKIN-SKJ
                   MOVE  LNK-SYU-KOH4SKJ-FTN TO  WK-KNJFTNKIN-SKJ          
               END-IF
             END-IF
      ***    MOVE        WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH1SKJ-FTN
      ***    IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      ***      MOVE      WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH2SKJ-FTN
      ***    END-IF
      ***    IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      ***      MOVE      WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH3SKJ-FTN
      ***    END-IF
      ***    IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      ***      MOVE      WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH4SKJ-FTN
      ***    END-IF
           ELSE
             MOVE        LNK-SYU-SYUSKJ-FTN  TO  WK-KNJFTNKIN-SKJ 
             IF   LNK-SYU-KOH1HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH1SKJ-FTN <  WK-KNJFTNKIN-SKJ
                   MOVE  LNK-SYU-KOH1SKJ-FTN TO  WK-KNJFTNKIN-SKJ
               END-IF 
             END-IF
             IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH2SKJ-FTN <  WK-KNJFTNKIN-SKJ
                   MOVE  LNK-SYU-KOH2SKJ-FTN TO  WK-KNJFTNKIN-SKJ
               END-IF
             END-IF
             IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH3SKJ-FTN <  WK-KNJFTNKIN-SKJ
                   MOVE  LNK-SYU-KOH3SKJ-FTN TO  WK-KNJFTNKIN-SKJ
               END-IF
             END-IF 
             IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
               IF  LNK-SYU-KOH4SKJ-FTN <  WK-KNJFTNKIN-SKJ
                   MOVE  LNK-SYU-KOH4SKJ-FTN TO  WK-KNJFTNKIN-SKJ
               END-IF
             END-IF
      ***    MOVE        WK-KNJFTNKIN-SKJ       TO  LNK-SYU-SYUSKJ-FTN
      ***    IF   LNK-SYU-KOH1HKNNUM   NOT =  SPACE
      ***      MOVE      WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH1SKJ-FTN
      ***    END-IF
      ***    IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      ***      MOVE      WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH2SKJ-FTN
      ***    END-IF
      ***    IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      ***      MOVE      WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH3SKJ-FTN
      ***    END-IF
      ***    IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      ***      MOVE      WK-KNJFTNKIN-SKJ       TO  LNK-SYU-KOH4SKJ-FTN
      ***    END-IF
           END-IF.
      *
      *食事日数比較
      *    IF  ( COMB-KOH1HKNNUM          =   "027" )  OR
      *        ( COMB-HKNNUM              =   SPACE ) 
      *      MOVE        LNK-SYU-KOH1SKJ-NISSU TO  WK-NISSU-SKJ 
      *      IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      *        IF  LNK-SYU-KOH2SKJ-NISSU <  WK-NISSU-SKJ
      *            MOVE  LNK-SYU-KOH2SKJ-NISSU TO  WK-NISSU-SKJ
      *        END-IF
      *      END-IF
      *      IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      *        IF  LNK-SYU-KOH3SKJ-NISSU <  WK-NISSU-SKJ
      *            MOVE  LNK-SYU-KOH3SKJ-NISSU TO  WK-NISSU-SKJ          
      *        END-IF
      *      END-IF
      *      IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      *        IF  LNK-SYU-KOH4SKJ-NISSU <  WK-NISSU-SKJ
      *            MOVE  LNK-SYU-KOH4SKJ-NISSU TO  WK-NISSU-SKJ          
      *        END-IF
      *      END-IF
      *      MOVE        WK-NISSU-SKJ       TO  LNK-SYU-KOH1SKJ-NISSU
      *      IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      *        MOVE      WK-NISSU-SKJ       TO  LNK-SYU-KOH2SKJ-NISSU
      *      END-IF
      *      IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      *        MOVE      WK-NISSU-SKJ       TO  LNK-SYU-KOH3SKJ-NISSU
      *      END-IF
      *      IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      *        MOVE      WK-NISSU-SKJ       TO  LNK-SYU-KOH4SKJ-NISSU
      *      END-IF
      *    ELSE
      *      MOVE        LNK-SYU-SYUSKJ-NISSU  TO  WK-NISSU-SKJ 
      *      IF   LNK-SYU-KOH1HKNNUM   NOT =  SPACE
      *        IF  LNK-SYU-KOH1SKJ-NISSU <  WK-NISSU-SKJ
      *            MOVE  LNK-SYU-KOH1SKJ-NISSU TO  WK-NISSU-SKJ
      *        END-IF 
      *      END-IF
      *      IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      *        IF  LNK-SYU-KOH2SKJ-NISSU <  WK-NISSU-SKJ
      *            MOVE  LNK-SYU-KOH2SKJ-NISSU TO  WK-NISSU-SKJ
      *        END-IF
      *      END-IF
      *      IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      *        IF  LNK-SYU-KOH3SKJ-NISSU <  WK-NISSU-SKJ
      *            MOVE  LNK-SYU-KOH3SKJ-NISSU TO  WK-NISSU-SKJ
      *        END-IF
      *      END-IF 
      *      IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      *        IF  LNK-SYU-KOH4SKJ-NISSU <  WK-NISSU-SKJ
      *            MOVE  LNK-SYU-KOH4SKJ-NISSU TO  WK-NISSU-SKJ
      *        END-IF
      *      END-IF
      *      MOVE        WK-NISSU-SKJ       TO  LNK-SYU-SYUSKJ-NISSU
      *      IF   LNK-SYU-KOH1HKNNUM   NOT =  SPACE
      *        MOVE      WK-NISSU-SKJ       TO  LNK-SYU-KOH1SKJ-NISSU
      *      END-IF
      *      IF   LNK-SYU-KOH2HKNNUM   NOT =  SPACE
      *        MOVE      WK-NISSU-SKJ       TO  LNK-SYU-KOH2SKJ-NISSU
      *      END-IF
      *      IF   LNK-SYU-KOH3HKNNUM   NOT =  SPACE
      *        MOVE      WK-NISSU-SKJ       TO  LNK-SYU-KOH3SKJ-NISSU
      *      END-IF
      *      IF   LNK-SYU-KOH4HKNNUM   NOT =  SPACE
      *        MOVE      WK-NISSU-SKJ       TO  LNK-SYU-KOH4SKJ-NISSU
      *      END-IF
      *    END-IF.
      *
      *    収納テーブルの請求額をセット
           MOVE    WK-KNJFTNKIN             TO  LNK-SYU-SKYMONEY.
      *    食事療養費・食事負担額をセット
           MOVE    WK-RYOYOHI-SKJ           TO  LNK-SYU-RYOYOHI-SKJ.
           MOVE    WK-KNJFTNKIN-SKJ         TO  LNK-SYU-SKYMONEY-SKJ.
           IF   LNK-SYU-SYUSKJ-FTNKBN  =  "4"
             IF    COMB-SYU-HKNKOHSBTKBN  =  "8" 
               IF    COMB-HOJOKBN           =  "1" 
                 CONTINUE
               ELSE
                 IF    WK-TAX1001-KBN  =  "1"
                    COMPUTE LNK-SYU-SKYMONEY-SKJ-TAX   =
                          ( LNK-SYU-SKYMONEY-SKJ  *   0.05 )  +  0.5
                 ELSE
                    COMPUTE LNK-SYU-SKYMONEY-SKJ-TAX   =
                            LNK-SYU-SKYMONEY-SKJ  *   0.05          
                 END-IF
               END-IF
             END-IF
           END-IF.
           COMPUTE  LNK-SYU-SKYMONEY-SKJ-KEI = LNK-SYU-SKYMONEY-SKJ
                                             + LNK-SYU-SKYMONEY-SKJ-TAX.
      *    特定疾患がある方の特例処理
           IF  ( LNK-SYU-KOH1HKNNUM    =  "051" )
           OR  ( LNK-SYU-KOH2HKNNUM    =  "051" )
           OR  ( LNK-SYU-KOH3HKNNUM    =  "051" )
           OR  ( LNK-SYU-KOH4HKNNUM    =  "051" )
             IF    LNK-SYU-SRYYMD(1:6)   <  "200310"
               COMPUTE   WK-FTN   =   LNK-SYU-SKYMONEY  
                                  +   LNK-SYU-SKYMONEY-SKJ-KEI
               IF        WK-FTN    >  13995
                 COMPUTE  LNK-SYU-SKYMONEY  =  LNK-SYU-SKYMONEY    
                                            +  LNK-SYU-SKYMONEY-SKJ-KEI
                 MOVE      ZERO            TO  LNK-SYU-SKYMONEY-SKJ
                                               LNK-SYU-SKYMONEY-SKJ-TAX
                                               LNK-SYU-SKYMONEY-SKJ-KEI
               END-IF
             ELSE
               COMPUTE   WK-FTN   =   LNK-SYU-SKYMONEY  
                                  +   LNK-SYU-SKYMONEY-SKJ-KEI
               IF        WK-FTN    >=  WK-NYUJGNGAK
                 COMPUTE  LNK-SYU-SKYMONEY  =  LNK-SYU-SKYMONEY    
                                            +  LNK-SYU-SKYMONEY-SKJ-KEI
                 MOVE      ZERO            TO  LNK-SYU-SKYMONEY-SKJ
                                               LNK-SYU-SKYMONEY-SKJ-TAX
                                               LNK-SYU-SKYMONEY-SKJ-KEI
               END-IF
             END-IF
           END-IF.
           IF    LNK-SYU-SRYYMD(1:6)   <   "200304"
               CONTINUE
           ELSE
      *      生活保護がある方の特例処理
             IF  ( LNK-SYU-KOH1HKNNUM    =  "012" )
             OR  ( LNK-SYU-KOH2HKNNUM    =  "012" )
             OR  ( LNK-SYU-KOH3HKNNUM    =  "012" )
             OR  ( LNK-SYU-KOH4HKNNUM    =  "012" )
               COMPUTE   WK-FTN   =   LNK-SYU-SKYMONEY  
                                  +   LNK-SYU-SKYMONEY-SKJ-KEI
               IF        WK-FTN    >=  WK-NYUJGNGAK
                 COMPUTE  LNK-SYU-SKYMONEY  =  LNK-SYU-SKYMONEY    
                                            +  LNK-SYU-SKYMONEY-SKJ-KEI
                 MOVE      ZERO            TO  LNK-SYU-SKYMONEY-SKJ
                                               LNK-SYU-SKYMONEY-SKJ-TAX
                                               LNK-SYU-SKYMONEY-SKJ-KEI
               END-IF
             END-IF
      *      更正がある方の特例処理
             IF  ( LNK-SYU-KOH1HKNNUM    =  "015" )
             OR  ( LNK-SYU-KOH2HKNNUM    =  "015" )
             OR  ( LNK-SYU-KOH3HKNNUM    =  "015" )
             OR  ( LNK-SYU-KOH4HKNNUM    =  "015" )
               COMPUTE   WK-FTN   =   LNK-SYU-SKYMONEY  
                                  +   LNK-SYU-SKYMONEY-SKJ-KEI
               IF        WK-FTN    >=  WK-NYUJGNGAK
                 COMPUTE  LNK-SYU-SKYMONEY  =  LNK-SYU-SKYMONEY    
                                            +  LNK-SYU-SKYMONEY-SKJ-KEI
                 MOVE      ZERO            TO  LNK-SYU-SKYMONEY-SKJ
                                               LNK-SYU-SKYMONEY-SKJ-TAX
                                               LNK-SYU-SKYMONEY-SKJ-KEI
               END-IF
             END-IF
      *      育成がある方の特例処理
             IF  ( LNK-SYU-KOH1HKNNUM    =  "016" )
             OR  ( LNK-SYU-KOH2HKNNUM    =  "016" )
             OR  ( LNK-SYU-KOH3HKNNUM    =  "016" )
             OR  ( LNK-SYU-KOH4HKNNUM    =  "016" )
               COMPUTE   WK-FTN   =   LNK-SYU-SKYMONEY  
                                  +   LNK-SYU-SKYMONEY-SKJ-KEI
               IF        WK-FTN    >=  WK-NYUJGNGAK
                 COMPUTE  LNK-SYU-SKYMONEY  =  LNK-SYU-SKYMONEY    
                                            +  LNK-SYU-SKYMONEY-SKJ-KEI
                 MOVE      ZERO            TO  LNK-SYU-SKYMONEY-SKJ
                                               LNK-SYU-SKYMONEY-SKJ-TAX
                                               LNK-SYU-SKYMONEY-SKJ-KEI
               END-IF
             END-IF
           END-IF.
      *
           COMPUTE  LNK-SYU-RYOYOHI-SKJ-JIHI  = WK-SHOKUJI-RYOYOHI95
                                              + WK-SHOKUJI-RYOYOHI96.
           COMPUTE  LNK-SYU-SKYMONEY-SKJ-JIHI = WK-SHOKUJI-FTN95
                                              + WK-SHOKUJI-FTN96.
           IF    WK-TAX1001-KBN  =  "1"
               COMPUTE  LNK-SYU-SKYMONEY-SKJ-JIHI-TAX  =
                      ( WK-SHOKUJI-FTN96  *  0.05 )  +  0.5
           ELSE
               COMPUTE  LNK-SYU-SKYMONEY-SKJ-JIHI-TAX  =
                        WK-SHOKUJI-FTN96  *  0.05          
           END-IF.
           COMPUTE  LNK-SYU-SKYMONEY-SKJ-JIHI-KEI
                                      = LNK-SYU-SKYMONEY-SKJ-JIHI
                                      + LNK-SYU-SKYMONEY-SKJ-JIHI-TAX.
      *
      *    収納テーブルの公費毎の患者負担金額をセットする
           IF   (COMB-KOH1HKNNUM         NOT = SPACE)   AND
                (COMB-KOH1-NYUJGNKBN     =     "1")
             IF  ( LNK-S02-KOUREI-NYUIN-KBN     =        "1"  )
             AND ( COMB-KOH1HKNNUM              =       "027" )
                  CONTINUE
             ELSE
                    COMPUTE  LNK-SYU-KOH1HKNFTNMONEY  =                  
                                    LNK-SYU-KOH1COMPFTN     +   5        
                    COMPUTE  LNK-SYU-KOH1HKNFTNMONEY  =                  
                                    LNK-SYU-KOH1HKNFTNMONEY /  10        
                    COMPUTE  LNK-SYU-KOH1HKNFTNMONEY  =                  
                                    LNK-SYU-KOH1HKNFTNMONEY *  10        
             END-IF
           END-IF.
           IF   (COMB-KOH2HKNNUM        NOT = SPACE)   AND
                (COMB-KOH2-NYUJGNKBN    =     "1")
                    COMPUTE  LNK-SYU-KOH2HKNFTNMONEY  =                  
                                    LNK-SYU-KOH2COMPFTN     +   5        
                    COMPUTE  LNK-SYU-KOH2HKNFTNMONEY  =                  
                                    LNK-SYU-KOH2HKNFTNMONEY /  10        
                    COMPUTE  LNK-SYU-KOH2HKNFTNMONEY  =                  
                                    LNK-SYU-KOH2HKNFTNMONEY *  10        
           END-IF.
           IF   (COMB-KOH3HKNNUM        NOT = SPACE)   AND
                (COMB-KOH3-NYUJGNKBN    =     "1")
                    COMPUTE  LNK-SYU-KOH3HKNFTNMONEY  =                  
                                    LNK-SYU-KOH3COMPFTN     +   5        
                    COMPUTE  LNK-SYU-KOH3HKNFTNMONEY  =                  
                                    LNK-SYU-KOH3HKNFTNMONEY /  10        
                    COMPUTE  LNK-SYU-KOH3HKNFTNMONEY  =                  
                                    LNK-SYU-KOH3HKNFTNMONEY *  10        
           END-IF.
           IF   (COMB-KOH4HKNNUM        NOT = SPACE)   AND
                (COMB-KOH4-NYUJGNKBN    =     "1")
                    COMPUTE  LNK-SYU-KOH4HKNFTNMONEY  =                  
                                    LNK-SYU-KOH4COMPFTN     +   5        
                    COMPUTE  LNK-SYU-KOH4HKNFTNMONEY  =                  
                                    LNK-SYU-KOH4HKNFTNMONEY /  10        
                    COMPUTE  LNK-SYU-KOH4HKNFTNMONEY  =                  
                                    LNK-SYU-KOH4HKNFTNMONEY *  10        
           END-IF.
      *
      *    レセ記載金額退避用エリアから収納項目へ編集
      *
           IF    WK-KOH-COMPFTN(1)  =  ALL"9"                           
                       CONTINUE                                         
           ELSE                                                         
                MOVE  WK-KOH-COMPFTN(1)  TO   LNK-SYU-KOH1COMPFTN       
                COMPUTE   LNK-SYU-KOH1COMPTOTAL   =
                          LNK-SYU-KOH1COMPFTN     
           END-IF.                                                      
      *
           IF    WK-KOH-COMPFTN(2)  =  ALL"9"                           
                       CONTINUE                                         
           ELSE                                                         
                MOVE  WK-KOH-COMPFTN(2)  TO   LNK-SYU-KOH2COMPFTN       
                COMPUTE   LNK-SYU-KOH2COMPTOTAL   =
                          LNK-SYU-KOH2COMPFTN     
           END-IF.                                                      
      *
           IF    WK-KOH-COMPFTN(3)  =  ALL"9"                           
                       CONTINUE                                         
           ELSE                                                         
                MOVE  WK-KOH-COMPFTN(3)  TO   LNK-SYU-KOH3COMPFTN       
                COMPUTE   LNK-SYU-KOH3COMPTOTAL   =
                          LNK-SYU-KOH3COMPFTN     
           END-IF.                                                      
      *
           IF    WK-KOH-COMPFTN(4)  =  ALL"9"                           
                       CONTINUE                                         
           ELSE                                                         
                MOVE  WK-KOH-COMPFTN(4)  TO   LNK-SYU-KOH4COMPFTN       
                COMPUTE   LNK-SYU-KOH4COMPTOTAL   =
                          LNK-SYU-KOH4COMPFTN     
           END-IF.                                                      
      *
      *    主保険・老人保険の金額置き換え
           IF   COMB-HKNNUM            NOT =   SPACE
           AND  LNK-SYU-SYUCOMPFTN     NOT =    ZERO
           AND  FLG-KOUGAKUCYO         NOT =     1  
      *
                 COMPUTE   LNK-SYU-SYUCOMPFTN  =
                           LNK-SYU-SYUCOMPFTN  +  5
                 COMPUTE   WK-FTN      =
                           LNK-SYU-SYUCOMPFTN  / 10
                 COMPUTE   LNK-SYU-SYUCOMPFTN  =
                           WK-FTN   *  10
      *
           END-IF.
      *
           IF   COMB-KOH1HKNNUM            =   "027"
           AND  LNK-SYU-KOH1COMPFTN    NOT =    ZERO
           AND  FLG-KOUGAKUCYO         NOT =     1  
      *
                 COMPUTE   LNK-SYU-KOH1COMPFTN  =
                           LNK-SYU-KOH1COMPFTN  +  5
                 COMPUTE   WK-FTN      =
                           LNK-SYU-KOH1COMPFTN  / 10
                 COMPUTE   LNK-SYU-KOH1COMPFTN  =
                           WK-FTN   *  10
      *
           END-IF.
      *
      ***     IF   FLG-SYUHEN                 =   "1"
      *
      ***        IF   COMB-HKNNUM            NOT =   SPACE
      ***        AND  LNK-SYU-SYUCOMPFTN     NOT =   WK-HEN-SYUCOMPFTN
      *
      ***           MOVE  WK-HEN-SYUCOMPFTN   TO  LNK-SYU-SYUCOMPFTN
      ***           COMPUTE   LNK-SYU-SYUCOMPTOTAL   =
      ***                     LNK-SYU-SYUCOMPFTN      
      *
      ***        END-IF
      ***        IF   COMB-KOH1HKNNUM            =   "027"
      ***        AND  LNK-SYU-KOH1COMPFTN    NOT =   WK-HEN-KOH1COMPFTN
      *
      ***           MOVE  WK-HEN-KOH1COMPFTN  TO  LNK-SYU-KOH1COMPFTN
      ***           COMPUTE   LNK-SYU-KOH1COMPTOTAL   =
      ***                     LNK-SYU-KOH1COMPFTN      
      *
      ***        END-IF
      *
      ***     END-IF.
      *
       2314-FTNKIN-HIKAKU-EXT.
           EXIT.
      *
      *****************************************************************
      *    年金履歴読込
      *****************************************************************
       TNKRRK-READ-SEC           SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  TNKRRK-REC
               MOVE    ZERO            TO  FLG-TNKRRK
           ELSE
               INITIALIZE                  TNKRRK-REC
               MOVE    1               TO  FLG-TNKRRK
           END-IF
      *
           .
       TNKRRK-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    低所得者履歴読込
      *****************************************************************
       TSYRRK-READ-SEC          SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  TSYRRK-REC
               MOVE    ZERO            TO  FLG-TSYRRK
           ELSE
               INITIALIZE                  TSYRRK-REC
               MOVE    1               TO  FLG-TSYRRK
           END-IF
      *
           .
       TSYRRK-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    患者公費負担マスター読込
      *****************************************************************
       PTKOHFTN-READ-SEC          SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  PTKOHFTN-REC
               MOVE    ZERO            TO  FLG-PTKOHFTN
           ELSE
               INITIALIZE                  PTKOHFTN-REC
               MOVE    1               TO  FLG-PTKOHFTN
           END-IF
      *
           .
       PTKOHFTN-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    保険番号マスター読込
      *****************************************************************
       HKNNUM-READ-SEC         SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  HKNNUM-REC
               MOVE    ZERO            TO  FLG-HKNNUM
           ELSE
               INITIALIZE                  HKNNUM-REC
               MOVE    1               TO  FLG-HKNNUM
           END-IF
      *
           .
       HKNNUM-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    保険組合せマスター読込
      *****************************************************************
       HKNCOMBI-READ-SEC         SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  HKNCOMBI-REC
               MOVE    ZERO            TO  FLG-HKNCOMBI
           ELSE
               INITIALIZE                  HKNCOMBI-REC
               MOVE    1               TO  FLG-HKNCOMBI
           END-IF
      *
           .
       HKNCOMBI-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    システム管理マスター読込
      *****************************************************************
       SYSKANRI-READ-SEC         SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  SYS-1001-REC
                                           SYS-1026-REC
                                           SYS-1027-REC
                                           SYS-4001-REC
                                           SYS-5000-REC
               MOVE    ZERO            TO  FLG-SYSKANRI
           ELSE
               INITIALIZE                  SYS-1001-REC
                                           SYS-1026-REC
                                           SYS-1027-REC
                                           SYS-4001-REC
                                           SYS-5000-REC
               MOVE    1               TO  FLG-SYSKANRI
           END-IF
      *
           .
       SYSKANRI-READ-EXT.
           EXIT.
      *****************************************************************
      *    収納マスター読込
      *****************************************************************
       SYUNOU-READ-SEC          SECTION.
      *
       SYUNOU-READ-100.
      *
      **>  IF  LNK-S02-KOUREI-NYUIN-KBN   =   "1"
               MOVE    "DBFETCH"           TO  MCP-FUNC.
               CALL    "ORCMCPSUB"          USING
                                            MCPAREA
                                            ORCMCPAREA
                                            MCPDATA-REC.
               IF      MCP-RC              =   ZERO
                   MOVE    MCPDATA-REC     TO  SYU-SYUNOU-REC
                   IF     (LNK-S02-SAIKEISAN-KBN    =   "1")    AND
                          (LNK-S02-SAIKEISAN-DENPYO =   SYU-DENPNUM)
                           GO    TO    SYUNOU-READ-100
                   ELSE
                           MOVE    ZERO    TO  FLG-SYUNOU
                   END-IF
               ELSE
                   INITIALIZE                  SYU-SYUNOU-REC
                   MOVE    1               TO  FLG-SYUNOU
               END-IF.
      **>  ELSE
      **>      MOVE    "DBFETCH"           TO  MCP-FUNC
      **>      CALL    "ORCMCPSUB"          USING
      **>                                   MCPAREA
      **>                                   ORCMCPAREA
      **>                                   MCPDATA-REC
      **>      IF      MCP-RC              =   ZERO
      **>          MOVE    MCPDATA-REC     TO  SYU-SYUNOU-REC
      **>          IF     (LNK-S02-SAIKEISAN-KBN    =   "1")    AND
      **>                 (LNK-S02-SAIKEISAN-DENPYO <=   SYU-DENPNUM)
      **>                  GO    TO    SYUNOU-READ-100
      **>          ELSE
      **>                  MOVE    ZERO    TO  FLG-SYUNOU
      **>          END-IF
      **>      ELSE
      **>          INITIALIZE                  SYU-SYUNOU-REC
      **>          MOVE    1               TO  FLG-SYUNOU
      **>      END-IF
      **>  END-IF.
      *
       SYUNOU-READ-EXT.
           EXIT.
      
      *****************************************************************
      *    患者情報読込
      *****************************************************************
       PTINF-READ-SEC           SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  PTINF-REC
               MOVE    ZERO            TO  FLG-PTINF
           ELSE
               INITIALIZE                  PTINF-REC
               MOVE    1               TO  FLG-PTINF
           END-IF
      *
           .
       PTINF-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    入院会計マスター読込
      *****************************************************************
       NYUINACCT-READ-SEC         SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  NYUINACCT-REC
               MOVE    ZERO            TO  FLG-NYUINACCT
           ELSE
               INITIALIZE                  NYUINACCT-REC
               MOVE    1               TO  FLG-NYUINACCT
           END-IF
      *
           .
       NYUINACCT-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    診療会計読込
      *****************************************************************
       SRYACCT-READ-SEC           SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  SRYACCT-REC
               MOVE    ZERO            TO  FLG-SRYACCT
           ELSE
               INITIALIZE                  SRYACCT-REC
               MOVE    1               TO  FLG-SRYACCT
           END-IF
      *
           .
       SRYACCT-READ-EXT.
           EXIT.
      *
      *****************************************************************
      *    点数テーブルの検索
      *****************************************************************
       TENSU-TBL-SEC               SECTION.
      *
           INITIALIZE                           TNS-TENSU-REC
           MOVE    WK-SRYCD             TO      TNS-SRYCD
           MOVE    TNS-TENSU-REC        TO      MCPDATA-REC
           MOVE    LNK-SYU-SKYSTYMD     TO      ORC-DBYMD
           MOVE    "DBSELECT"           TO      MCP-FUNC
           MOVE    "TENSU-KEY"          TO      ORC-DBPATH
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
           IF      MCP-RC               =       ZERO
               MOVE    "TENSU-KEY"      TO      ORC-DBPATH
               PERFORM  TENSU-READ-SEC
           ELSE
               MOVE     1               TO      FLG-TENSU
           END-IF
      *
           IF     FLG-TENSU    =    ZERO
              IF    LNK-SYU-SYUHKNNUM   =   "971" OR "973"
                 COMPUTE   WK-KEISAN    =   TNS-TEN    *  1.2
                 COMPUTE   WK-KEISAN    =   WK-KEISAN  +   5
                 COMPUTE   WK-KEISAN    =   WK-KEISAN  /  10
                 COMPUTE   WK-KEISAN    =   WK-KEISAN  *  10
              ELSE
                 MOVE      TNS-TEN     TO     WK-KEISAN
              END-IF
           ELSE
                 MOVE      ZERO        TO     WK-KEISAN
           END-IF
      *
           MOVE    "DBCLOSE"            TO      MCP-FUNC
           MOVE    "TENSU-KEY"          TO      ORC-DBPATH
           CALL    "ORCMCPSUB"          USING
                                        MCPAREA
                                        ORCMCPAREA
                                        MCPDATA-REC
      *
           .
       TENSU-TBL-EXT.
           EXIT.
      *
      *****************************************************************
      *    点数読込
      *****************************************************************
       TENSU-READ-SEC           SECTION.
      *
           MOVE    "DBFETCH"           TO  MCP-FUNC
           CALL    "ORCMCPSUB"         USING
                                       MCPAREA
                                       ORCMCPAREA
                                       MCPDATA-REC
           IF      MCP-RC              =   ZERO
               MOVE    MCPDATA-REC     TO  TNS-TENSU-REC
               MOVE    ZERO            TO  FLG-TENSU
           ELSE
               INITIALIZE                  TNS-TENSU-REC
               MOVE    1               TO  FLG-TENSU
           END-IF
      *
           .
       TENSU-READ-EXT.
           EXIT.
      *
