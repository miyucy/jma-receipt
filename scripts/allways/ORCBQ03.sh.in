#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

OLDLOG=/var/log/jma-receipt/"$2"ORCBQ03.log
LOG=/var/log/jma-receipt/"$2"orcb013_3.log

[ -e "${OLDLOG}" ] &&  rm ${OLDLOG}
[ -e "${LOG}" ] &&  rm ${LOG}


#-------------------------------------------#
#        検索結果データ作成
#        $1  TERMID
#        $2  HOSPNUM
#        $3  パラメータファイル名
#        $4  処理日
#        $5  処理時間
#-------------------------------------------#

TMPFILE=$3

cleanup(){
echo "$TMPFILE" >> $LOG
##      パラメータファイル削除
        if  [ -e ${TMPFILE} ]; then
            rm   ${TMPFILE}
        fi
}

trap cleanup 0

for p in $(pgrep -u orca -f "$0 $1" ) ; do
  if [ $p -ne $$ ]; then
    pkill -P $p
  fi
done

        $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBQ03 -parameter "$1,$2,$3,$4,$5,"  > $LOG 2>&1

        exit

