#!/bin/sh

if test -z "$JMARECEIPT_ENV"; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    データチェク処理
#        $1-${11} 印刷ＤＢ用固定引数
#        ${12} ジョブＩＤ
#        ${13} シェルＩＤ
#        ${14} 医療機関番号
#        ${15} エラーファイル名 
#        ${16} 一括・個別区分
#        ${17} 診療年月
#        ${18} 入外区分
#        ${19} チェック区分×５０
#        ${20} 社保の処理区分
#        ${21} 国保の処理区分
#        ${22} 労災の処理区分
#        ${23} 自賠責の処理区分
#        ${24} 自費保険の処理区分
#        ${25} 院外処方の処理区分
#        ${26} 印刷順
#        ${27} 患者別リストの作成区分
#        ${28} 診療日指定区分
#        ${29} 診療日指定開始日
#        ${30} 診療日指定終了日
#-------------------------------------------#

LOGFILE="/var/log/jma-receipt/${14}orcb041.log"


##      エラーファイル削除
        if  [ -e ${15} ]; then
            rm  ${15}
        fi

	$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCDTCHK000 -parameter "$1,$2,$3,$4,$5,$6,$7,$8,$9,${10},${11},${12},${13},${14},${15},${16},${17},${18},${19},${20},${21},${22},${23},${24},${25},${26},${27},${28},${29},${30},"   > $LOGFILE 2>&1
    if  [ -e ${15} ]; then
        exit
    fi

	$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE${12}${13},${14}

##      作業ファイル削除
rm /tmp/${14}00DTCHK*.dat
rm /tmp/${14}00DCACCT*.dat
rm /tmp/${14}00DCSRY*.dat

exit
