#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

RENNUM=0
#-------------------------------------------#
#   支払証明発行 
#        $1-${11} 印刷ＤＢ用固定引数
#        ${12} ジョブＩＤ
#        ${13} シェルＩＤ
#        ${14} エラーファイル名 
#        ${15} 医療機関番号
#        ${16} 帳票種別
#        ${17} プログラム名
#        ${18} STAFFCD
#        ${19} 期間開始日 X(08)
#        ${20} 期間終了日 X(08)
#        ${21} 期間区分   X(01)
#        ${22} 期間終了日後の支払い X(01)
#        ${23} 請求内容の印字 X(01)
#        ${24} 患者ＩＤ
#        ${25} 入外区分
#        ${26} 自費集計区分
#        ${27} 期間開始日前の支払い X(01)
#-------------------------------------------#
##
LOGFILE="/var/log/jma-receipt/${15}orcb023.log"
[ -e "${LOGFILE}" ] && ${LOGFILE}

	echo $#
##      エラーファイル削除
	echo "echo " ${14}
        if  [ -e ${14} ]; then
            rm  ${14}
        fi
##
        RENNUM=$(expr $RENNUM + 1) 
	$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBS01 -parameter "$1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${12},${13},${14},${15},${16},${17},${18},${19},${20},${21},${22},${23},${24},${25},${26},${27},"

        if  [ -e ${14} ]; then
            exit
        fi
       
       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter "JBE${12}${13},${15}"
        exit 
