#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#   収納ログ情報編集
#        $1 HOSPNUM
#        $2 PTNUM
#        $3 OPID
#        $4 ファイル名
#        $5 処理日
#        $6 処理時刻
#-------------------------------------------#
##
PRFFILE=$4
TMPLOGFILE="/var/log/jma-receipt/${1}orcb023_2.log.$$"
LOGFILE=${TMPLOGFILE%.$$}.gz

$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBS02 -parameter "$1,$2,$3,$4,$5,$6," | sed 's/ *$//g' >  ${TMPLOGFILE}
gzip -c ${TMPLOGFILE} >> ${LOGFILE}
if [ $(stat -c "%s" ${LOGFILE}) -ge 1048576 ] ; then
	[ -e ${LOGFILE}.1 ] && mv ${LOGFILE}.1 ${LOGFILE}.2
	[ -e ${LOGFILE}   ] && mv ${LOGFILE}   ${LOGFILE}.1
fi

[ -e "${PRFFILE}" ] && rm "${PRFFILE}"
[ -e "${TMPLOGFILE}" ] && rm "${TMPLOGFILE}"
