#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    未請求一覧作成
#        $1-${11} 印刷ＤＢ用固定引数
#        ${12} HOSPNUM
#        ${13} ジョブＩＤ
#        ${14} シェルＩＤ
#        ${15} エラーファイル名 
#        ${16} 帳票区分 1:チェックリスト 2:主科未設定リスト 
#-------------------------------------------#

     RENNUM=0

     LOG_FILE="/var/log/jma-receipt/${12}recept5.log"

    echo "arg15 =  [" ${15} "]"  > $LOG_FILE
    echo "arg16 =  [" ${16} "]"  >> $LOG_FILE

##  エラーファイル削除
    echo "errfile = [" ${MCP_TEMPDIR}/${15}  "]" >> $LOG_FILE
    rm  -f ${MCP_TEMPDIR}/${15}

##      未請求一覧
        RENNUM=$(expr $RENNUM + 1) 
        if  [ ${16} -eq '1' ]; then
            $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM005 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${12},${13},${14},${15} >> $LOG_FILE 2>&1
        else
            $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM006 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${12},${13},${14},${15} >> $LOG_FILE 2>&1
        fi
        if  [ -e ${MCP_TEMPDIR}/${15} ]; then
            exit
        fi
       
       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE${13}${14},${12} >> $LOG_FILE 2>&1

        exit 

