#!/bin/sh

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV


RENNUM=0
-------------------------------------------#
#    総括表用ファイル作成
#        $1-${11} 印刷ＤＢ用固定引数
#        ${12} SRYYM TERID SYSYMD
#        ${13} RECEKBN(総括表の種類)
#           0:全体  1:社保　2:国保
#        ${14} 医療機関ＩＤ 
#        ${15} 国保診療報酬請求書印刷区分
#        ${16} ジョブＩＤ
#        ${17} シェルＩＤ
#        ${18} エラーファイル名 
#        ${19} 処理年月
#        ${20} 入外区分
#        ${21} 個別指定の保険者番号（国保）
#        ${22} 社保:処理対象区分
#           0:全体  1:当月・月遅れ分  2:返戻分
#        ${23} 国保:処理対象区分
#           0:全体  1:当月・月遅れ分  2:返戻分
#-------------------------------------------#
#
##      エラーファイル削除
	echo $#
	echo "echo " ${18}
        if  [ -e ${18} ]; then
            rm  ${18}
        fi 
        
##      総括表（社保）
        if  [ ${13} -ne 2 ]; then
           RENNUM=$(expr $RENNUM + 1) 
           $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM001 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${12},${14},${16},${17}
           if  [ -e ${18} ]; then
               exit
           fi
           if  [ $5 -ge '200210' ]; then
##             返戻分
               if  [ ${22} -eq '0' ] || [ ${22} -eq '2' ]; then
                   RENNUM=$(expr $RENNUM + 1) 
                   $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM022 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},2
                   if  [ -e ${18} ]; then
                      exit
                   fi
               fi
##             当月・月遅れ分
               if  [ ${22} -eq '0' ] || [ ${22} -eq '1' ]; then
                   RENNUM=$(expr $RENNUM + 1) 
                   $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM022 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},1
                   if  [ -e ${18} ]; then
                      exit
                   fi
               fi
           fi    
        fi
         
##      総括表（国保）
        if  [ ${13} -ne 1 ]; then
            RENNUM=$(expr $RENNUM + 1) 
            if  [ ${15} = 1 ]; then
                 $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM012 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${21}
            else
                 $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM004 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${21}
            fi	
            if  [ -e ${18} ]; then
                exit
            fi
            
            if  [ $5 -ge '200210' ]; then
               RENNUM=$(expr $RENNUM + 1) 
               if  [ ${15} = 1 ]; then
                   $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM026 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21}
               else
                   $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM025 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21}
               fi	
               if  [ -e ${18} ]; then
                   exit
               fi
            fi    

            
            if  [ $5 -ge '200304' ]; then
##             返戻分
               if  [ ${23} -eq '0' ] || [ ${23} -eq '2' ]; then
                   RENNUM=$(expr $RENNUM + 1) 
                   if  [ ${15} = 1 ]; then
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM030 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},2,1
                   else
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM029 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},2,1
                   fi
                   if  [ -e ${18} ]; then
                       exit
                   fi
               fi
##             当月・月遅れ分
               if  [ ${23} -eq '0' ] || [ ${23} -eq '1' ]; then
                   RENNUM=$(expr $RENNUM + 1) 
                   if  [ ${15} = 1 ]; then
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM030 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},1,1
                   else
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM029 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},1,1
                   fi
                   if  [ -e ${18} ]; then
                       exit
                   fi
               fi

##             返戻分（特別療養費分）
               if  [ ${23} -eq '0' ] || [ ${23} -eq '2' ]; then
                   RENNUM=$(expr $RENNUM + 1) 
                   if  [ ${15} = 1 ]; then
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM030 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},2,2
                   else
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM029 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},2,2
                   fi
                   if  [ -e ${18} ]; then
                       exit
                   fi
               fi
##             当月・月遅れ分（特別療養費分）
               if  [ ${23} -eq '0' ] || [ ${23} -eq '1' ]; then
                   RENNUM=$(expr $RENNUM + 1) 
                   if  [ ${15} = 1 ]; then
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM030 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},1,2
                   else
                       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBM029 -parameter $1,$2,$3,$RENNUM,$5,$6,$7,$8,$9,${10},${11},${14},${16},${17},${20},${21},1,2
                   fi
                   if  [ -e ${18} ]; then
                       exit
                   fi
               fi

            fi    
       fi
       
       $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE${16}${17}

        exit 
