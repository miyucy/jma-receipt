#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV

#-------------------------------------------#
#    °åÎÅÀÁµá½ñ½ÐÎÏ½èÍý
#        CPCOMMONSHELL1.INC($3-$6)  
#        $1 JOBID 
#        $2 SHELLID
#        $3 SRYYM TERID SYSYMD
#        $4 ¼Â¹Ô¥×¥í¥°¥é¥à
#           0:ORCR0101
#           1:ORCR0102 
#        $5 SYOKBN         ¡Ê£Ï£Ò£Ã£Ò£°£±£°£²¤Î¤È¤­¤Î¤ß»ÈÍÑ¡Ë
#           1:°ì³ç 2:¸ÄÊÌ
#        $6 ¥¨¥é¡¼¥Õ¥¡¥¤¥ëÌ¾ 
#        $7 °õºþÍÑ¾ò·ï¥Ñ¥é¥á¥¿ 
#        $8 °õºþ³«»Ï 
#        $9 °õºþ½ªÎ»
#        $10 Ä¢É¼¼±ÊÌÈÖ¹æ
#        $11 ¥×¥ê¥ó¥¿Ì¾
#        $12 ¥×¥ê¥ó¥¿Ì¾¡ÊÂ³»æ¡Ë
#        $13-$23 °õºþ£Ä£ÂÍÑ¸ÇÄê°ú¿ô
#        $24 Â³»æ°õºþ¶èÊ¬
#        $25 ¹ñÊÝ¥×¥ê¥ó¥¿Ì¾¡ÊÆþÎÏ½ç°õºþ»þ¤Î¤ß¡Ë
#        $26 ¹ñÊÝ¥×¥ê¥ó¥¿Ì¾¡ÊÂ³»æ¡Ë¡ÊÆþÎÏ½ç°õºþ»þ¤Î¤ß¡Ë
#        $27 °õºþ¶èÊ¬ 1:°õºþ¤Î¤ß 2:°õºþ¡õ£ð£ó 3:£ð£ó¤Î¤ß 
#        $28 ¸©Æâ¸©³°¶èÊ¬
#        $29 ¼ç²Ê
#        $30 HOSPNUM
#-------------------------------------------#

        LOG_FILE="/var/log/jma-receipt/${30}recept2.log"

        if [ $4 -eq  '0' ] && [ ${10} -eq  '01' ]; then
           rm $LOG_FILE

           echo "arg1  = [" ${1} "]"  >$LOG_FILE
           echo "arg2  = [" ${2} "]" >>$LOG_FILE
           echo "arg3  = [" ${3} "]" >>$LOG_FILE
           echo "arg6  = [" ${6} "]" >>$LOG_FILE
           echo "arg30 = [" ${30} "]" >>$LOG_FILE
        fi

##      ¥¨¥é¡¼¥Õ¥¡¥¤¥ëºï½ü
        echo "arg4   = [" ${4} "]"  >>$LOG_FILE
        echo "arg10  = [" ${10} "]" >>$LOG_FILE

        if [ $4 -eq  '0' ] && [ ${10} -eq '01' ]; then
	   echo "errfile = [" ${MCP_TEMPDIR}/${6}  "]" >> $LOG_FILE
           rm  -f ${MCP_TEMPDIR}/${6}
        fi

        rennum=0

        
        if [ $4 -eq  '0' ]; then
           if  [ -e ${MCP_TEMPDIR}/${6} ]; then
               exit
           else
	           $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR0101 -parameter ${24},${28},${29},$1,$2,$3,$7,$8,$9,${10},${11},${12},${25},${26},${30},${6}, >> $LOG_FILE 2>&1
           fi
        else 
           if  [ -e ${MCP_TEMPDIR}/${6} ]; then
	           $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE$1$2,${30} >> $LOG_FILE 2>&1
           else
              rennum=$(expr $rennum + 1) 
	          $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCR0102 -parameter $1,$2,$3,$7,$5,${13},${14},${15},$rennum,${17},${18},${19},${20},${21},${22},${23},${27},${30},${6} >> $LOG_FILE 2>&1
              if  [ -e ${MCP_TEMPDIR}/${6} ]; then
	             $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE$1$2,${30} >> $LOG_FILE 2>&1
              else
                 $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBPREV1 -parameter ${13},${14},${15},$rennum,${17},${18},${19},${20},${21},${22},${23},$1,$2,$8,$9,${27},$5,${6},${30} >> $LOG_FILE 2>&1
	             $DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBJOB -parameter JBE$1$2,${30} >> $LOG_FILE 2>&1
              fi
           fi
        fi

        exit
