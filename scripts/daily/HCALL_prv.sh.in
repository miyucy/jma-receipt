#!/bin/bash

if test -z "$JMARECEIPT_ENV" ; then
    JMARECEIPT_ENV="@jma-receipt-env@"
fi
if ! test -f "$JMARECEIPT_ENV"; then
    exit 0
fi

. $JMARECEIPT_ENV
export HOME=/home/orca
export PATH=$SITESCRIPTSDIR/daily:$PATCHSCRIPTSDIR/daily:$SCRIPTSDIR/daily:$(dirname ${MONUPLOAD}):$PATH

#----------------------------------------------------------------------#
#       引数	
#       1:DATAファイル名称
#       2:HOSPNUM
#       3:エンコーディング(1:EUC-JP/2:UTF8/3:OTHER)
#       4:none
#       5:帳票表題（クライアント印刷用）
#       6:ダイアログ表示区分（1:ダイアログ表示　クライアント印刷用）
#----------------------------------------------------------------------#

echo	`date`
echo $#

PRT_FILE_BASE=$1
PRT_FILE_FULL=${MCP_TEMPDIR}/${PRT_FILE_BASE}

REPORT_TITLE=""
[ -n "$5" ] && REPORT_TITLE=$(echo $5 | nkf -w)

print_parent_prv.rb ${PRT_FILE_FULL} ${FORMDIR} ${RECORDDIR} ${SITEFORMDIR} ${SITERECORDDIR} ${PATCHFORMDIR} ${MCP_TEMPDIR} "${REPORT_TITLE}" "$6"
if	[ $?  -eq  0 ]; then
       	$DBSTUB -dir $LDDIRECTORY -bd orcabt ORCBPREV -parameter ${PRT_FILE_BASE},$2
fi

#------ お薬手帳、処方せんQRイメージ削除
#       （一時ディレクトリに作成されたpngファイルを削除）
grep -Eo "${MCP_TEMPDIR}/([0-9a-zA-Z]|\.|\-|\_)+\.png" ${PRT_FILE_FULL} | xargs -r rm -f

[ -e ${PRT_FILE_FULL} ] && rm ${PRT_FILE_FULL}

	echo	`date`
	echo "HCALL end"
